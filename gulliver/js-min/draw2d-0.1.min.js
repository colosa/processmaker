var jg_ok,jg_ie,jg_fast,jg_dom,jg_moz;function _chkDHTM(a,b,c){jg_ie=(b=a.document.body||null)&&"undefined"!=typeof b.insertAdjacentHTML&&a.document.createElement;jg_dom=b&&!jg_ie&&"undefined"!=typeof b.appendChild&&"undefined"!=typeof a.document.createRange&&"undefined"!=typeof(c=a.document.createRange()).setStartBefore&&"undefined"!=typeof c.createContextualFragment;jg_fast=jg_ie&&a.document.all&&!a.opera;jg_moz=jg_dom&&"undefined"!=typeof b.style.MozOpacity;jg_ok=!(!jg_ie&&!jg_dom)}
function _pntCnvDom(){var a=this.wnd.document.createRange();a.setStartBefore(this.cnv);a=a.createContextualFragment(jg_fast?this._htmRpc():this.htm);this.cnv&&this.cnv.appendChild(a);this.htm=""}function _pntCnvIe(){this.cnv&&this.cnv.insertAdjacentHTML("BeforeEnd",jg_fast?this._htmRpc():this.htm);this.htm=""}function _pntDoc(){this.wnd.document.write(jg_fast?this._htmRpc():this.htm);this.htm=""}function _pntN(){}
function _mkDiv(a,b,c,d){this.htm+='<div style="position:absolute;left:'+a+"px;top:"+b+"px;width:"+c+"px;height:"+d+"px;clip:rect(0,"+c+"px,"+d+"px,0);background-color:"+this.color+(!jg_moz?";overflow:hidden":"")+';"></div>'}function _mkDivIe(a,b,c,d){this.htm+="%%"+this.color+";"+a+";"+b+";"+c+";"+d+";"}
function _mkDivPrt(a,b,c,d){this.htm+='<div style="position:absolute;border-left:'+c+"px solid "+this.color+";left:"+a+"px;top:"+b+"px;width:0px;height:"+d+"px;clip:rect(0,"+c+"px,"+d+"px,0);background-color:"+this.color+(!jg_moz?";overflow:hidden":"")+';"></div>'}var _regex=/%%([^;]+);([^;]+);([^;]+);([^;]+);([^;]+);/g;function _htmRpc(){return this.htm.replace(_regex,'<div style="overflow:hidden;position:absolute;background-color:$1;left:$2px;top:$3px;width:$4px;height:$5px"></div>\n')}
function _htmPrtRpc(){return this.htm.replace(_regex,'<div style="overflow:hidden;position:absolute;background-color:$1;left:$2px;top:$3px;width:$4px;height:$5px;border-left:$4px solid $1"></div>\n')}
function _mkLin(a,b,c,d){if(a>c)var e=c,f=d,c=a,d=b,a=e,b=f;var e=c-a,f=Math.abs(d-b),g=b,h=b>d?-1:1;if(e>=f){for(var i=f<<1,k=i-(e<<1),j=i-e,b=a;0<e;)--e,++a,0<j?(this._mkDiv(b,g,a-b,1),g+=h,j+=k,b=a):j+=i;this._mkDiv(b,g,c-b+1,1)}else if(i=e<<1,k=i-(f<<1),j=i-f,e=g,d<=b){for(;0<f;)--f,0<j?(this._mkDiv(a++,g,1,e-g+1),g+=h,j+=k,e=g):(g+=h,j+=i);this._mkDiv(c,d,1,e-d+1)}else{for(;0<f;)--f,g+=h,0<j?(this._mkDiv(a++,e,1,g-e),j+=k,e=g):j+=i;this._mkDiv(c,e,1,d-e+1)}}
function _mkLin2D(a,b,c,d){if(a>c)var e=c,f=d,c=a,d=b,a=e,b=f;var e=c-a,f=Math.abs(d-b),g=b,h=b>d?-1:1,i=this.stroke;if(e>=f){if(0<e&&0<i-3)var k=(i*e*Math.sqrt(1+f*f/(e*e))-e-(i>>1)*f)/e,k=(!(i-4)?Math.ceil(k):Math.round(k))+1;else k=i;for(var i=Math.ceil(i/2),j=f<<1,n=j-(e<<1),l=j-e,b=a;0<e;)--e,++a,0<l?(this._mkDiv(b,g,a-b+i,k),g+=h,l+=n,b=a):l+=j;this._mkDiv(b,g,c-b+i+1,k)}else if(0<i-3?(k=(i*f*Math.sqrt(1+e*e/(f*f))-(i>>1)*e-f)/f,k=(!(i-4)?Math.ceil(k):Math.round(k))+1):k=i,i=Math.round(i/2),
j=e<<1,n=j-(f<<1),l=j-f,e=g,d<=b){for(++i;0<f;)--f,0<l?(this._mkDiv(a++,g,k,e-g+i),g+=h,l+=n,e=g):(g+=h,l+=j);this._mkDiv(c,d,k,e-d+i)}else{for(;0<f;)--f,g+=h,0<l?(this._mkDiv(a++,e,k,g-e+i),l+=n,e=g):l+=j;this._mkDiv(c,e,k,d-e+i+1)}}
function _mkLinDott(a,b,c,d){if(a>c)var e=c,f=d,c=a,d=b,a=e,b=f;c-=a;e=Math.abs(d-b);f=b;b=b>d?-1:1;d=!0;if(c>=e)for(var g=e<<1,h=g-(c<<1),i=g-c;0<c;)--c,d&&this._mkDiv(a,f,1,1),d=!d,0<i?(f+=b,i+=h):i+=g,++a;else{g=c<<1;h=g-(e<<1);for(i=g-e;0<e;)--e,d&&this._mkDiv(a,f,1,1),d=!d,f+=b,0<i?(++a,i+=h):i+=g}d&&this._mkDiv(a,f,1,1)}
function _mkOv(a,b,c,d){for(var e=++c>>1,f=++d>>1,c=c&1,d=d&1,a=a+e,b=b+f,g=0,h=f,i=0,k=f,j=e*e<<1,n=j<<1,l=f*f<<1,m=l<<1,o=(j>>1)*(1-(f<<1))+l,f=(l>>1)-j*((f<<1)-1),q,p;0<h;)0>o?(o+=l*((g<<1)+3),f+=m*++g):0>f?(o+=l*((g<<1)+3)-n*(h-1),f+=m*++g-j*((h--<<1)-3),q=g-i,p=k-h,q&2&&p&2?(this._mkOvQds(a,b,g-2,h+2,1,1,c,d),this._mkOvQds(a,b,g-1,h+1,1,1,c,d)):this._mkOvQds(a,b,g-1,k,q,p,c,d),i=g,k=h):(f-=j*((h<<1)-3),o-=n*--h);q=e-i+1;p=(k<<1)+d;h=b-k;this._mkDiv(a-e,h,q,p);this._mkDiv(a+i+c-1,h,q,p)}
function _mkOv2D(a,b,c,d){var e=this.stroke,c=c+(e+1),d=d+(e+1),f=c>>1,g=d>>1,h=c&1,i=d&1,a=a+f,b=b+g,k=0,j=g,n=f*f<<1,l=n<<1,m=g*g<<1,o=m<<1,q=(n>>1)*(1-(g<<1))+m,p=(m>>1)-n*((g<<1)-1);if(0>e-4&&(!(e-2)||0<c-51&&0<d-51)){for(var r=0;0<j;)0>q?(q+=m*((k<<1)+3),p+=o*++k):0>p?(q+=m*((k<<1)+3)-l*(j-1),p+=o*++k-n*((j--<<1)-3),c=k-r,d=g-j,c-1?(c=c+1+(e&1),d=e):d-1?(c=e,d+=1+(e&1)):c=d=e,this._mkOvQds(a,b,k-1,g,c,d,h,i),r=k,g=j):(p-=n*((j<<1)-3),q-=l*--j);this._mkDiv(a-f,b-g,e,(g<<1)+i);this._mkDiv(a+f+
h-e,b-g,e,(g<<1)+i)}else{var c=c-(e<<1)>>1,r=d-(e<<1)>>1,t=0,s=r,u=c*c<<1,v=u<<1,y=r*r<<1,z=y<<1,w=(u>>1)*(1-(r<<1))+y,x=(y>>1)-u*((r<<1)-1),e=[],d=[],c=[];e[0]=0;d[0]=g;for(c[0]=r-1;0<j;)if(0>q?(e[e.length]=k,d[d.length]=j,q+=m*((k<<1)+3),p+=o*++k):0>p?(e[e.length]=k,q+=m*((k<<1)+3)-l*(j-1),p+=o*++k-n*((j--<<1)-3),d[d.length]=j):(p-=n*((j<<1)-3),q-=l*--j),0<s)0>w?(w+=y*((t<<1)+3),x+=z*++t,c[c.length]=s-1):0>x?(w+=y*((t<<1)+3)-v*(s-1),x+=z*++t-u*((s--<<1)-3),c[c.length]=s-1):(x-=u*((s<<1)-3),w-=v*
--s,c[c.length-1]--);r=-h;j=c[0];n=e.length;for(l=0;l<n;l++)if("undefined"!=typeof c[l]){if(c[l]<j||d[l]<g)k=e[l],this._mkOvQds(a,b,k,g,k-r,g-j,h,i),r=k,g=d[l],j=c[l]}else k=e[l],this._mkDiv(a-k,b-g,1,(g<<1)+i),this._mkDiv(a+r+h,b-g,1,(g<<1)+i),r=k,g=d[l];this._mkDiv(a-f,b-g,1,(g<<1)+i);this._mkDiv(a+r+h,b-g,1,(g<<1)+i)}}
function _mkOvDott(a,b,c,d){for(var e=++c>>1,f=++d>>1,c=c&1,d=d&1,g=d^1,a=a+e,b=b+f,h=0,i=f,e=e*e<<1,k=e<<1,j=f*f<<1,n=j<<1,l=(e>>1)*(1-(f<<1))+j,f=(j>>1)-e*((f<<1)-1),m=!0;0<i;)0>l?(l+=j*((h<<1)+3),f+=n*++h):0>f?(l+=j*((h<<1)+3)-k*(i-1),f+=n*++h-e*((i--<<1)-3)):(f-=e*((i<<1)-3),l-=k*--i),m&&i>=g&&this._mkOvQds(a,b,h,i,1,1,c,d),m=!m}function _mkRect(a,b,c,d){var e=this.stroke;this._mkDiv(a,b,c,e);this._mkDiv(a+c,b,e,d);this._mkDiv(a,b+d,c+e,e);this._mkDiv(a,b+e,e,d-e)}
function _mkRectDott(a,b,c,d){this.drawLine(a,b,a+c,b);this.drawLine(a+c,b,a+c,b+d);this.drawLine(a,b+d,a+c,b+d);this.drawLine(a,b,a,b+d)}function jsgFont(){this.PLAIN="font-weight:normal;";this.BOLD="font-weight:bold;";this.ITALIC="font-style:italic;";this.BOLD_ITALIC=this.ITALIC_BOLD=this.ITALIC+this.BOLD}var Font=new jsgFont;function jsgStroke(){this.DOTTED=-1}var Stroke=new jsgStroke;
function jsGraphics(a,b){this.setColor=function(a){this.color=a.toLowerCase()};this.setStroke=function(a){this.stroke=a;a+1?(0<a-1?(this.drawLine=_mkLin2D,this._mkOv=_mkOv2D):(this.drawLine=_mkLin,this._mkOv=_mkOv),this.drawRect=_mkRect):(this.drawLine=_mkLinDott,this._mkOv=_mkOvDott,this.drawRect=_mkRectDott)};this.setPrintable=function(a){this.printable=a;jg_fast?(this._mkDiv=_mkDivIe,this._htmRpc=a?_htmPrtRpc:_htmRpc):this._mkDiv=a?_mkDivPrt:_mkDiv};this.setFont=function(a,b,e){this.ftFam=a;this.ftSz=
b;this.ftSty=e||Font.PLAIN};this.drawPolyline=this.drawPolyLine=function(a,b){for(var e=a.length-1;e;)--e,this.drawLine(a[e],b[e],a[e+1],b[e+1])};this.fillRect=function(a,b,e,f){this._mkDiv(a,b,e,f)};this.drawPolygon=function(a,b){this.drawPolyline(a,b);this.drawLine(a[a.length-1],b[a.length-1],a[0],b[0])};this.drawEllipse=this.drawOval=function(a,b,e,f){this._mkOv(a,b,e,f)};this.fillEllipse=this.fillOval=function(a,b,e,f){var g=e>>1,h=f>>1,i=e&1,f=f&1,a=a+g,b=b+h,k=0,j=h,n=h,l=g*g<<1,m=l<<1,o=h*
h<<1,q=o<<1,p=(l>>1)*(1-(h<<1))+o,h=(o>>1)-l*((h<<1)-1),r,t,s;if(e)for(;0<j;)0>p?(p+=o*((k<<1)+3),h+=q*++k):0>h?(p+=o*((k<<1)+3)-m*(j-1),r=a-k,t=(k<<1)+i,h+=q*++k-l*((j--<<1)-3),s=n-j,this._mkDiv(r,b-n,t,s),this._mkDiv(r,b+j+f,t,s),n=j):(h-=l*((j<<1)-3),p-=m*--j);this._mkDiv(a-g,b-n,e,(n<<1)+f)};this.fillArc=function(a,b,e,f,g,h){var i=e>>1,k=f>>1,e=e&1|(f&1)<<16,a=a+i,b=b+k,f=0,j=k,n=f,l=j,m=i*i<<1,o=m<<1,q=k*k<<1,p=q<<1,r=(m>>1)*(1-(k<<1))+q,t=(q>>1)-m*((k<<1)-1),s=1<<(Math.floor((g%=360)/180)<<
3)|2<<(Math.floor((h%=360)/180)<<3)|(g>=h)<<16,u=Array(k+1),v=Array(k+1),g=g*(Math.PI/180),h=h*(Math.PI/180),n=a+Math.round(i*Math.cos(g)),g=b+Math.round(-k*Math.sin(g));_mkLinVirt(u,a,b,n,g);i=a+Math.round(i*Math.cos(h));h=b+Math.round(-k*Math.sin(h));for(_mkLinVirt(v,a,b,i,h);0<j;)if(0>r)r+=q*((f<<1)+3),t+=p*++f;else if(0>t)r+=q*((f<<1)+3)-o*(j-1),n=f,t+=p*++f-m*((j--<<1)-3),this._mkArcDiv(n,j,l,a,b,e,u,v,s),l=j;else if(t-=m*((j<<1)-3),r-=o*--j,j&&(u[j]!=u[j-1]||v[j]!=v[j-1]))this._mkArcDiv(f,j,
l,a,b,e,u,v,s),l=j;this._mkArcDiv(f,0,l,a,b,e,u,v,s);e>>16&&(s>>16?(h=g<=b||h>b?a-f:a,this._mkDiv(h,b,f+a-h+(e&65535),1)):s&1&&h>b&&this._mkDiv(a-f,b,f,1))};this.fillPolygon=function(a,b){var e,f,g,h,i,k,j,n,l,m=a.length;if(m){f=b[0];g=b[0];for(e=1;e<m;e++)b[e]<f&&(f=b[e]),b[e]>g&&(g=b[e]);for(;f<=g;f++){var o=[];for(e=l=0;e<m;e++){e?(h=e-1,n=e):(h=m-1,n=0);i=b[h];j=b[n];if(i<j)h=a[h],k=a[n];else if(i>j)j=b[h],i=b[n],k=a[h],h=a[n];else continue;f>=i&&f<j?o[l++]=Math.round((f-i)*(k-h)/(j-i)+h):f==
g&&(f>i&&f<=j)&&(o[l++]=Math.round((f-i)*(k-h)/(j-i)+h))}o.sort(_CompInt);for(e=0;e<l;e+=2)this._mkDiv(o[e],f,o[e+1]-o[e]+1,1)}}};this.drawString=function(a,b,e){this.htm+='<div style="position:absolute;white-space:nowrap;left:'+b+"px;top:"+e+"px;font-family:"+this.ftFam+";font-size:"+this.ftSz+";color:"+this.color+";"+this.ftSty+'">'+a+"</div>"};this.drawStringRect=function(a,b,e,f,g,h,i){this.htm+="<div "+("undefined"!=typeof i?'class="'+i+'" ':"")+' style="position:absolute;overflow:hidden;left:'+
b+"px;top:"+e+"px;width:"+f+"px;height:"+g+"px;text-align:"+h+";font-family:"+this.ftFam+";font-size:"+this.ftSz+";line-height: 100%;color:#000000;"+this.ftSty+'"><span style="display:inline-block; vertical-align:middle">'+a+"</span></div>"};this.drawImage=function(a,b,e,f,g,h){this.htm+='<div style="position:absolute;left:'+b+"px;top:"+e+"px;"+(f?"width:"+f+"px;":"")+(g?"height:"+g+"px;":"")+'"><img src="'+a+'"'+(f?' width="'+f+'"':"")+(g?' height="'+g+'"':"")+(h?" "+h:"")+"></div>"};this.clear=
function(){this.htm="";this.cnv&&(this.cnv.innerHTML="")};this._mkOvQds=function(a,b,e,f,g,h,i,k){var j=a-e,a=a+e+i-g,e=b-f,b=b+f+k-h;a>j+g?(this._mkDiv(a,e,g,h),this._mkDiv(a,b,g,h)):g=a-j+g;this._mkDiv(j,e,g,h);this._mkDiv(j,b,g,h)};this._mkArcDiv=function(a,b,e,f,g,h,i,k,j){var n=f+a+(h&65535),e=e-b,l,m;e||(e=1);a=f-a;if(j&16711680){f=g-b-e;if(j&255){if(j&2&&(l=Math.max(a,k[b]),m=n-l,0<m&&this._mkDiv(l,f,m,e)),j&1)m=Math.min(n,i[b]),m-=a,0<m&&this._mkDiv(a,f,m,e)}else this._mkDiv(a,f,n-a,e);f=
g+b+(h>>16);if(j&65280){if(j&256&&(l=Math.max(a,i[b]),m=n-l,0<m&&this._mkDiv(l,f,m,e)),j&512)m=Math.min(n,k[b]),m-=a,0<m&&this._mkDiv(a,f,m,e)}else this._mkDiv(a,f,n-a,e)}else if(j&255&&(l=j&2?Math.max(a,k[b]):a,m=j&1?Math.min(n,i[b]):n,m-=l,0<m&&this._mkDiv(l,g-b-e,m,e)),j&65280)l=j&256?Math.max(a,i[b]):a,m=j&512?Math.min(n,k[b]):n,m-=l,0<m&&this._mkDiv(l,g+b+(h>>16),m,e)};this.setStroke(1);this.setFont("verdana,geneva,helvetica,sans-serif","12px",Font.PLAIN);this.color="#000000";this.htm="";this.wnd=
b||window;jg_ok||_chkDHTM(this.wnd);jg_ok?a?(this.cont="string"==typeof a?document.all?this.wnd.document.all[a]||null:document.getElementById?this.wnd.document.getElementById(a)||null:null:a==window.document?document.getElementsByTagName("body")[0]:a,this.cnv=this.wnd.document.createElement("div"),this.cnv.style.fontSize=0,this.cont.appendChild(this.cnv),this.paint=jg_dom?_pntCnvDom:_pntCnvIe):this.paint=_pntDoc:this.paint=_pntN;this.setPrintable(!1)}
function _mkLinVirt(a,b,c,d,e){var f=Math.abs(d-b),e=Math.abs(e-c),c=b,d=b>d?-1:1,g,b=0;if(f>=e){var h=e<<1,i=h-(f<<1);for(g=h-f;0<f;)--f,0<g?(a[b++]=c,g+=i):g+=h,c+=d}else{h=f<<1;i=h-(e<<1);for(g=h-e;0<e;)--e,a[b++]=c,0<g?(c+=d,g+=i):g+=h}f=a.length;for(b=f-b;b;)a[f-b--]=c}function _CompInt(a,b){return a-b}var MooTools={version:"1.11"};function $defined(a){return void 0!=a}
function $type(a){if(!$defined(a))return!1;if(a.htmlElement)return"element";var b=typeof a;if("object"==b&&a.nodeName)switch(a.nodeType){case 1:return"element";case 3:return/\S/.test(a.nodeValue)?"textnode":"whitespace"}if("object"==b||"function"==b){switch(a.constructor){case Array:return"array";case RegExp:return"regexp";case Class:return"class"}if("number"==typeof a.length){if(a.item)return"collection";if(a.callee)return"arguments"}}return b}
function $merge(){for(var a={},b=0;b<arguments.length;b++)for(var c in arguments[b]){var d=arguments[b][c],e=a[c];a[c]=e&&"object"==$type(d)&&"object"==$type(e)?$merge(e,d):d}return a}var $extend=function(){var a=arguments;a[1]||(a=[this,a[0]]);for(var b in a[1])a[0][b]=a[1][b];return a[0]},$native=function(){for(var a=0,b=arguments.length;a<b;a++)arguments[a].extend=function(a){for(var b in a)this.prototype[b]||(this.prototype[b]=a[b]),this[b]||(this[b]=$native.generic(b))}};
$native.generic=function(a){return function(b){return this.prototype[a].apply(b,Array.prototype.slice.call(arguments,1))}};$native(Function,Array,String,Number);function $chk(a){return!!(a||0===a)}function $pick(a,b){return $defined(a)?a:b}function $random(a,b){return Math.floor(Math.random()*(b-a+1)+a)}function $time(){return(new Date).getTime()}function $clear(a){clearTimeout(a);clearInterval(a);return null}
var Abstract=function(a){a=a||{};a.extend=$extend;return a},Window=new Abstract(window),Document=new Abstract(document);document.head=document.getElementsByTagName("head")[0];window.xpath=!!document.evaluate;window.ActiveXObject?window.ie=window[window.XMLHttpRequest?"ie7":"ie6"]=!0:document.childNodes&&!document.all&&!navigator.taintEnabled?window.webkit=window[window.xpath?"webkit420":"webkit419"]=!0:null!=document.getBoxObjectFor&&(window.gecko=!0);window.khtml=window.webkit;Object.extend=$extend;
if("undefined"==typeof HTMLElement){var HTMLElement=function(){};window.webkit&&document.createElement("iframe");HTMLElement.prototype=window.webkit?window["[[DOMElement.prototype]]"]:{}}HTMLElement.prototype.htmlElement=function(){};if(window.ie6)try{document.execCommand("BackgroundImageCache",!1,!0)}catch(e$$10){}
var Class=function(a){var b=function(){return arguments[0]!==null&&this.initialize&&$type(this.initialize)=="function"?this.initialize.apply(this,arguments):this};$extend(b,this);b.prototype=a;b.constructor=Class;return b};Class.empty=function(){};Class.prototype={extend:function(a){var b=new this(null),c;for(c in a)b[c]=Class.Merge(b[c],a[c]);return new Class(b)},implement:function(){for(var a=0,b=arguments.length;a<b;a++)$extend(this.prototype,arguments[a])}};
Class.Merge=function(a,b){if(a&&a!=b){var c=$type(b);if(c!=$type(a))return b;switch(c){case "function":c=function(){this.parent=arguments.callee.parent;return b.apply(this,arguments)};c.parent=a;return c;case "object":return $merge(a,b)}}return b};
Array.extend({forEach:function(a,b){for(var c=0,d=this.length;c<d;c++)a.call(b,this[c],c,this)},filter:function(a,b){for(var c=[],d=0,e=this.length;d<e;d++)a.call(b,this[d],d,this)&&c.push(this[d]);return c},map:function(a,b){for(var c=[],d=0,e=this.length;d<e;d++)c[d]=a.call(b,this[d],d,this);return c},every:function(a,b){for(var c=0,d=this.length;c<d;c++)if(!a.call(b,this[c],c,this))return false;return true},some:function(a,b){for(var c=0,d=this.length;c<d;c++)if(a.call(b,this[c],c,this))return true;
return false},indexOf:function(a,b){for(var c=this.length,d=b<0?Math.max(0,c+b):b||0;d<c;d++)if(this[d]===a)return d;return-1},copy:function(a,b){a=a||0;a<0&&(a=this.length+a);for(var b=b||this.length-a,c=[],d=0;d<b;d++)c[d]=this[a++];return c},remove:function(a){for(var b=0,c=this.length;b<c;)if(this[b]===a){this.splice(b,1);c--}else b++;return this},contains:function(a,b){return this.indexOf(a,b)!=-1},associate:function(a){for(var b={},c=Math.min(this.length,a.length),d=0;d<c;d++)b[a[d]]=this[d];
return b},extend:function(a){for(var b=0,c=a.length;b<c;b++)this.push(a[b]);return this},merge:function(a){for(var b=0,c=a.length;b<c;b++)this.include(a[b]);return this},include:function(a){this.contains(a)||this.push(a);return this},getRandom:function(){return this[$random(0,this.length-1)]||null},getLast:function(){return this[this.length-1]||null}});Array.prototype.each=Array.prototype.forEach;Array.each=Array.forEach;function $A(a){return Array.copy(a)}
function $each(a,b,c){if(a&&typeof a.length=="number"&&$type(a)!="object")Array.forEach(a,b,c);else for(var d in a)b.call(c||a,a[d],d)}Array.prototype.test=Array.prototype.contains;
String.extend({test:function(a,b){return($type(a)=="string"?RegExp(a,b):a).test(this)},toInt:function(){return parseInt(this,10)},toFloat:function(){return parseFloat(this)},camelCase:function(){return this.replace(/-\D/g,function(a){return a.charAt(1).toUpperCase()})},hyphenate:function(){return this.replace(/\w[A-Z]/g,function(a){return a.charAt(0)+"-"+a.charAt(1).toLowerCase()})},capitalize:function(){return this.replace(/\b[a-z]/g,function(a){return a.toUpperCase()})},trim:function(){return this.replace(/^\s+|\s+$/g,
"")},clean:function(){return this.replace(/\s{2,}/g," ").trim()},rgbToHex:function(a){var b=this.match(/\d{1,3}/g);return b?b.rgbToHex(a):false},hexToRgb:function(a){var b=this.match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/);return b?b.slice(1).hexToRgb(a):false},contains:function(a,b){return b?(b+this+b).indexOf(b+a+b)>-1:this.indexOf(a)>-1},escapeRegExp:function(){return this.replace(/([.*+?^${}()|[\]\/\\])/g,"\\$1")}});
Array.extend({rgbToHex:function(a){if(this.length<3)return false;if(this.length==4&&this[3]==0&&!a)return"transparent";for(var b=[],c=0;c<3;c++){var d=(this[c]-0).toString(16);b.push(d.length==1?"0"+d:d)}return a?b:"#"+b.join("")},hexToRgb:function(a){if(this.length!=3)return false;for(var b=[],c=0;c<3;c++)b.push(parseInt(this[c].length==1?this[c]+this[c]:this[c],16));return a?b:"rgb("+b.join(",")+")"}});
Function.extend({create:function(a){var b=this,a=$merge({bind:b,event:false,arguments:null,delay:false,periodical:false,attempt:false},a);if($chk(a.arguments)&&$type(a.arguments)!="array")a.arguments=[a.arguments];return function(c){var d;if(a.event){c=c||window.event;d=[a.event===true?c:new a.event(c)];a.arguments&&d.extend(a.arguments)}else d=a.arguments||arguments;var e=function(){return b.apply($pick(a.bind,b),d)};if(a.delay)return setTimeout(e,a.delay);if(a.periodical)return setInterval(e,a.periodical);
if(a.attempt)try{return e()}catch(f){return false}return e()}},pass:function(a,b){return this.create({arguments:a,bind:b})},attempt:function(a,b){return this.create({arguments:a,bind:b,attempt:true})()},bind:function(a,b){return this.create({bind:a,arguments:b})},bindAsEventListener:function(a,b){return this.create({bind:a,event:true,arguments:b})},delay:function(a,b,c){return this.create({delay:a,bind:b,arguments:c})()},periodical:function(a,b,c){return this.create({periodical:a,bind:b,arguments:c})()}});
Number.extend({toInt:function(){return parseInt(this)},toFloat:function(){return parseFloat(this)},limit:function(a,b){return Math.min(b,Math.max(a,this))},round:function(a){a=Math.pow(10,a||0);return Math.round(this*a)/a},times:function(a){for(var b=0;b<this;b++)a(b)}});
var Element=new Class({initialize:function(a,b){if($type(a)=="string"){if(window.ie&&b&&(b.name||b.type)){var c=b.name?' name="'+b.name+'"':"",d=b.type?' type="'+b.type+'"':"";delete b.name;delete b.type;a="<"+a+c+d+">"}a=document.createElement(a)}a=$(a);return!b||!a?a:a.set(b)}}),Elements=new Class({initialize:function(a){return a?$extend(a,this):this}});Elements.extend=function(a){for(var b in a){this.prototype[b]=a[b];this[b]=$native.generic(b)}};
function $(a){if(!a)return null;if(a.htmlElement)return Garbage.collect(a);if([window,document].contains(a))return a;var b=$type(a);if(b=="string")b=(a=document.getElementById(a))?"element":false;if(b!="element")return null;if(a.htmlElement)return Garbage.collect(a);if(["object","embed"].contains(a.tagName.toLowerCase()))return a;$extend(a,Element.prototype);a.htmlElement=function(){};return Garbage.collect(a)}document.getElementsBySelector=document.getElementsByTagName;
function $$(){for(var a=[],b=0,c=arguments.length;b<c;b++){var d=arguments[b];switch($type(d)){case "element":a.push(d);case "boolean":break;case false:break;case "string":d=document.getElementsBySelector(d,true);default:a.extend(d)}}return $$.unique(a)}$$.unique=function(a){for(var b=[],c=0,d=a.length;c<d;c++)if(!a[c].$included){var e=$(a[c]);if(e&&!e.$included){e.$included=true;b.push(e)}}a=0;for(c=b.length;a<c;a++)b[a].$included=null;return new Elements(b)};
Elements.Multi=function(a){return function(){for(var b=arguments,c=[],d=true,e=0,f=this.length,g;e<f;e++){g=this[e][a].apply(this[e],b);$type(g)!="element"&&(d=false);c.push(g)}return d?$$.unique(c):c}};Element.extend=function(a){for(var b in a){HTMLElement.prototype[b]=a[b];Element.prototype[b]=a[b];Element[b]=$native.generic(b);Elements.prototype[Array.prototype[b]?b+"Elements":b]=Elements.Multi(b)}};
Element.extend({set:function(a){for(var b in a){var c=a[b];switch(b){case "styles":this.setStyles(c);break;case "events":this.addEvents&&this.addEvents(c);break;case "properties":this.setProperties(c);break;default:this.setProperty(b,c)}}return this},inject:function(a,b){a=$(a);switch(b){case "before":a.parentNode.insertBefore(this,a);break;case "after":var c=a.getNext();c?a.parentNode.insertBefore(this,c):a.parentNode.appendChild(this);break;case "top":if(c=a.firstChild){a.insertBefore(this,c);break}default:a.appendChild(this)}return this},
injectBefore:function(a){return this.inject(a,"before")},injectAfter:function(a){return this.inject(a,"after")},injectInside:function(a){return this.inject(a,"bottom")},injectTop:function(a){return this.inject(a,"top")},adopt:function(){var a=[];$each(arguments,function(b){a=a.concat(b)});$$(a).inject(this);return this},remove:function(){return this.parentNode.removeChild(this)},clone:function(a){a=$(this.cloneNode(a!==false));if(!a.$events)return a;a.$events={};for(var b in this.$events)a.$events[b]=
{keys:$A(this.$events[b].keys),values:$A(this.$events[b].values)};return a.removeEvents()},replaceWith:function(a){a=$(a);this.parentNode.replaceChild(a,this);return a},appendText:function(a){this.appendChild(document.createTextNode(a));return this},hasClass:function(a){return this.className.contains(a," ")},addClass:function(a){if(!this.hasClass(a))this.className=(this.className+" "+a).clean();return this},removeClass:function(a){this.className=this.className.replace(RegExp("(^|\\s)"+a+"(?:\\s|$)"),
"$1").clean();return this},toggleClass:function(a){return this.hasClass(a)?this.removeClass(a):this.addClass(a)},setStyle:function(a,b){switch(a){case "opacity":return this.setOpacity(parseFloat(b));case "float":a=window.ie?"styleFloat":"cssFloat"}a=a.camelCase();switch($type(b)){case "number":["zIndex","zoom"].contains(a)||(b=b+"px");break;case "array":b="rgb("+b.join(",")+")"}this.style[a]=b;return this},setStyles:function(a){switch($type(a)){case "object":Element.setMany(this,"setStyle",a);break;
case "string":this.style.cssText=a}return this},setOpacity:function(a){if(a==0){if(this.style.visibility!="hidden")this.style.visibility="hidden"}else if(this.style.visibility!="visible")this.style.visibility="visible";if(!this.currentStyle||!this.currentStyle.hasLayout)this.style.zoom=1;if(window.ie)this.style.filter=a==1?"":"alpha(opacity="+a*100+")";this.style.opacity=this.$tmp.opacity=a;return this},getStyle:function(a){var a=a.camelCase(),b=this.style[a];if(!$chk(b)){if(a=="opacity")return this.$tmp.opacity;
var b=[],c;for(c in Element.Styles)if(a==c){Element.Styles[c].each(function(a){a=this.getStyle(a);b.push(parseInt(a)?a:"0px")},this);return a=="border"?b.every(function(a){return a==b[0]})?b[0]:false:b.join(" ")}if(a.contains("border")){if(Element.Styles.border.contains(a))return["Width","Style","Color"].map(function(b){return this.getStyle(a+b)},this).join(" ");if(Element.borderShort.contains(a))return["Top","Right","Bottom","Left"].map(function(b){return this.getStyle("border"+b+a.replace("border",
""))},this).join(" ")}document.defaultView?b=document.defaultView.getComputedStyle(this,null).getPropertyValue(a.hyphenate()):this.currentStyle&&(b=this.currentStyle[a])}window.ie&&(b=Element.fixStyle(a,b,this));return b&&a.test(/color/i)&&b.contains("rgb")?b.split("rgb").splice(1,4).map(function(a){return a.rgbToHex()}).join(" "):b},getStyles:function(){return Element.getMany(this,"getStyle",arguments)},walk:function(a,b){for(var a=a+"Sibling",c=b?this[b]:this[a];c&&$type(c)!="element";)c=c[a];return $(c)},
getPrevious:function(){return this.walk("previous")},getNext:function(){return this.walk("next")},getFirst:function(){return this.walk("next","firstChild")},getLast:function(){return this.walk("previous","lastChild")},getParent:function(){return $(this.parentNode)},getChildren:function(){return $$(this.childNodes)},hasChild:function(a){return!!$A(this.getElementsByTagName("*")).contains(a)},getProperty:function(a){var b=Element.Properties[a];if(b)return this[b];b=Element.PropertiesIFlag[a]||0;if(!window.ie||
b)return this.getAttribute(a,b);return(a=this.attributes[a])?a.nodeValue:null},removeProperty:function(a){var b=Element.Properties[a];b?this[b]="":this.removeAttribute(a);return this},getProperties:function(){return Element.getMany(this,"getProperty",arguments)},setProperty:function(a,b){var c=Element.Properties[a];c?this[c]=b:this.setAttribute(a,b);return this},setProperties:function(a){return Element.setMany(this,"setProperty",a)},setHTML:function(){this.innerHTML=$A(arguments).join("");return this},
setText:function(a){var b=this.getTag();if(["style","script"].contains(b)){if(window.ie){b=="style"?this.styleSheet.cssText=a:b=="script"&&this.setProperty("text",a);return this}this.removeChild(this.firstChild);return this.appendText(a)}this[$defined(this.innerText)?"innerText":"textContent"]=a;return this},getText:function(){var a=this.getTag();if(["style","script"].contains(a))if(window.ie){if(a=="style")return this.styleSheet.cssText;if(a=="script")return this.getProperty("text")}else return this.innerHTML;
return $pick(this.innerText,this.textContent)},getTag:function(){return this.tagName.toLowerCase()},empty:function(){Garbage.trash(this.getElementsByTagName("*"));return this.setHTML("")}});
Element.fixStyle=function(a,b,c){if($chk(parseInt(b)))return b;if(["height","width"].contains(a)){var d=0;(a=="width"?["left","right"]:["top","bottom"]).each(function(a){d=d+(c.getStyle("border-"+a+"-width").toInt()+c.getStyle("padding-"+a).toInt())});return c["offset"+a.capitalize()]-d+"px"}return a.test(/border(.+)Width|margin|padding/)?"0px":b};Element.Styles={border:[],padding:[],margin:[]};["Top","Right","Bottom","Left"].each(function(a){for(var b in Element.Styles)Element.Styles[b].push(b+a)});
Element.borderShort=["borderWidth","borderStyle","borderColor"];Element.getMany=function(a,b,c){var d={};$each(c,function(c){d[c]=a[b](c)});return d};Element.setMany=function(a,b,c){for(var d in c)a[b](d,c[d]);return a};
Element.Properties=new Abstract({"class":"className","for":"htmlFor",colspan:"colSpan",rowspan:"rowSpan",accesskey:"accessKey",tabindex:"tabIndex",maxlength:"maxLength",readonly:"readOnly",frameborder:"frameBorder",value:"value",disabled:"disabled",checked:"checked",multiple:"multiple",selected:"selected"});Element.PropertiesIFlag={href:2,src:2};
Element.Methods={Listeners:{addListener:function(a,b){this.addEventListener?this.addEventListener(a,b,false):this.attachEvent("on"+a,b);return this},removeListener:function(a,b){this.removeEventListener?this.removeEventListener(a,b,false):this.detachEvent("on"+a,b);return this}}};window.extend(Element.Methods.Listeners);document.extend(Element.Methods.Listeners);Element.extend(Element.Methods.Listeners);
var Garbage={elements:[],collect:function(a){if(!a.$tmp){Garbage.elements.push(a);a.$tmp={opacity:1}}return a},trash:function(a){for(var b=0,c=a.length,d;b<c;b++)if((d=a[b])&&d.$tmp){d.$events&&d.fireEvent("trash").removeEvents();for(var e in d.$tmp)d.$tmp[e]=null;for(var f in Element.prototype)d[f]=null;Garbage.elements[Garbage.elements.indexOf(d)]=null;d.htmlElement=d.$tmp=d=null}Garbage.elements.remove(null)},empty:function(){Garbage.collect(window);Garbage.collect(document);Garbage.trash(Garbage.elements)}};
window.addListener("beforeunload",function(){window.addListener("unload",Garbage.empty);window.ie&&window.addListener("unload",CollectGarbage)});
var MooCanvas=new Class({initialize:function(a,b){var c;if($type(a)=="string"){b=$merge({width:300,height:150},b,{id:a});c=new Element("canvas",b);if(!c.getContext){if(!CanvasRenderingContext2D.cssFixed){document.createStyleSheet().cssText="canvas{display:inline-block;overflow:hidden;text-align:left;cursor:default;}v\\:*{behavior:url(#default#VML)}o\\:*{behavior:url(#default#VML)}";CanvasRenderingContext2D.cssFixed=true}c.set({styles:{width:b.width,height:b.height,display:"inline-block",overflow:"hidden"},
getContext:function(){return this.context=this.context||new CanvasRenderingContext2D(c)}})}}return c}}),CanvasRenderingContext2D=new Class({initialize:function(a){this.parent=a;this.fragment=document.createDocumentFragment();this.element=new Element("div",{styles:{width:a.clientWidth||a.width,height:a.clientHeight||a.height,overflow:"hidden",position:"absolute"}});this.fragment.appendChild(this.element);this.m=[[1,0,0],[0,1,0],[0,0,1]];this.rot=0;this.state=[];this.path=[];this.delay=30;this.max=
10;this.i=0;this.Z=10;this.Z2=this.Z/2;this.arcScaleY=this.arcScaleX=1;this.currentY=this.currentX=0;this.miterLimit=this.Z*1},lineWidth:1,strokeStyle:"#000",fillStyle:"#fff",globalAlpha:1,globalCompositeOperation:"source-over",lineCap:"butt",lineJoin:"miter",shadowBlur:0,shadowColor:"#000",shadowOffsetX:0,shadowOffsetY:0});
CanvasRenderingContext2D.implement({beginPath:function(){this.path=[];this.moved=false},moveTo:function(a,b){this.path.push("m",this.coord(a,b));this.currentX=a;this.currentY=b;this.moved=true},closePath:function(){this.path.push("x")},lineTo:function(a,b){this.path.push(this.moved?"l":",",this.coord(a,b));this.currentX=a;this.currentY=b;this.moved=false},quadraticCurveTo:function(a,b,c,d){a=2*a;b=2*b;this.bezierCurveTo((a+this.currentX)/3,(b+this.currentY)/3,(a+c)/3,(b+d)/3,c,d)},bezierCurveTo:function(a,
b,c,d,e,f){this.path.push(" c ",this.coord(a,b),",",this.coord(c,d),",",this.coord(e,f));this.currentX=e;this.currentY=f},arcTo:function(){},arc:function(a,b,c,d,e,f){this.rot===0&&(c=c*this.Z);var g=Math.cos(d)*c,h=Math.sin(d)*c,i=Math.cos(e)*c,k=Math.sin(e)*c;if(this.rot!==0){var j=Math.PI/24;this.lineTo(g+a,h+b);if(f)for(d<e&&(d=d+2*Math.PI);d-j>e;)this.lineTo(a+Math.cos(d=d-j)*c,b+Math.sin(d)*c);else for(e<d&&(e=e+2*Math.PI);d+j<e;)this.lineTo(a+Math.cos(d=d+j)*c,b+Math.sin(d)*c);this.lineTo(i+
a,k+b)}else{g==i&&!f&&(g=g+0.125);d=this.getCoords(a,b);this.path.push(f?"at ":"wa ",Math.round(d.x-this.arcScaleX*c)+","+Math.round(d.y-this.arcScaleY*c)," ",Math.round(d.x+this.arcScaleX*c)+","+Math.round(d.y+this.arcScaleY*c)," ",this.coord(g+a-this.Z2,h+b-this.Z2)," ",this.coord(i+a-this.Z2,k+b-this.Z2))}},rect:function(a,b,c,d){this.moveTo(a,b);this.lineTo(a+c,b);this.lineTo(a+c,b+d);this.lineTo(a,b+d);this.closePath()},fill:function(){this.stroke(true)},stroke:function(a){if(this.path.length){var b;
if(a)b=[1E3,"<v:fill "+this.processColorObject(this.fillStyle)+"></v:fill>"];else{b=this.processColor(this.strokeStyle);b=[10,'<v:stroke endcap="'+(this.lineCap=="butt"?"flat":this.lineCap)+'" joinstyle="'+this.lineJoin+'" color="'+b.color+'" opacity="'+b.opacity+'"/>']}this.element.insertAdjacentHTML("beforeEnd",'<v:shape path="'+this.path.join("")+'e" stroked="'+!a+'" '+(!a?'strokeweight="'+0.8*this.lineWidth*this.m[0][0]+'" ':"")+'filled="'+!!a+'" coordsize="'+this.Z*b[0]+","+this.Z*b[0]+'" style="width:'+
b[0]+"px; height:"+b[0]+'px; position: absolute;">'+b[1]+"</v:shape>");this.parent.appendChild(this.fragment);if(a&&this.fillStyle.img)this.element.getLast().fill.alignshape=false;this.path=[]}},clip:function(){},isPointInPath:function(){},processColor:function(a){var b=this.globalAlpha;if(a.substr(0,3)=="rgb"){a.charAt(3)=="a"&&(b=b*a.match(/([\d.]*)\)$/)[1]);a=a.rgbToHex()}return{color:a,opacity:b}},processColorObject:function(a){var b="";if(a.addColorStop){b=b+((a.r0?'type="gradientradial" focusposition="0.2, 0.2" focussize="0.2, 0.2" ':
'type="gradient" focus="0" angle="'+(180+180*a.angle(a.x0,a.y0,a.x1,a.y1)/Math.PI)+'" ')+'color="'+a.col0.color+'" opacity="'+a.col0.opacity*100+'%" color2="'+a.col1.color+'" o:opacity2="'+a.col1.opacity*100+'%" colors="');if(a.stops)for(var c=0,d=a.stops.length;c<d;c++)b=b+(Math.round(100*a.stops[c][0])+"% "+a.stops[c][1]);b=b+'" '}else if(a.img)b=b+('type="tile" src="'+a.img.src+'" ');else{a=this.processColor(a);b=b+('color="'+a.color+'" opacity="'+a.opacity+'" ')}return b},getCoords:function(a,
b){var c=this.m;return{x:this.Z*(a*c[0][0]+b*c[1][0]+c[2][0])-this.Z2,y:this.Z*(a*c[0][1]+b*c[1][1]+c[2][1])-this.Z2}},coord:function(a,b){var c=this.m;return[Math.round(this.Z*(a*c[0][0]+b*c[1][0]+c[2][0])-this.Z2),",",Math.round(this.Z*(a*c[0][1]+b*c[1][1]+c[2][1])-this.Z2)].join("")}});CanvasRenderingContext2D.implement({clearRect:function(){this.element.innerHTML=""},fillRect:function(a,b,c,d){this.rect(a,b,c,d);this.fill()},strokeRect:function(a,b,c,d){this.rect(a,b,c,d);this.stroke()}});
CanvasRenderingContext2D.implement({scale:function(a,b){this.arcScaleX=this.arcScaleX*a;this.arcScaleY=this.arcScaleY*b;this.matMult([[a,0,0],[0,b,0],[0,0,1]])},rotate:function(a){this.rot=this.rot+a;var b=Math.cos(a),a=Math.sin(a);this.matMult([[b,a,0],[-a,b,0],[0,0,1]])},translate:function(a,b){this.matMult([[1,0,0],[0,1,0],[a,b,1]])},transform:function(a,b,c,d,e,f){this.matMult([[a,c,e],[b,d,f],[0,0,1]])},setTransform:function(a,b,c,d,e,f){this.m=[[1,0,0],[0,1,0],[0,0,1]];this.transform(a,b,c,
d,e,f)},matMult:function(a){for(var b=this.m,c=[[0,0,0],[0,0,0],[0,0,0]],d=0;d<3;d++){a[0][d]!==0&&this.sum(c[0],this.mult(a[0][d],b[d]));a[1][d]!==0&&this.sum(c[1],this.mult(a[1][d],b[d]));a[2][d]!==0&&this.sum(c[2],this.mult(a[2][d],b[d]))}this.m=[c[0],c[1],c[2]]},mult:function(a,b){return[a*b[0],a*b[1],a*b[2]]},sum:function(a,b){a[0]=a[0]+b[0];a[1]=a[1]+b[1];a[2]=a[2]+b[2]}});
CanvasRenderingContext2D.implement({drawImage:function(a,b){var c=arguments,d=c.length,e=d==9?4:0;if(!(d+"").test(/3|5|9/))throw"Wrong number of arguments";var f=a.runtimeStyle.width,g=a.runtimeStyle.height;a.runtimeStyle.width="auto";a.runtimeStyle.height="auto";var h=a.width,i=a.height;a.runtimeStyle.width=f;a.runtimeStyle.height=g;var g=f=0,k=h,j=i,n=c[1+e],l=c[2+e],m=c[3+e]||h,e=c[4+e]||i;if(d==9){f=c[1];g=c[2];k=c[3];j=c[4]}c=this.getCoords(n,l);d='<v:group coordsize="'+this.Z*10+","+this.Z*
10+'" coordorigin="0,0" style="width:10;height:10;position:absolute;';if(this.m[0][0]!=1||this.m[0][1]){n=Math.max(this.getCoords(n+m,l),this.getCoords(n,l+e),this.getCoords(n+m,l+e));d=d+("padding:0;padding-right:"+Math.round(Math.max(c.x,n)/this.Z)+"px;padding-bottom:"+Math.round(Math.max(c.y,n)/this.Z)+"px;filter:progid:DXImageTransform.Microsoft.Matrix(M11='"+this.m[0][0]+"', M12='"+this.m[1][0]+"', M21='"+this.m[0][1]+"', M22='"+this.m[1][1]+"', Dx='"+Math.round(c.x/this.Z)+"', Dy='"+Math.round(c.y/
this.Z)+"', sizingmethod='clip');")}else d=d+("top:"+Math.round(c.y/this.Z)+"px;left:"+Math.round(c.x/this.Z)+"px;");this.element.insertAdjacentHTML("BeforeEnd",d+'"><v:image src="'+a.src+'" style="width:'+this.Z*m+";height:"+this.Z*e+';" cropleft="'+f/h+'" croptop="'+g/i+'" cropright="'+(h-f-k)/h+'" cropbottom="'+(i-g-j)/i+'" /></v:group>');this.parent.appendChild(this.fragment)},drawImageFromRect:Function.empty,getImageData:function(){},putImageData:function(){},getCoords:function(a,b){var c=this.m;
return{x:this.Z*(a*c[0][0]+b*c[1][0]+c[2][0])-this.Z2,y:this.Z*(a*c[0][1]+b*c[1][1]+c[2][1])-this.Z2}}});Event=function(){this.relatedTarget=this.target=this.type=null;this.cancelable=false;this.timeStamp=null;this.returnValue=true};Event.prototype.initEvent=function(a,b){this.type=a;this.cancelable=b;this.timeStamp=(new Date).getTime()};Event.prototype.preventDefault=function(){if(this.cancelable)this.returnValue=false};
Event.fireDOMEvent=function(a,b){if(document.createEvent){var c=document.createEvent("Events");c.initEvent(a,true,true);b.dispatchEvent(c)}else if(document.createEventObject){c=document.createEventObject();b.fireEvent("on"+a,c)}};EventTarget=function(){this.eventhandlers={}};EventTarget.prototype.addEventListener=function(a,b){typeof this.eventhandlers[a]=="undefined"&&(this.eventhandlers[a]=[]);this.eventhandlers[a][this.eventhandlers[a].length]=b};
EventTarget.prototype.dispatchEvent=function(a){a.target=this;if(typeof this.eventhandlers[a.type]!="undefined")for(var b=0;b<this.eventhandlers[a.type].length;b++)this.eventhandlers[a.type][b](a);return a.returnValue};EventTarget.prototype.removeEventListener=function(a,b){if(typeof this.eventhandlers[a]!="undefined"){for(var c=[],d=0;d<this.eventhandlers[a].length;d++)this.eventhandlers[a][d]!=b&&(c[c.length]=this.eventhandlers[a][d]);this.eventhandlers[a]=c}};
ArrayList=function(){this.increment=10;this.size=0;this.data=Array(this.increment)};ArrayList.EMPTY_LIST=new ArrayList;ArrayList.prototype.reverse=function(){for(var a=Array(this.size),b=0;b<this.size;b++)a[b]=this.data[this.size-b-1];this.data=a};ArrayList.prototype.getCapacity=function(){return this.data.length};ArrayList.prototype.getSize=function(){return this.size};ArrayList.prototype.isEmpty=function(){return this.getSize()==0};
ArrayList.prototype.getLastElement=function(){if(this.data[this.getSize()-1]!=null)return this.data[this.getSize()-1]};ArrayList.prototype.getFirstElement=function(){if(this.data[0]!=null)return this.data[0]};ArrayList.prototype.get=function(a){return this.data[a]};ArrayList.prototype.add=function(a){this.getSize()==this.data.length&&this.resize();this.data[this.size++]=a};ArrayList.prototype.addAll=function(a){for(var b=0;b<a.getSize();b++)this.add(a.get(b))};
ArrayList.prototype.remove=function(a){a=this.indexOf(a);return a>=0?this.removeElementAt(a):null};ArrayList.prototype.insertElementAt=function(a,b){this.size==this.capacity&&this.resize();for(var c=this.getSize();c>b;c--)this.data[c]=this.data[c-1];this.data[b]=a;this.size++};ArrayList.prototype.removeElementAt=function(a){for(var b=this.data[a];a<this.getSize()-1;a++)this.data[a]=this.data[a+1];this.data[this.getSize()-1]=null;this.size--;return b};
ArrayList.prototype.removeAllElements=function(){for(var a=this.size=0;a<this.data.length;a++)this.data[a]=null};ArrayList.prototype.indexOf=function(a){for(var b=0;b<this.getSize();b++)if(this.data[b]==a)return b;return-1};ArrayList.prototype.contains=function(a){for(var b=0;b<this.getSize();b++)if(this.data[b]==a)return true;return false};ArrayList.prototype.resize=function(){newData=Array(this.data.length+this.increment);for(var a=0;a<this.data.length;a++)newData[a]=this.data[a];this.data=newData};
ArrayList.prototype.trimToSize=function(){for(var a=Array(this.getSize()),b=0;b<this.getSize();b++)a[b]=this.data[b];this.size=a.length-1;this.data=a};ArrayList.prototype.sort=function(a){var b,c,d,e,f;for(b=1;b<this.getSize();b++){e=this.data[b];d=e[a];c=b-1;f=this.data[c];for(f=f[a];c>=0&&f>d;){this.data[c+1]=this.data[c];c--;if(c>=0){f=this.data[c];f=f[a]}}this.data[c+1]=e}};ArrayList.prototype.clone=function(){for(var a=new ArrayList(this.size),b=0;b<this.size;b++)a.add(this.data[b]);return a};
ArrayList.prototype.overwriteElementAt=function(a,b){this.data[b]=a};function trace(a){openwindow("about:blank",700,400).document.writeln("<pre>"+a+"</pre>")}function openwindow(a,b,c){property="left="+(screen.width-b)/2+", top="+(screen.height-c)/2+", toolbar=0,scrollbars=0,location=0,statusbar=0,menubar=0,resizable=1,alwaysRaised,width="+b+",height="+c;return window.open(a,"_blank",property)}
function dumpObject(a){trace("----------------------------------------------------------------------------");trace("- Object dump");trace("----------------------------------------------------------------------------");for(var b in a)try{typeof a[b]!="function"&&trace(b+" --&gt; "+a[b])}catch(c){}for(b in a)try{typeof a[b]=="function"&&trace(b+" --&gt; "+a[b])}catch(d){}trace("----------------------------------------------------------------------------")}Drag=function(){};Drag.current=null;
Drag.currentTarget=null;Drag.dragging=!1;Drag.isDragging=function(){return this.dragging};Drag.setCurrent=function(a){this.current=a;this.dragging=true};Drag.getCurrent=function(){return this.current};Drag.clearCurrent=function(){this.current=null;this.dragging=false};Draggable=function(a,b){EventTarget.call(this);this.construct(a,b);this.diffY=this.diffX=0;this.targets=new ArrayList};Draggable.prototype=new EventTarget;
Draggable.prototype.construct=function(a,b){this.element=a;this.constraints=b;var c=this,d=function(a){var b=new DragDropEvent;b.initDragDropEvent("dblclick",true);c.dispatchEvent(b);a=a||window.event;a.cancelBubble=true;a.returnValue=false},e=function(a){var a=a||window.event,b=new DragDropEvent,d=c.node.workflow.getAbsoluteX(),e=c.node.workflow.getAbsoluteY(),f=c.node.workflow.getScrollLeft(),n=c.node.workflow.getScrollTop();b.x=a.clientX-c.element.offsetLeft+f-d;b.y=a.clientY-c.element.offsetTop+
n-e;if(a.button==2){b.initDragDropEvent("contextmenu",true);c.dispatchEvent(b)}else{b.initDragDropEvent("dragstart",true);if(c.dispatchEvent(b)){c.diffX=a.clientX-c.element.offsetLeft;c.diffY=a.clientY-c.element.offsetTop;Drag.setCurrent(c);c.isAttached==true&&c.detachEventHandlers();c.attachEventHandlers()}}a.cancelBubble=true;a.returnValue=false},f=function(){if(Drag.getCurrent()==null){if(Drag.currentHover!=null&&c!=Drag.currentHover){var a=new DragDropEvent;a.initDragDropEvent("mouseleave",false,
c);Drag.currentHover.dispatchEvent(a)}if(c!=null&&c!=Drag.currentHover){a=new DragDropEvent;a.initDragDropEvent("mouseenter",false,c);c.dispatchEvent(a)}Drag.currentHover=c}};if(this.element.addEventListener){this.element.addEventListener("mousemove",f,false);this.element.addEventListener("mousedown",e,false);this.element.addEventListener("dblclick",d,false)}else if(this.element.attachEvent){this.element.attachEvent("onmousemove",f);this.element.attachEvent("onmousedown",e);this.element.attachEvent("ondblclick",
d)}else throw Error("Drag not supported in this browser.");};
Draggable.prototype.attachEventHandlers=function(){var a=this;a.isAttached=true;this.tempMouseMove=function(b){var c=b||window.event,b=new Point(c.clientX-a.diffX,c.clientY-a.diffY);a.node.getCanSnapToHelper()&&(b=a.node.getWorkflow().snapToHelper(a.node,b));a.element.style.left=b.x+"px";a.element.style.top=b.y+"px";var d=a.node.workflow.getScrollLeft(),e=a.node.workflow.getScrollTop(),f=a.node.workflow.getAbsoluteX(),g=a.node.workflow.getAbsoluteY(),b=a.getDropTarget(c.clientX+d-f,c.clientY+e-g),
c=a.getCompartment(c.clientX+d-f,c.clientY+e-g);if(Drag.currentTarget!=null&&b!=Drag.currentTarget){d=new DragDropEvent;d.initDragDropEvent("dragleave",false,a);Drag.currentTarget.dispatchEvent(d)}if(b!=null&&b!=Drag.currentTarget){d=new DragDropEvent;d.initDragDropEvent("dragenter",false,a);b.dispatchEvent(d)}Drag.currentTarget=b;if(Drag.currentCompartment!=null&&c!=Drag.currentCompartment){d=new DragDropEvent;d.initDragDropEvent("figureleave",false,a);Drag.currentCompartment.dispatchEvent(d)}if(c!=
null&&c.node!=a.node&&c!=Drag.currentCompartment){d=new DragDropEvent;d.initDragDropEvent("figureenter",false,a);c.dispatchEvent(d)}Drag.currentCompartment=c;b=new DragDropEvent;b.initDragDropEvent("drag",false);a.dispatchEvent(b)};a.tempMouseUp=function(b){a.detachEventHandlers();var c=b||window.event,b=new DragDropEvent;b.initDragDropEvent("dragend",false);a.dispatchEvent(b);var d=a.node.workflow.getScrollLeft(),e=a.node.workflow.getScrollTop(),f=a.node.workflow.getAbsoluteX(),g=a.node.workflow.getAbsoluteY(),
b=a.getDropTarget(c.clientX+d-f,c.clientY+e-g),c=a.getCompartment(c.clientX+d-f,c.clientY+e-g);if(b!=null){d=new DragDropEvent;d.initDragDropEvent("drop",false,a);b.dispatchEvent(d)}if(c!=null&&c.node!=a.node){d=new DragDropEvent;d.initDragDropEvent("figuredrop",false,a);c.dispatchEvent(d)}if(Drag.currentTarget!=null){d=new DragDropEvent;d.initDragDropEvent("dragleave",false,a);Drag.currentTarget.dispatchEvent(d);Drag.currentTarget=null}Drag.currentCompartment=null;Drag.clearCurrent()};if(document.body.addEventListener){document.body.addEventListener("mousemove",
this.tempMouseMove,false);document.body.addEventListener("mouseup",this.tempMouseUp,false)}else if(document.body.attachEvent){document.body.attachEvent("onmousemove",this.tempMouseMove);document.body.attachEvent("onmouseup",this.tempMouseUp)}else throw Error("Drag doesn't support this browser.");};
Draggable.prototype.detachEventHandlers=function(){this.isAttached=false;if(document.body.removeEventListener){document.body.removeEventListener("mousemove",this.tempMouseMove,false);document.body.removeEventListener("mouseup",this.tempMouseUp,false)}else if(document.body.detachEvent){document.body.detachEvent("onmousemove",this.tempMouseMove);document.body.detachEvent("onmouseup",this.tempMouseUp)}else throw Error("Drag doesn't support this browser.");};
Draggable.prototype.getDropTarget=function(a,b){for(var c=0;c<this.targets.getSize();c++){var d=this.targets.get(c);if(d.node.isOver(a,b)&&d.node!=this.node)return d}return null};Draggable.prototype.getCompartment=function(a,b){for(var c=null,d=0;d<this.node.workflow.compartments.getSize();d++){var e=this.node.workflow.compartments.get(d);e.isOver(a,b)&&e!=this.node&&(c==null?c=e:c.getZOrder()<e.getZOrder()&&(c=e))}return c==null?null:c.dropable};Draggable.prototype.getLeft=function(){return this.element.offsetLeft};
Draggable.prototype.getTop=function(){return this.element.offsetTop};DragDropEvent=function(){Event.call(this)};DragDropEvent.prototype=new Event;DragDropEvent.prototype.initDragDropEvent=function(a,b,c){this.initEvent(a,b);this.relatedTarget=c};DropTarget=function(a){EventTarget.call(this);this.construct(a)};DropTarget.prototype=new EventTarget;DropTarget.prototype.construct=function(a){this.element=a};
DropTarget.prototype.getLeft=function(){for(var a=this.element,b=a.offsetLeft;(a=a.offsetParent)!=null;)b=b+a.offsetLeft;return b};DropTarget.prototype.getTop=function(){for(var a=this.element,b=a.offsetTop;(a=a.offsetParent)!=null;)b=b+a.offsetTop;return b};DropTarget.prototype.getHeight=function(){return this.element.offsetHeight};DropTarget.prototype.getWidth=function(){return this.element.offsetWidth};PositionConstants=function(){};PositionConstants.NORTH=1;PositionConstants.SOUTH=4;
PositionConstants.WEST=8;PositionConstants.EAST=16;Color=function(a,b,c){if(typeof b=="undefined"){a=this.hex2rgb(a);this.red=a[0];this.green=a[1];this.blue=a[2]}else{this.red=a;this.green=b;this.blue=c}};Color.prototype.type="Color";Color.prototype.getHTMLStyle=function(){return"rgb("+this.red+","+this.green+","+this.blue+")"};Color.prototype.getRed=function(){return this.red};Color.prototype.getGreen=function(){return this.green};Color.prototype.getBlue=function(){return this.blue};
Color.prototype.getIdealTextColor=function(){return 255-(this.red*0.299+this.green*0.587+this.blue*0.114)<105?new Color(0,0,0):new Color(255,255,255)};Color.prototype.hex2rgb=function(a){a=a.replace("#","");return{"0":parseInt(a.substr(0,2),16),1:parseInt(a.substr(2,2),16),2:parseInt(a.substr(4,2),16)}};Color.prototype.hex=function(){return this.int2hex(this.red)+this.int2hex(this.green)+this.int2hex(this.blue)};
Color.prototype.int2hex=function(a){a=Math.round(Math.min(Math.max(0,a),255));return"0123456789ABCDEF".charAt((a-a%16)/16)+"0123456789ABCDEF".charAt(a%16)};Color.prototype.darker=function(a){var b=parseInt(Math.round(this.getRed()*(1-a))),c=parseInt(Math.round(this.getGreen()*(1-a))),a=parseInt(Math.round(this.getBlue()*(1-a)));b<0?b=0:b>255&&(b=255);c<0?c=0:c>255&&(c=255);a<0?a=0:a>255&&(a=255);return new Color(b,c,a)};
Color.prototype.lighter=function(a){var b=parseInt(Math.round(this.getRed()*(1+a))),c=parseInt(Math.round(this.getGreen()*(1+a))),a=parseInt(Math.round(this.getBlue()*(1+a)));b<0?b=0:b>255&&(b=255);c<0?c=0:c>255&&(c=255);a<0?a=0:a>255&&(a=255);return new Color(b,c,a)};Point=function(a,b){this.x=a;this.y=b};Point.prototype.type="Point";Point.prototype.getX=function(){return this.x};Point.prototype.getY=function(){return this.y};
Point.prototype.getPosition=function(a){var b=a.x-this.x,a=a.y-this.y;return Math.abs(b)>Math.abs(a)?b<0?PositionConstants.WEST:PositionConstants.EAST:a<0?PositionConstants.NORTH:PositionConstants.SOUTH};Point.prototype.equals=function(a){return this.x==a.x&&this.y==a.y};Point.prototype.getDistance=function(a){return Math.sqrt((this.x-a.x)*(this.x-a.x)+(this.y-a.y)*(this.y-a.y))};Point.prototype.getTranslated=function(a){return new Point(this.x+a.x,this.y+a.y)};
Dimension=function(a,b,c,d){Point.call(this,a,b);this.w=c;this.h=d};Dimension.prototype=new Point;Dimension.prototype.type="Dimension";Dimension.prototype.translate=function(a,b){this.x=this.x+a;this.y=this.y+b;return this};Dimension.prototype.resize=function(a,b){this.w=this.w+a;this.h=this.h+b;return this};Dimension.prototype.setBounds=function(a){this.x=a.x;this.y=a.y;this.w=a.w;this.h=a.h;return this};Dimension.prototype.isEmpty=function(){return this.w<=0||this.h<=0};
Dimension.prototype.getWidth=function(){return this.w};Dimension.prototype.getHeight=function(){return this.h};Dimension.prototype.getRight=function(){return this.x+this.w};Dimension.prototype.getBottom=function(){return this.y+this.h};Dimension.prototype.getTopLeft=function(){return new Point(this.x,this.y)};Dimension.prototype.getCenter=function(){return new Point(this.x+this.w/2,this.y+this.h/2)};Dimension.prototype.getBottomRight=function(){return new Point(this.x+this.w,this.y+this.h)};
Dimension.prototype.equals=function(a){return this.x==a.x&&this.y==a.y&&this.w==a.w&&this.h==a.h};SnapToHelper=function(a){this.workflow=a};SnapToHelper.NORTH=1;SnapToHelper.SOUTH=4;SnapToHelper.WEST=8;SnapToHelper.EAST=16;SnapToHelper.NORTH_EAST=SnapToHelper.NORTH|SnapToHelper.EAST;SnapToHelper.NORTH_WEST=SnapToHelper.NORTH|SnapToHelper.WEST;SnapToHelper.SOUTH_EAST=SnapToHelper.SOUTH|SnapToHelper.EAST;SnapToHelper.SOUTH_WEST=SnapToHelper.SOUTH|SnapToHelper.WEST;
SnapToHelper.NORTH_SOUTH=SnapToHelper.NORTH|SnapToHelper.SOUTH;SnapToHelper.EAST_WEST=SnapToHelper.EAST|SnapToHelper.WEST;SnapToHelper.NSEW=SnapToHelper.NORTH_SOUTH|SnapToHelper.EAST_WEST;SnapToHelper.prototype.snapPoint=function(a,b){return b};SnapToHelper.prototype.snapRectangle=function(a){return a};SnapToHelper.prototype.onSetDocumentDirty=function(){};SnapToGrid=function(a){SnapToHelper.call(this,a)};SnapToGrid.prototype=new SnapToHelper;
SnapToGrid.prototype.snapPoint=function(a,b,c){c.x=this.workflow.gridWidthX*Math.floor((b.x+this.workflow.gridWidthX/2)/this.workflow.gridWidthX);c.y=this.workflow.gridWidthY*Math.floor((b.y+this.workflow.gridWidthY/2)/this.workflow.gridWidthY);return 0};SnapToGrid.prototype.snapRectangle=function(a,b){b.x=a.x;b.y=a.y;b.w=a.w;b.h=a.h;return 0};SnapToGeometryEntry=function(a,b){this.type=a;this.location=b};SnapToGeometryEntry.prototype.getLocation=function(){return this.location};
SnapToGeometryEntry.prototype.getType=function(){return this.type};SnapToGeometry=function(a){SnapToHelper.call(this,a)};SnapToGeometry.prototype=new SnapToHelper;SnapToGeometry.THRESHOLD=5;
SnapToGeometry.prototype.snapPoint=function(a,b,c){(this.rows==null||this.cols==null)&&this.populateRowsAndCols();if((a&SnapToHelper.EAST)!=0){var d=this.getCorrectionFor(this.cols,b.getX()-1,1);if(d!=SnapToGeometry.THRESHOLD){a=a&~SnapToHelper.EAST;c.x=c.x+d}}if((a&SnapToHelper.WEST)!=0){d=this.getCorrectionFor(this.cols,b.getX(),-1);if(d!=SnapToGeometry.THRESHOLD){a=a&~SnapToHelper.WEST;c.x=c.x+d}}if((a&SnapToHelper.SOUTH)!=0){d=this.getCorrectionFor(this.rows,b.getY()-1,1);if(d!=SnapToGeometry.THRESHOLD){a=
a&~SnapToHelper.SOUTH;c.y=c.y+d}}if((a&SnapToHelper.NORTH)!=0){b=this.getCorrectionFor(this.rows,b.getY(),-1);if(b!=SnapToGeometry.THRESHOLD){a=a&~SnapToHelper.NORTH;c.y=c.y+b}}return a};
SnapToGeometry.prototype.snapRectangle=function(a,b){var c=a.getTopLeft(),d=a.getBottomRight(),e=this.snapPoint(SnapToHelper.NORTH_WEST,a.getTopLeft(),c);b.x=c.x;b.y=c.y;c=this.snapPoint(SnapToHelper.SOUTH_EAST,a.getBottomRight(),d);if(e&SnapToHelper.WEST)b.x=d.x-a.getWidth();if(e&SnapToHelper.NORTH)b.y=d.y-a.getHeight();return e|c};
SnapToGeometry.prototype.populateRowsAndCols=function(){this.rows=[];this.cols=[];for(var a=this.workflow.getDocument().getFigures(),b=0,c=0;c<a.getSize();c++){var d=a.get(c);if(d!=this.workflow.getCurrentSelection()){d=d.getBounds();this.cols[b*3]=new SnapToGeometryEntry(-1,d.getX());this.rows[b*3]=new SnapToGeometryEntry(-1,d.getY());this.cols[b*3+1]=new SnapToGeometryEntry(0,d.x+(d.getWidth()-1)/2);this.rows[b*3+1]=new SnapToGeometryEntry(0,d.y+(d.getHeight()-1)/2);this.cols[b*3+2]=new SnapToGeometryEntry(1,
d.getRight()-1);this.rows[b*3+2]=new SnapToGeometryEntry(1,d.getBottom()-1);b++}}};SnapToGeometry.prototype.getCorrectionFor=function(a,b,c){for(var d=SnapToGeometry.THRESHOLD,e=SnapToGeometry.THRESHOLD,f=0;f<a.length;f++){var g=a[f],h;if(g.type==-1&&c!=0){h=Math.abs(b-g.location);if(h<d){d=h;e=g.location-b}}else if(g.type==0&&c==0){h=Math.abs(b-g.location);if(h<d){d=h;e=g.location-b}}else if(g.type==1&&c!=0){h=Math.abs(b-g.location);if(h<d){d=h;e=g.location-b}}}return e};
SnapToGeometry.prototype.onSetDocumentDirty=function(){this.cols=this.rows=null};Border=function(){this.color=null};Border.prototype.type="Border";Border.prototype.dispose=function(){this.color=null};Border.prototype.getHTMLStyle=function(){return""};Border.prototype.setColor=function(a){this.color=a};Border.prototype.getColor=function(){return this.color};Border.prototype.refresh=function(){};LineBorder=function(a){Border.call(this);this.width=1;if(a)this.width=a;this.figure=null};
LineBorder.prototype=new Border;LineBorder.prototype.type="LineBorder";LineBorder.prototype.dispose=function(){Border.prototype.dispose.call(this);this.figure=null};LineBorder.prototype.setLineWidth=function(a){this.width=a;if(this.figure!=null)this.figure.html.style.border=this.getHTMLStyle()};LineBorder.prototype.getHTMLStyle=function(){return this.getColor()!=null?this.width+"px solid "+this.getColor().getHTMLStyle():this.width+"px solid black"};LineBorder.prototype.refresh=function(){this.setLineWidth(this.width)};
Figure=function(){this.construct()};Figure.prototype.type="Figure";Figure.ZOrderBaseIndex=100;Figure.setZOrderBaseIndex=function(a){Figure.ZOrderBaseIndex=a};
Figure.prototype.construct=function(){this.y=this.x=this.lastDragStartTime=0;this.border=null;this.setDimension(10,10);this.id=this.generateUId();this.html=this.createHTMLElement();this.parent=this.draggable=this.workflow=this.canvas=null;this.isMoving=false;this.canSnapToHelper=true;this.snapToGridAnchor=new Point(0,0);this.timer=-1;this.setDeleteable(true);this.setCanDrag(true);this.setResizeable(true);this.setSelectable(true);this.properties={};this.moveListener=new ArrayList};
Figure.prototype.dispose=function(){this.moveListener=this.workflow=this.canvas=null;if(this.draggable!=null){this.draggable.removeEventListener("mouseenter",this.tmpMouseEnter);this.draggable.removeEventListener("mouseleave",this.tmpMouseLeave);this.draggable.removeEventListener("dragend",this.tmpDragend);this.draggable.removeEventListener("dragstart",this.tmpDragstart);this.draggable.removeEventListener("drag",this.tmpDrag);this.draggable.removeEventListener("dblclick",this.tmpDoubleClick);this.draggable.node=
null}this.draggable=null;this.border!=null&&this.border.dispose();this.border=null;this.parent!=null&&this.parent.removeChild(this)};Figure.prototype.getProperties=function(){return this.properties};Figure.prototype.getProperty=function(a){return this.properties[a]};Figure.prototype.setProperty=function(a,b){this.properties[a]=b;this.setDocumentDirty()};Figure.prototype.getId=function(){return this.id};Figure.prototype.setCanvas=function(a){this.canvas=a};Figure.prototype.getWorkflow=function(){return this.workflow};
Figure.prototype.setWorkflow=function(a){if(this.draggable==null){this.html.tabIndex="0";var b=this;this.keyDown=function(a){a.cancelBubble=true;a.returnValue=true;b.onKeyDown(a.keyCode,a.ctrlKey)};this.html.addEventListener?this.html.addEventListener("keydown",this.keyDown,false):this.html.attachEvent&&this.html.attachEvent("onkeydown",this.keyDown);this.draggable=new Draggable(this.html,Draggable.DRAG_X|Draggable.DRAG_Y);this.draggable.node=this;this.tmpContextMenu=function(a){b.onContextMenu(b.x+
a.x,a.y+b.y)};this.tmpMouseEnter=function(){b.onMouseEnter()};this.tmpMouseLeave=function(){b.onMouseLeave()};this.tmpDragend=function(){b.onDragend()};this.tmpDragstart=function(a){b.workflow.showMenu(null);if(b.workflow.toolPalette&&b.workflow.toolPalette.activeTool){a.returnValue=false;b.workflow.onMouseDown(b.x+a.x,a.y+b.y);b.workflow.onMouseUp(b.x+a.x,a.y+b.y)}else a.returnValue=b.onDragstart(a.x,a.y)};this.tmpDrag=function(){b.onDrag()};this.tmpDoubleClick=function(){b.onDoubleClick()};this.draggable.addEventListener("contextmenu",
this.tmpContextMenu);this.draggable.addEventListener("mouseenter",this.tmpMouseEnter);this.draggable.addEventListener("mouseleave",this.tmpMouseLeave);this.draggable.addEventListener("dragend",this.tmpDragend);this.draggable.addEventListener("dragstart",this.tmpDragstart);this.draggable.addEventListener("drag",this.tmpDrag);this.draggable.addEventListener("dblclick",this.tmpDoubleClick)}this.workflow=a};
Figure.prototype.createHTMLElement=function(){var a=document.createElement("div");a.id=this.id;a.style.position="absolute";a.style.left=this.x+"px";a.style.top=this.y+"px";a.style.height=this.width+"px";a.style.width=this.height+"px";a.style.margin="0px";a.style.padding="0px";a.style.outline="none";a.style.zIndex=""+Figure.ZOrderBaseIndex;return a};Figure.prototype.setParent=function(a){this.parent=a};Figure.prototype.getParent=function(){return this.parent};Figure.prototype.getZOrder=function(){return this.html.style.zIndex};
Figure.prototype.setZOrder=function(a){this.html.style.zIndex=a};Figure.prototype.hasFixedPosition=function(){return false};Figure.prototype.getMinWidth=function(){return 5};Figure.prototype.getMinHeight=function(){return 5};Figure.prototype.getHTMLElement=function(){if(this.html==null)this.html=this.createHTMLElement();return this.html};Figure.prototype.paint=function(){};
Figure.prototype.setBorder=function(a){if(this.border!=null)this.border.figure=null;this.border=a;this.border.figure=this;this.border.refresh();this.setDocumentDirty()};Figure.prototype.onContextMenu=function(a,b){var c=this.getContextMenu();c!=null&&this.workflow.showMenu(c,a,b)};Figure.prototype.getContextMenu=function(){return null};Figure.prototype.onDoubleClick=function(){};Figure.prototype.onMouseEnter=function(){};Figure.prototype.onMouseLeave=function(){};
Figure.prototype.onDrag=function(){this.x=this.draggable.getLeft();this.y=this.draggable.getTop();if(this.isMoving==false){this.isMoving=true;this.setAlpha(0.5)}this.fireMoveEvent()};
Figure.prototype.onDragend=function(){if(this.getWorkflow().getEnableSmoothFigureHandling()==true){var a=this;a.timer>0&&window.clearInterval(a.timer);a.timer=window.setInterval(function(){if(a.alpha<1)a.setAlpha(Math.min(1,a.alpha+0.05));else{window.clearInterval(a.timer);a.timer=-1}},20)}else this.setAlpha(1);this.command.setPosition(this.x,this.y);this.workflow.commandStack.execute(this.command);this.command=null;this.isMoving=false;this.workflow.hideSnapToHelperLines();this.fireMoveEvent()};
Figure.prototype.onDragstart=function(){if(!this.canDrag)return false;this.command=new CommandMove(this,this.x,this.y);return true};Figure.prototype.setCanDrag=function(a){this.canDrag=a;this.html.style.cursor=a?"move":null};Figure.prototype.setAlpha=function(a){if(this.alpha!=a){try{this.html.style.MozOpacity=a}catch(b){}try{this.html.style.opacity=a}catch(c){}try{var d=Math.round(a*100);this.html.style.filter=d>=99?"":"alpha(opacity="+d+")"}catch(e){}this.alpha=a}};
Figure.prototype.setDimension=function(a,b){this.width=Math.max(this.getMinWidth(),a);this.height=Math.max(this.getMinHeight(),b);if(this.html!=null){this.html.style.width=this.width+"px";this.html.style.height=this.height+"px";this.fireMoveEvent();this.workflow!=null&&this.workflow.getCurrentSelection()==this&&this.workflow.showResizeHandles(this)}};
Figure.prototype.setPosition=function(a,b){this.x=a;this.y=b;if(this.html!=null){this.html.style.left=this.x+"px";this.html.style.top=this.y+"px";this.fireMoveEvent();this.workflow!=null&&this.workflow.getCurrentSelection()==this&&this.workflow.showResizeHandles(this)}};Figure.prototype.isResizeable=function(){return this.resizeable};Figure.prototype.setResizeable=function(a){this.resizeable=a};Figure.prototype.isSelectable=function(){return this.selectable};
Figure.prototype.setSelectable=function(a){this.selectable=a};Figure.prototype.isStrechable=function(){return true};Figure.prototype.isDeleteable=function(){return this.deleteable};Figure.prototype.setDeleteable=function(a){this.deleteable=a};Figure.prototype.setCanSnapToHelper=function(a){this.canSnapToHelper=a};Figure.prototype.getCanSnapToHelper=function(){return this.canSnapToHelper};Figure.prototype.getSnapToGridAnchor=function(){return this.snapToGridAnchor};
Figure.prototype.setSnapToGridAnchor=function(a){this.snapToGridAnchor=a};Figure.prototype.getBounds=function(){return new Dimension(this.getX(),this.getY(),this.getWidth(),this.getHeight())};Figure.prototype.getWidth=function(){return this.width};Figure.prototype.getHeight=function(){return this.height};Figure.prototype.getY=function(){return this.y};Figure.prototype.getX=function(){return this.x};Figure.prototype.getAbsoluteY=function(){return this.y};Figure.prototype.getAbsoluteX=function(){return this.x};
Figure.prototype.onKeyDown=function(a,b){a==46&&this.isDeleteable()==true&&this.workflow.commandStack.execute(new CommandDelete(this));if(b)this.workflow.onKeyDown(a,b)};Figure.prototype.getPosition=function(){return new Point(this.x,this.y)};Figure.prototype.isOver=function(a,b){var c=this.getAbsoluteX(),d=this.getAbsoluteY(),e=c+this.width,f=d+this.height;return a>=c&&a<=e&&b>=d&&b<=f};Figure.prototype.attachMoveListener=function(a){a==null||this.moveListener==null||this.moveListener.add(a)};
Figure.prototype.detachMoveListener=function(a){a==null||this.moveListener==null||this.moveListener.remove(a)};Figure.prototype.fireMoveEvent=function(){this.setDocumentDirty();for(var a=this.moveListener.getSize(),b=0;b<a;b++)this.moveListener.get(b).onOtherFigureMoved(this)};Figure.prototype.onOtherFigureMoved=function(){};Figure.prototype.setDocumentDirty=function(){this.workflow!=null&&this.workflow.setDocumentDirty()};
Figure.prototype.generateUId=function(){for(nbTry=0;nbTry<1E3;){for(var a="",b=0;b<10;b++)var c=Math.floor(Math.random()*61),a=a+"0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".substring(c,c+1);elem=document.getElementById(a);if(!elem)return a;nbTry=nbTry+1}return null};Figure.prototype.disableTextSelection=function(a){if(typeof a.onselectstart!="undefined")a.onselectstart=function(){return false};else if(typeof a.style.MozUserSelect!="undefined")a.style.MozUserSelect="none"};
Node=function(){this.bgColor=null;this.lineColor=new Color(128,128,255);this.lineStroke=1;this.ports=new ArrayList;Figure.call(this)};Node.prototype=new Figure;Node.prototype.type="Node";Node.prototype.dispose=function(){for(var a=0;a<this.ports.getSize();a++)this.ports.get(a).dispose();this.ports=null;Figure.prototype.dispose.call(this)};
Node.prototype.createHTMLElement=function(){var a=Figure.prototype.createHTMLElement.call(this);a.style.width="auto";a.style.height="auto";a.style.margin="0px";a.style.padding="0px";if(this.lineColor!=null)a.style.border=this.lineStroke+"px solid "+this.lineColor.getHTMLStyle();a.style.fontSize="1px";if(this.bgColor!=null)a.style.backgroundColor=this.bgColor.getHTMLStyle();return a};Node.prototype.paint=function(){Figure.prototype.paint.call(this);for(var a=0;a<this.ports.getSize();a++)this.ports.get(a).paint()};
Node.prototype.getPorts=function(){return this.ports};Node.prototype.getPort=function(a){if(this.ports==null)return null;for(var b=0;b<this.ports.getSize();b++){var c=this.ports.get(b);if(c.getName()==a)return c}};Node.prototype.addPort=function(a,b,c){this.ports.add(a);a.setOrigin(b,c);a.setPosition(b,c);a.setParent(this);a.setDeleteable(false);this.html.appendChild(a.getHTMLElement());this.workflow!=null&&this.workflow.registerPort(a)};
Node.prototype.removePort=function(a){this.ports!=null&&this.ports.removeElementAt(this.ports.indexOf(a));try{this.html.removeChild(a.getHTMLElement())}catch(b){}this.workflow!=null&&this.workflow.unregisterPort(a)};Node.prototype.setWorkflow=function(a){var b=this.workflow;Figure.prototype.setWorkflow.call(this,a);if(b!=null)for(a=0;a<this.ports.getSize();a++)b.unregisterPort(this.ports.get(a));if(this.workflow!=null)for(a=0;a<this.ports.getSize();a++)this.workflow.registerPort(this.ports.get(a))};
Node.prototype.setBackgroundColor=function(a){this.bgColor=a;this.html.style.backgroundColor=this.bgColor!=null?this.bgColor.getHTMLStyle():"transparent"};Node.prototype.getBackgroundColor=function(){return this.bgColor};Node.prototype.setColor=function(a){this.lineColor=a;this.html.style.border=this.lineColor!=null?this.lineStroke+"px solid "+this.lineColor.getHTMLStyle():"0px"};
Node.prototype.setLineWidth=function(a){this.lineStroke=a;this.html.style.border=this.lineColor!=null?this.lineStroke+"px solid "+this.lineColor.getHTMLStyle():"0px"};VectorFigure=function(){this.bgColor=null;this.lineColor=new Color(0,0,0);this.stroke=1;this.graphics=null;Node.call(this)};VectorFigure.prototype=new Node;VectorFigure.prototype.type="VectorFigure";
VectorFigure.prototype.dispose=function(){Node.prototype.dispose.call(this);this.lineColor=this.bgColor=null;this.graphics!=null&&this.graphics.clear();this.graphics=null};VectorFigure.prototype.createHTMLElement=function(){var a=Node.prototype.createHTMLElement.call(this);a.style.border="0px";a.style.backgroundColor="transparent";return a};VectorFigure.prototype.setWorkflow=function(a){Node.prototype.setWorkflow.call(this,a);if(this.workflow==null){this.graphics.clear();this.graphics=null}};
VectorFigure.prototype.paint=function(){this.graphics==null?this.graphics=new jsGraphics(this.id):this.graphics.clear();Node.prototype.paint.call(this);for(var a=0;a<this.ports.getSize();a++)this.getHTMLElement().appendChild(this.ports.get(a).getHTMLElement())};VectorFigure.prototype.setDimension=function(a,b){Node.prototype.setDimension.call(this,a,b);this.graphics!=null&&this.paint()};VectorFigure.prototype.setTaskCount=function(){};
VectorFigure.prototype.setBackgroundColor=function(a){this.bgColor=a;this.graphics!=null&&this.paint()};VectorFigure.prototype.getBackgroundColor=function(){return this.bgColor};VectorFigure.prototype.setLineWidth=function(a){this.stroke=a;this.graphics!=null&&this.paint()};VectorFigure.prototype.setColor=function(a){this.lineColor=a;this.graphics!=null&&this.paint()};VectorFigure.prototype.getColor=function(){return this.lineColor};
SVGFigure=function(a,b){this.bgColor=null;this.lineColor=new Color(0,0,0);this.stroke=1;this.context=null;Node.call(this);a&&b&&this.setDimension(a,b)};SVGFigure.prototype=new Node;SVGFigure.prototype.type="SVGFigure";SVGFigure.prototype.createHTMLElement=function(){var a=new MooCanvas(this.id,{width:this.getWidth(),height:this.getHeight()});a.style.position="absolute";a.style.left=this.x+"px";a.style.top=this.y+"px";a.style.zIndex=""+Figure.ZOrderBaseIndex;this.context=a.getContext("2d");return a};
SVGFigure.prototype.paint=function(){this.context.clearRect(0,0,this.getWidth(),this.getHeight());this.context.fillStyle="rgba(200,0,0,0.3)";this.context.fillRect(0,0,this.getWidth(),this.getHeight())};SVGFigure.prototype.setDimension=function(a,b){Node.prototype.setDimension.call(this,a,b);this.html.width=a;this.html.height=b;this.context!=null&&this.paint()};SVGFigure.prototype.setBackgroundColor=function(a){this.bgColor=a;this.graphics!=null&&this.paint()};
SVGFigure.prototype.getBackgroundColor=function(){return this.bgColor};SVGFigure.prototype.setLineWidth=function(a){this.stroke=a;this.context!=null&&this.paint()};SVGFigure.prototype.setColor=function(a){this.lineColor=a;this.context!=null&&this.paint()};SVGFigure.prototype.getColor=function(){return this.lineColor};Label=function(a){this.msg=a;this.bgColor=null;this.color=new Color(0,0,0);this.fontSize=10;this.textNode=null;this.align="center";Figure.call(this)};Label.prototype=new Figure;
Label.prototype.type="Label";Label.prototype.createHTMLElement=function(){var a=Figure.prototype.createHTMLElement.call(this);this.textNode=document.createTextNode(this.msg);a.appendChild(this.textNode);a.style.color=this.color.getHTMLStyle();a.style.fontSize=this.fontSize+"pt";a.style.width="auto";a.style.height="auto";a.style.paddingLeft="3px";a.style.paddingRight="3px";a.style.textAlign=this.align;if(this.bgColor!=null)a.style.backgroundColor=this.bgColor.getHTMLStyle();return a};
Label.prototype.isResizeable=function(){return false};Label.prototype.setWordwrap=function(a){this.html.style.whiteSpace=a?"wrap":"nowrap"};Label.prototype.setAlign=function(a){this.align=a;this.html.style.textAlign=a};Label.prototype.setBackgroundColor=function(a){this.bgColor=a;this.html.style.backgroundColor=this.bgColor!=null?this.bgColor.getHTMLStyle():"transparent"};Label.prototype.setColor=function(a){this.color=a;this.html.style.color=this.color.getHTMLStyle()};
Label.prototype.setFontSize=function(a){this.fontSize=a;this.html.style.fontSize=this.fontSize+"pt"};Label.prototype.getWidth=function(){return window.getComputedStyle?parseInt(getComputedStyle(this.html,"").getPropertyValue("width")):parseInt(this.html.clientWidth)};Label.prototype.getHeight=function(){return window.getComputedStyle?parseInt(getComputedStyle(this.html,"").getPropertyValue("height")):parseInt(this.html.clientHeight)};Label.prototype.getText=function(){this.msg=text};
Label.prototype.setText=function(a){this.msg=a;this.html.removeChild(this.textNode);this.textNode=document.createTextNode(this.msg);this.html.appendChild(this.textNode)};Label.prototype.setStyledText=function(a){this.msg=a;this.html.removeChild(this.textNode);this.textNode=document.createElement("div");this.textNode.style.whiteSpace="nowrap";this.textNode.innerHTML=a;this.html.appendChild(this.textNode)};Oval=function(){VectorFigure.call(this)};Oval.prototype=new VectorFigure;
Oval.prototype.type="Oval";
Oval.prototype.paint=function(){VectorFigure.prototype.paint.call(this);this.graphics.setStroke(this.stroke);var a=1;if(typeof workflow.zoomfactor!="undefined"&&workflow.zoomfactor!="")a=workflow.zoomfactor;if(this.bgColor!=null){this.graphics.setColor(this.bgColor.getHTMLStyle());this.graphics.fillOval(0,0,(this.getWidth()+2)*a,(this.getHeight()+2)*a)}if(this.lineColor!=null){this.graphics.setColor(this.lineColor.getHTMLStyle());this.graphics.drawOval(0,0,(this.getWidth()+2)*a,(this.getHeight()+
2)*a)}this.graphics.paint()};Circle=function(a){Oval.call(this);a&&this.setDimension(a,a)};Circle.prototype=new Oval;Circle.prototype.type="Circle";Circle.prototype.setDimension=function(a,b){a>b?Oval.prototype.setDimension.call(this,a,a):Oval.prototype.setDimension.call(this,b,b)};Circle.prototype.isStrechable=function(){return false};Rectangle=function(a,b){this.bgColor=null;this.lineColor=new Color(0,0,0);this.lineStroke=1;Figure.call(this);a&&b&&this.setDimension(a,b)};Rectangle.prototype=new Figure;
Rectangle.prototype.type="Rectangle";Rectangle.prototype.dispose=function(){Figure.prototype.dispose.call(this);this.lineColor=this.bgColor=null};
Rectangle.prototype.createHTMLElement=function(){var a=Figure.prototype.createHTMLElement.call(this);a.style.width="auto";a.style.height="auto";a.style.margin="0px";a.style.padding="0px";a.style.border=this.lineStroke+"px solid "+this.lineColor.getHTMLStyle();a.style.fontSize="1px";a.style.lineHeight="1px";a.innerHTML="&nbsp";if(this.bgColor!=null)a.style.backgroundColor=this.bgColor.getHTMLStyle();return a};
Rectangle.prototype.setBackgroundColor=function(a){this.bgColor=a;this.html.style.backgroundColor=this.bgColor!=null?this.bgColor.getHTMLStyle():"transparent"};Rectangle.prototype.getBackgroundColor=function(){return this.bgColor};Rectangle.prototype.setColor=function(a){this.lineColor=a;this.html.style.border=this.lineColor!=null?this.lineStroke+"px solid "+this.lineColor.getHTMLStyle():this.lineStroke+"0px"};Rectangle.prototype.getColor=function(){return this.lineColor};
Rectangle.prototype.getWidth=function(){return Figure.prototype.getWidth.call(this)+2*this.lineStroke};Rectangle.prototype.getHeight=function(){return Figure.prototype.getHeight.call(this)+2*this.lineStroke};Rectangle.prototype.setDimension=function(a,b){return Figure.prototype.setDimension.call(this,a-2*this.lineStroke,b-2*this.lineStroke)};
Rectangle.prototype.setLineWidth=function(a){var b=a-this.lineStroke;this.setDimension(this.getWidth()-2*b,this.getHeight()-2*b);this.lineStroke=a;a="transparent";this.lineColor!=null&&(a=this.lineColor.getHTMLStyle());this.html.style.border=this.lineStroke+"px solid "+a};Rectangle.prototype.getLineWidth=function(){return this.lineStroke};ImageFigure=function(a){this.url=a;Node.call(this);this.setDimension(40,40)};ImageFigure.prototype=new Node;ImageFigure.prototype.type="Image";
ImageFigure.prototype.createHTMLElement=function(){var a=Node.prototype.createHTMLElement.call(this);a.style.width=this.width+"px";a.style.height=this.height+"px";a.style.margin="0px";a.style.padding="0px";a.style.border="0px";a.style.backgroundImage=this.url!=null?"url("+this.url+")":"";return a};ImageFigure.prototype.setColor=function(){};ImageFigure.prototype.isResizeable=function(){return false};
ImageFigure.prototype.setImage=function(a){this.url=a;this.html.style.backgroundImage=this.url!=null?"url("+this.url+")":""};
Port=function(a,b){Corona=function(){};Corona.prototype=new Circle;Corona.prototype.setAlpha=function(a){Circle.prototype.setAlpha.call(this,Math.min(0.3,a))};this.currentUIRepresentation=a==null?new Circle:a;if(b==null){this.connectedUIRepresentation=new Circle;this.connectedUIRepresentation.setColor(null)}else this.connectedUIRepresentation=b;this.disconnectedUIRepresentation=this.currentUIRepresentation;this.hideIfConnected=false;this.uiRepresentationAdded=true;this.parentNode=null;this.originY=
this.originX=0;this.coronaWidth=10;this.corona=null;Rectangle.call(this);this.setDimension(8,8);this.setBackgroundColor(new Color(100,180,100));this.setColor(new Color(90,150,90));Rectangle.prototype.setColor.call(this,null);this.dropable=new DropTarget(this.html);this.dropable.node=this;this.dropable.addEventListener("dragenter",function(a){a.target.node.onDragEnter(a.relatedTarget.node)});this.dropable.addEventListener("dragleave",function(a){a.target.node.onDragLeave(a.relatedTarget.node)});this.dropable.addEventListener("drop",
function(a){a.relatedTarget.node.onDrop(a.target.node)})};Port.prototype=new Rectangle;Port.prototype.type="Port";Port.ZOrderBaseIndex=5E3;Port.setZOrderBaseIndex=function(a){Port.ZOrderBaseIndex=a};Port.prototype.setHideIfConnected=function(a){this.hideIfConnected=a};
Port.prototype.dispose=function(){for(var a=this.moveListener.getSize(),b=0;b<a;b++){var c=this.moveListener.get(b);this.parentNode.workflow.removeFigure(c);c.dispose()}Rectangle.prototype.dispose.call(this);this.parentNode=null;this.dropable=this.dropable.node=null;this.disconnectedUIRepresentation.dispose();this.connectedUIRepresentation.dispose()};
Port.prototype.createHTMLElement=function(){var a=Rectangle.prototype.createHTMLElement.call(this);a.style.zIndex=Port.ZOrderBaseIndex;this.currentUIRepresentation.html.zIndex=Port.ZOrderBaseIndex;a.appendChild(this.currentUIRepresentation.html);this.uiRepresentationAdded=true;return a};Port.prototype.setUiRepresentation=function(a){a==null&&(a=new Figure);this.html.appendChild(a.getHTMLElement());a.paint();this.currentUIRepresentation=a};Port.prototype.onMouseEnter=function(){this.setLineWidth(2)};
Port.prototype.onMouseLeave=function(){this.setLineWidth(0)};Port.prototype.setDimension=function(a,b){Rectangle.prototype.setDimension.call(this,a,b);this.connectedUIRepresentation.setDimension(a,b);this.disconnectedUIRepresentation.setDimension(a,b);this.setPosition(this.x,this.y)};Port.prototype.setBackgroundColor=function(a){this.currentUIRepresentation.setBackgroundColor(a)};Port.prototype.getBackgroundColor=function(){return this.currentUIRepresentation.getBackgroundColor()};
Port.prototype.getConnections=function(){for(var a=new ArrayList,b=this.moveListener.getSize(),c=0;c<b;c++){var d=this.moveListener.get(c);d instanceof Connection&&a.add(d)}return a};Port.prototype.setColor=function(a){this.currentUIRepresentation.setColor(a)};Port.prototype.getColor=function(){return this.currentUIRepresentation.getColor()};Port.prototype.setLineWidth=function(a){this.currentUIRepresentation.setLineWidth(a)};Port.prototype.getLineWidth=function(){return this.currentUIRepresentation.getLineWidth()};
Port.prototype.paint=function(){this.currentUIRepresentation.paint()};Port.prototype.setPosition=function(a,b){this.originX=a;this.originY=b;Rectangle.prototype.setPosition.call(this,a,b);if(this.html!=null){this.html.style.left=this.x-this.getWidth()/2+"px";this.html.style.top=this.y-this.getHeight()/2+"px"}};Port.prototype.setParent=function(a){this.parentNode!=null&&this.parentNode.detachMoveListener(this);this.parentNode=a;this.parentNode!=null&&this.parentNode.attachMoveListener(this)};
Port.prototype.attachMoveListener=function(a){Rectangle.prototype.attachMoveListener.call(this,a);this.hideIfConnected==true&&this.setUiRepresentation(this.connectedUIRepresentation)};Port.prototype.detachMoveListener=function(a){Rectangle.prototype.detachMoveListener.call(this,a);this.getConnections().getSize()==0&&this.setUiRepresentation(this.disconnectedUIRepresentation)};Port.prototype.getParent=function(){return this.parentNode};
Port.prototype.onDrag=function(){Rectangle.prototype.onDrag.call(this);this.parentNode.workflow.showConnectionLine(this.parentNode.x+this.x,this.parentNode.y+this.y,this.parentNode.x+this.originX,this.parentNode.y+this.originY)};Port.prototype.getCoronaWidth=function(){return this.coronaWidth};Port.prototype.setCoronaWidth=function(a){this.coronaWidth=a};Port.prototype.onDragend=function(){this.setAlpha(1);this.setPosition(this.originX,this.originY);this.parentNode.workflow.hideConnectionLine()};
Port.prototype.setOrigin=function(a,b){this.originX=a;this.originY=b};Port.prototype.onDragEnter=function(){this.parentNode.workflow.connectionLine.setColor(new Color(0,150,0));this.parentNode.workflow.connectionLine.setLineWidth(3);this.showCorona(true)};Port.prototype.onDragLeave=function(){this.parentNode.workflow.connectionLine.setColor(new Color(0,0,0));this.parentNode.workflow.connectionLine.setLineWidth(1);this.showCorona(false)};
Port.prototype.onDrop=function(a){if(this.parentNode.id!=a.parentNode.id){a=new CommandConnect(this.parentNode.workflow,a,this);this.parentNode.workflow.getCommandStack().execute(a)}};Port.prototype.getAbsolutePosition=function(){return new Point(this.getAbsoluteX(),this.getAbsoluteY())};Port.prototype.getAbsoluteBounds=function(){return new Dimension(this.getAbsoluteX(),this.getAbsoluteY(),this.getWidth(),this.getHeight())};Port.prototype.getAbsoluteY=function(){return this.originY+this.parentNode.getY()};
Port.prototype.getAbsoluteX=function(){return this.originX+this.parentNode.getX()};Port.prototype.onOtherFigureMoved=function(){this.fireMoveEvent()};Port.prototype.getName=function(){return this.getProperty("name")};Port.prototype.setName=function(a){this.setProperty("name",a)};
Port.prototype.isOver=function(a,b){var c=this.getAbsoluteX()-this.coronaWidth-this.getWidth()/2,d=this.getAbsoluteY()-this.coronaWidth-this.getHeight()/2,e=c+this.width+this.coronaWidth*2+this.getWidth()/2,f=d+this.height+this.coronaWidth*2+this.getHeight()/2;return a>=c&&a<=e&&b>=d&&b<=f};
Port.prototype.showCorona=function(a){if(a==true){this.corona=new Corona;this.corona.setAlpha(0.3);this.corona.setBackgroundColor(new Color(0,125,125));this.corona.setColor(null);this.corona.setDimension(this.getWidth()+this.getCoronaWidth()*2,this.getWidth()+this.getCoronaWidth()*2);this.parentNode.getWorkflow().addFigure(this.corona,this.getAbsoluteX()-this.getCoronaWidth()-this.getWidth()/2,this.getAbsoluteY()-this.getCoronaWidth()-this.getHeight()/2)}else if(a==false&&this.corona!=null){this.parentNode.getWorkflow().removeFigure(this.corona);
this.corona=null}};InputPort=function(a){Port.call(this,a)};InputPort.prototype=new Port;InputPort.prototype.type="InputPort";InputPort.prototype.onDrop=function(a){if(!(a.getMaxFanOut&&a.getMaxFanOut()<=a.getFanOut())&&this.parentNode.id!=a.parentNode.id&&a instanceof OutputPort){a=new CommandConnect(this.parentNode.workflow,a,this);this.parentNode.workflow.getCommandStack().execute(a)}};
InputPort.prototype.onDragEnter=function(a){if(a instanceof OutputPort)Port.prototype.onDragEnter.call(this,a);else if(a instanceof LineStartResizeHandle){a=this.workflow.currentSelection;a instanceof Connection&&a.getSource()instanceof InputPort&&Port.prototype.onDragEnter.call(this,a.getSource())}else if(a instanceof LineEndResizeHandle){a=this.workflow.currentSelection;a instanceof Connection&&a.getTarget()instanceof InputPort&&Port.prototype.onDragEnter.call(this,a.getTarget())}};
InputPort.prototype.onDragLeave=function(a){if(a instanceof OutputPort)Port.prototype.onDragLeave.call(this,a);else if(a instanceof LineStartResizeHandle){a=this.workflow.currentSelection;a instanceof Connection&&a.getSource()instanceof InputPort&&Port.prototype.onDragLeave.call(this,a.getSource())}else if(a instanceof LineEndResizeHandle){a=this.workflow.currentSelection;a instanceof Connection&&a.getTarget()instanceof InputPort&&Port.prototype.onDragLeave.call(this,a.getTarget())}};
OutputPort=function(a){Port.call(this,a);this.maxFanOut=100};OutputPort.prototype=new Port;OutputPort.prototype.type="OutputPort";OutputPort.prototype.onDrop=function(a){if(!(this.getMaxFanOut()<=this.getFanOut())&&this.parentNode.id!=a.parentNode.id&&a instanceof InputPort){a=new CommandConnect(this.parentNode.workflow,this,a);this.parentNode.workflow.getCommandStack().execute(a)}};
OutputPort.prototype.onDragEnter=function(a){if(!(this.getMaxFanOut()<=this.getFanOut()))if(a instanceof InputPort)Port.prototype.onDragEnter.call(this,a);else if(a instanceof LineStartResizeHandle){a=this.workflow.currentSelection;a instanceof Connection&&a.getSource()instanceof OutputPort&&Port.prototype.onDragEnter.call(this,a.getSource())}else if(a instanceof LineEndResizeHandle){a=this.workflow.currentSelection;a instanceof Connection&&a.getTarget()instanceof OutputPort&&Port.prototype.onDragEnter.call(this,
a.getTarget())}};OutputPort.prototype.onDragLeave=function(a){if(a instanceof InputPort)Port.prototype.onDragLeave.call(this,a);else if(a instanceof LineStartResizeHandle){a=this.workflow.currentSelection;a instanceof Connection&&a.getSource()instanceof OutputPort&&Port.prototype.onDragLeave.call(this,a.getSource())}else if(a instanceof LineEndResizeHandle){a=this.workflow.currentSelection;a instanceof Connection&&a.getTarget()instanceof OutputPort&&Port.prototype.onDragLeave.call(this,a.getTarget())}};
OutputPort.prototype.onDragstart=function(){return this.maxFanOut==-1?true:this.getMaxFanOut()<=this.getFanOut()?false:true};OutputPort.prototype.setMaxFanOut=function(a){this.maxFanOut=a};OutputPort.prototype.getMaxFanOut=function(){return this.maxFanOut};
OutputPort.prototype.getFanOut=function(){if(this.getParent().workflow==null)return 0;for(var a=0,b=this.getParent().workflow.getLines(),c=b.getSize(),d=0;d<c;d++){var e=b.get(d);e instanceof Connection&&(e.getSource()==this?a++:e.getTarget()==this&&a++)}return a};
Line=function(){this.lineColor=new Color(0,0,0);this.stroke=1;this.graphics=this.html=this.workflow=this.canvas=null;this.id=this.generateUId();this.startY=this.startX=30;this.endY=this.endX=100;this.alpha=1;this.isMoving=false;this.zOrder=Line.ZOrderBaseIndex;this.moveListener=new ArrayList;this.setSelectable(true);this.setDeleteable(true)};Line.ZOrderBaseIndex=200;Line.setZOrderBaseIndex=function(a){Line.ZOrderBaseIndex=a};
Line.prototype.dispose=function(){this.workflow=this.canvas=null;this.graphics!=null&&this.graphics.clear();this.graphics=null};Line.prototype.getZOrder=function(){return this.zOrder};Line.prototype.setZOrder=function(a){if(this.html!=null)this.html.style.zIndex=a;this.zOrder=a};
Line.prototype.createHTMLElement=function(){var a=document.createElement("div");a.id=this.id;a.style.position="absolute";a.style.left="0px";a.style.top="0px";a.style.height="0px";a.style.width="0px";a.style.zIndex=this.zOrder;return a};Line.prototype.getHTMLElement=function(){if(this.html==null)this.html=this.createHTMLElement();return this.html};Line.prototype.getWorkflow=function(){return this.workflow};Line.prototype.isResizeable=function(){return true};
Line.prototype.setCanvas=function(a){this.canvas=a;this.graphics!=null&&this.graphics.clear();this.graphics=null};Line.prototype.setWorkflow=function(a){this.workflow=a;this.graphics!=null&&this.graphics.clear();this.graphics=null};
Line.prototype.paint=function(){this.graphics==null?this.graphics=new jsGraphics(this.id):this.graphics.clear();this.graphics.setStroke(this.stroke);this.graphics.setColor(this.lineColor.getHTMLStyle());this.graphics.drawLine(this.startX,this.startY,this.endX,this.endY);this.graphics.paint()};Line.prototype.attachMoveListener=function(a){this.moveListener.add(a)};Line.prototype.detachMoveListener=function(a){this.moveListener.remove(a)};
Line.prototype.fireMoveEvent=function(){for(var a=this.moveListener.getSize(),b=0;b<a;b++)this.moveListener.get(b).onOtherFigureMoved(this)};Line.prototype.onOtherFigureMoved=function(){};Line.prototype.setLineWidth=function(a){this.stroke=a;this.graphics!=null&&this.paint();this.setDocumentDirty()};Line.prototype.setColor=function(a){this.lineColor=a;this.graphics!=null&&this.paint();this.setDocumentDirty()};Line.prototype.getColor=function(){return this.lineColor};
Line.prototype.setAlpha=function(a){if(a!=this.alpha){try{this.html.style.MozOpacity=a}catch(b){}try{this.html.style.opacity=a}catch(c){}try{var d=Math.round(a*100);this.html.style.filter=d>=99?"":"alpha(opacity="+d+")"}catch(e){}this.alpha=a}};Line.prototype.setStartPoint=function(a,b){this.startX=a;this.startY=b;this.graphics!=null&&this.paint();this.setDocumentDirty()};Line.prototype.setEndPoint=function(a,b){this.endX=a;this.endY=b;this.graphics!=null&&this.paint();this.setDocumentDirty()};
Line.prototype.getStartX=function(){return this.startX};Line.prototype.getStartY=function(){return this.startY};Line.prototype.getStartPoint=function(){return new Point(this.startX,this.startY)};Line.prototype.getEndX=function(){return this.endX};Line.prototype.getEndY=function(){return this.endY};Line.prototype.getEndPoint=function(){return new Point(this.endX,this.endY)};Line.prototype.isSelectable=function(){return this.selectable};Line.prototype.setSelectable=function(a){this.selectable=a};
Line.prototype.isDeleteable=function(){return this.deleteable};Line.prototype.setDeleteable=function(a){this.deleteable=a};Line.prototype.getLength=function(){return Math.sqrt((this.startX-this.endX)*(this.startX-this.endX)+(this.startY-this.endY)*(this.startY-this.endY))};Line.prototype.getAngle=function(){var a=this.getLength(),a=-(180/Math.PI)*Math.asin((this.startY-this.endY)/a);a<0?a=this.endX<this.startX?Math.abs(a)+180:360-Math.abs(a):this.endX<this.startX&&(a=180-a);return a};
Line.prototype.onContextMenu=function(a,b){var c=this.getContextMenu();c!=null&&this.workflow.showMenu(c,a,b)};Line.prototype.getContextMenu=function(){return null};Line.prototype.onDoubleClick=function(){};Line.prototype.setDocumentDirty=function(){this.workflow!=null&&this.workflow.setDocumentDirty()};
Line.prototype.generateUId=function(){for(nbTry=0;nbTry<1E3;){for(var a="",b=0;b<10;b++)var c=Math.floor(Math.random()*61),a=a+"0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".substring(c,c+1);elem=document.getElementById(a);if(!elem)return a;nbTry=nbTry+1}return null};Line.prototype.containsPoint=function(a,b){return Line.hit(this.startX,this.startY,this.endX,this.endY,a,b)};
Line.hit=function(a,b,c,d,e,f){c=c-a;d=d-b;e=e-a;f=f-b;if(e*c+f*d<=0)c=0;else{e=c-e;f=d-f;a=e*c+f*d;c=a<=0?0:a*a/(c*c+d*d)}e=e*e+f*f-c;e<0&&(e=0);return Math.sqrt(e)<5};ConnectionRouter=function(){};ConnectionRouter.prototype.type="ConnectionRouter";ConnectionRouter.prototype.getDirection=function(a,b){var c=Math.abs(a.x-b.x),d=3,e=Math.abs(a.y-b.y);if(e<=c){c=e;d=0}e=Math.abs(a.getBottom()-b.y);if(e<=c){c=e;d=2}e=Math.abs(a.getRight()-b.x);e<c&&(d=1);return d};
ConnectionRouter.prototype.getEndDirection=function(a){var b=a.getEndPoint(),a=a.getTarget().getParent().getBounds();return this.getDirection(a,b)};ConnectionRouter.prototype.getStartDirection=function(a){var b=a.getStartPoint(),a=a.getSource().getParent().getBounds();return this.getDirection(a,b)};ConnectionRouter.prototype.route=function(){};NullConnectionRouter=function(){};NullConnectionRouter.prototype=new ConnectionRouter;NullConnectionRouter.prototype.type="NullConnectionRouter";
NullConnectionRouter.prototype.invalidate=function(){};NullConnectionRouter.prototype.route=function(a){a.addPoint(a.getStartPoint());a.addPoint(a.getEndPoint())};ManhattanConnectionRouter=function(){this.MINDIST=20};ManhattanConnectionRouter.prototype=new ConnectionRouter;ManhattanConnectionRouter.prototype.type="ManhattanConnectionRouter";
ManhattanConnectionRouter.prototype.route=function(a){var b=a.getStartPoint(),c=this.getStartDirection(a),d=a.getEndPoint(),e=this.getEndDirection(a);this._route(a,d,e,b,c)};
ManhattanConnectionRouter.prototype._route=function(a,b,c,d,e){var f=b.x-d.x,g=b.y-d.y,h,i;if(f*f<0.01&&g*g<0.01)a.addPoint(new Point(d.x,d.y));else{if(c==3)if(f>0&&g*g<0.1&&e==1){h=d;i=e}else{if(f<0)h=new Point(b.x-this.MINDIST,b.y);else if(g>0&&e==2||g<0&&e==0)h=new Point(d.x,b.y);else if(c==e){c=Math.min(b.x,d.x)-this.MINDIST;h=new Point(c,b.y)}else h=new Point(b.x-f/2,b.y);i=g>0?0:2}else if(c==1)if(f<0&&g*g<0.1&&e==3){h=d;i=e}else{if(f>0)h=new Point(b.x+this.MINDIST,b.y);else if(g>0&&e==2||g<
0&&e==0)h=new Point(d.x,b.y);else if(c==e){c=Math.max(b.x,d.x)+this.MINDIST;h=new Point(c,b.y)}else h=new Point(b.x-f/2,b.y);i=g>0?0:2}else if(c==2)if(f*f<0.1&&g<0&&e==0){h=d;i=e}else{if(g>0)h=new Point(b.x,b.y+this.MINDIST);else if(f>0&&e==1||f<0&&e==3)h=new Point(b.x,d.y);else if(c==e){c=Math.max(b.y,d.y)+this.MINDIST;h=new Point(b.x,c)}else h=new Point(b.x,b.y-g/2);i=f>0?3:1}else if(c==0)if(f*f<0.1&&g>0&&e==2){h=d;i=e}else{if(g<0)h=new Point(b.x,b.y-this.MINDIST);else if(f>0&&e==1||f<0&&e==3)h=
new Point(b.x,d.y);else if(c==e){c=Math.min(b.y,d.y)-this.MINDIST;h=new Point(b.x,c)}else h=new Point(b.x,b.y-g/2);i=f>0?3:1}this._route(a,h,i,d,e);a.addPoint(b)}};BezierConnectionRouter=function(a){this.cheapRouter=a?null:new ManhattanConnectionRouter;this.iteration=5};BezierConnectionRouter.prototype=new ConnectionRouter;BezierConnectionRouter.prototype.type="BezierConnectionRouter";
BezierConnectionRouter.prototype.drawBezier=function(a,b,c,d){for(var e=a.length-1,f=[],g=e+1,h=0;h<g;h++){f[h]=[];f[h][0]=a[h]}for(a=1;a<=e;a++)for(h=0;h<=e-a;h++)f[h][a]=new Point((1-c)*f[h][a-1].x+c*f[h+1][a-1].x,(1-c)*f[h][a-1].y+c*f[h+1][a-1].y);a=[];g=[];for(h=0;h<e+1;h++){a[h]=f[0][h];g[h]=f[h][e-h]}if(d>=0){this.drawBezier(a,b,c,--d);this.drawBezier(g,b,c,--d)}else for(h=0;h<e;h++)b.push(f[h][e-h])};
BezierConnectionRouter.prototype.route=function(a){if(this.cheapRouter!=null&&(a.getSource().getParent().isMoving==true||a.getTarget().getParent().isMoving==true))this.cheapRouter.route(a);else{var b=[],c=a.getStartPoint(),d=a.getEndPoint();this._route(b,a,d,this.getEndDirection(a),c,this.getStartDirection(a));c=[];this.drawBezier(b,c,0.5,this.iteration);for(b=0;b<c.length;b++)a.addPoint(c[b]);a.addPoint(d)}};
BezierConnectionRouter.prototype._route=function(a,b,c,d,e,f){var g=c.x-e.x,h=c.y-e.y,i,k;if(g*g<0.01&&h*h<0.01)a.push(new Point(e.x,e.y));else{if(d==3)if(g>0&&h*h<0.1&&f==1){i=e;k=f}else{if(g<0)i=new Point(c.x-90,c.y);else if(h>0&&f==2||h<0&&f==0)i=new Point(e.x,c.y);else if(d==f){d=Math.min(c.x,e.x)-90;i=new Point(d,c.y)}else i=new Point(c.x-g/2,c.y);k=h>0?0:2}else if(d==1)if(g<0&&h*h<0.1&&f==3){i=e;k=f}else{if(g>0)i=new Point(c.x+90,c.y);else if(h>0&&f==2||h<0&&f==0)i=new Point(e.x,c.y);else if(d==
f){d=Math.max(c.x,e.x)+90;i=new Point(d,c.y)}else i=new Point(c.x-g/2,c.y);k=h>0?0:2}else if(d==2)if(g*g<0.1&&h<0&&f==0){i=e;k=f}else{if(h>0)i=new Point(c.x,c.y+90);else if(g>0&&f==1||g<0&&f==3)i=new Point(c.x,e.y);else if(d==f){d=Math.max(c.y,e.y)+90;i=new Point(c.x,d)}else i=new Point(c.x,c.y-h/2);k=g>0?3:1}else if(d==0)if(g*g<0.1&&h>0&&f==2){i=e;k=f}else{if(h<0)i=new Point(c.x,c.y-90);else if(g>0&&f==1||g<0&&f==3)i=new Point(c.x,e.y);else if(d==f){d=Math.min(c.y,e.y)-90;i=new Point(c.x,d)}else i=
new Point(c.x,c.y-h/2);k=g>0?3:1}this._route(a,b,i,k,e,f);a.push(c)}};FanConnectionRouter=function(){};FanConnectionRouter.prototype=new NullConnectionRouter;FanConnectionRouter.prototype.type="FanConnectionRouter";
FanConnectionRouter.prototype.route=function(a){a.getStartPoint();a.getEndPoint();for(var b=a.getSource().getConnections(),c=new ArrayList,d=0,e=0;e<b.getSize();e++){var f=b.get(e);if(f.getTarget()==a.getTarget()||f.getSource()==a.getTarget()){c.add(f);a==f&&(d=c.getSize())}}c.getSize()>1?this.routeCollision(a,d):NullConnectionRouter.prototype.route.call(this,a)};FanConnectionRouter.prototype.routeNormal=function(a){a.addPoint(a.getStartPoint());a.addPoint(a.getEndPoint())};
FanConnectionRouter.prototype.routeCollision=function(a,b){var c=a.getStartPoint(),d=a.getEndPoint();a.addPoint(c);var e=new Point((d.x+c.x)/2,(d.y+c.y)/2),f=d.getPosition(c),f=f==PositionConstants.SOUTH||f==PositionConstants.EAST?new Point(d.x-c.x,d.y-c.y):new Point(c.x-d.x,c.y-d.y),g=Math.sqrt(f.x*f.x+f.y*f.y),c=10*f.x/g,f=10*f.y/g,e=b%2==0?new Point(e.x+b/2*-1*f,e.y+b/2*c):new Point(e.x+b/2*f,e.y+b/2*-1*c);a.addPoint(e);a.addPoint(d)};
Graphics=function(a,b,c){this.jsGraphics=a;this.xt=c.x;this.yt=c.y;this.radian=b*Math.PI/180;this.sinRadian=Math.sin(this.radian);this.cosRadian=Math.cos(this.radian)};Graphics.prototype.setStroke=function(a){this.jsGraphics.setStroke(a)};Graphics.prototype.drawLine=function(a,b,c,d){this.jsGraphics.drawLine(this.xt+a*this.cosRadian-b*this.sinRadian,this.yt+a*this.sinRadian+b*this.cosRadian,this.xt+c*this.cosRadian-d*this.sinRadian,this.yt+c*this.sinRadian+d*this.cosRadian)};
Graphics.prototype.fillRect=function(a,b,c,d){this.jsGraphics.fillPolygon([this.xt+a*this.cosRadian-b*this.sinRadian,this.xt+(a+c)*this.cosRadian-b*this.sinRadian,this.xt+(a+c)*this.cosRadian-(b+d)*this.sinRadian,this.xt+a*this.cosRadian-(b+d)*this.sinRadian],[this.yt+a*this.sinRadian+b*this.cosRadian,this.yt+(a+c)*this.sinRadian+b*this.cosRadian,this.yt+(a+c)*this.sinRadian+(b+d)*this.cosRadian,this.yt+a*this.sinRadian+(b+d)*this.cosRadian])};
Graphics.prototype.fillPolygon=function(a,b){for(var c=[],d=[],e=0;e<a.length;e++){c[e]=this.xt+a[e]*this.cosRadian-b[e]*this.sinRadian;d[e]=this.yt+a[e]*this.sinRadian+b[e]*this.cosRadian}this.jsGraphics.fillPolygon(c,d)};Graphics.prototype.setColor=function(a){this.jsGraphics.setColor(a.getHTMLStyle())};
Graphics.prototype.drawPolygon=function(a,b){for(var c=[],d=[],e=0;e<a.length;e++){c[e]=this.xt+a[e]*this.cosRadian-b[e]*this.sinRadian;d[e]=this.yt+a[e]*this.sinRadian+b[e]*this.cosRadian}this.jsGraphics.drawPolygon(c,d)};
Connection=function(){Line.call(this);this.targetDecorator=this.sourceDecorator=this.targetPort=this.sourcePort=null;this.sourceAnchor=new ConnectionAnchor;this.targetAnchor=new ConnectionAnchor;this.router=Connection.defaultRouter;this.lineSegments=new ArrayList;this.children=new ArrayList;this.setColor(new Color(0,0,115));this.setLineWidth(1)};Connection.prototype=new Line;Connection.defaultRouter=new ManhattanConnectionRouter;Connection.setDefaultRouter=function(a){Connection.defaultRouter=a};
Connection.prototype.disconnect=function(){if(this.sourcePort!=null){this.sourcePort.detachMoveListener(this);this.fireSourcePortRouteEvent()}if(this.targetPort!=null){this.targetPort.detachMoveListener(this);this.fireTargetPortRouteEvent()}};Connection.prototype.reconnect=function(){if(this.sourcePort!=null){this.sourcePort.attachMoveListener(this);this.fireSourcePortRouteEvent()}if(this.targetPort!=null){this.targetPort.attachMoveListener(this);this.fireTargetPortRouteEvent()}};
Connection.prototype.isResizeable=function(){return true};Connection.prototype.addFigure=function(a,b){var c={};c.figure=a;c.locator=b;this.children.add(c);this.graphics!=null&&this.paint()};Connection.prototype.setSourceDecorator=function(a){this.sourceDecorator=a;this.graphics!=null&&this.paint()};Connection.prototype.setTargetDecorator=function(a){this.targetDecorator=a;this.graphics!=null&&this.paint()};
Connection.prototype.setSourceAnchor=function(a){this.sourceAnchor=a;this.sourceAnchor.setOwner(this.sourcePort);this.graphics!=null&&this.paint()};Connection.prototype.setTargetAnchor=function(a){this.targetAnchor=a;this.targetAnchor.setOwner(this.targetPort);this.graphics!=null&&this.paint()};Connection.prototype.setRouter=function(a){this.router=a!=null?a:new NullConnectionRouter;this.graphics!=null&&this.paint()};Connection.prototype.getRouter=function(){return this.router};
Connection.prototype.paint=function(){for(var a=0;a<this.children.getSize();a++){var b=this.children.get(a);b.isAppended==true&&this.html.removeChild(b.figure.getHTMLElement());b.isAppended=false}this.graphics==null?this.graphics=new jsGraphics(this.id):this.graphics.clear();this.graphics.setStroke(this.stroke);this.graphics.setColor(this.lineColor.getHTMLStyle());this.startStroke();this.router.route(this);if(this.getSource().getParent().isMoving==false&&this.getTarget().getParent().isMoving==false){this.targetDecorator!=
null&&this.targetDecorator.paint(new Graphics(this.graphics,this.getEndAngle(),this.getEndPoint()));this.sourceDecorator!=null&&this.sourceDecorator.paint(new Graphics(this.graphics,this.getStartAngle(),this.getStartPoint()))}this.finishStroke();for(a=0;a<this.children.getSize();a++){b=this.children.get(a);this.html.appendChild(b.figure.getHTMLElement());b.isAppended=true;b.locator.relocate(b.figure)}};
Connection.prototype.getStartPoint=function(){return this.isMoving==false?this.sourceAnchor.getLocation(this.targetAnchor.getReferencePoint()):Line.prototype.getStartPoint.call(this)};Connection.prototype.getEndPoint=function(){return this.isMoving==false?this.targetAnchor.getLocation(this.sourceAnchor.getReferencePoint()):Line.prototype.getEndPoint.call(this)};Connection.prototype.startStroke=function(){this.oldPoint=null;this.lineSegments=new ArrayList};
Connection.prototype.finishStroke=function(){this.graphics.paint();this.oldPoint=null};Connection.prototype.getPoints=function(){for(var a=new ArrayList,b,c=0;c<this.lineSegments.getSize();c++){b=this.lineSegments.get(c);a.add(b.start)}a.add(b.end);return a};
Connection.prototype.addPoint=function(a){a=new Point(parseInt(a.x),parseInt(a.y));if(this.oldPoint!=null){this.graphics.drawLine(this.oldPoint.x,this.oldPoint.y,a.x,a.y);var b={};b.start=this.oldPoint;b.end=a;this.lineSegments.add(b)}this.oldPoint={};this.oldPoint.x=a.x;this.oldPoint.y=a.y};
Connection.prototype.setSource=function(a){this.sourcePort!=null&&this.sourcePort.detachMoveListener(this);this.sourcePort=a;if(this.sourcePort!=null){this.sourceAnchor.setOwner(this.sourcePort);this.fireSourcePortRouteEvent();this.sourcePort.attachMoveListener(this);this.setStartPoint(a.getAbsoluteX(),a.getAbsoluteY())}};Connection.prototype.getSource=function(){return this.sourcePort};
Connection.prototype.setTarget=function(a){this.targetPort!=null&&this.targetPort.detachMoveListener(this);this.targetPort=a;if(this.targetPort!=null){this.targetAnchor.setOwner(this.targetPort);this.fireTargetPortRouteEvent();this.targetPort.attachMoveListener(this);this.setEndPoint(a.getAbsoluteX(),a.getAbsoluteY())}};Connection.prototype.getTarget=function(){return this.targetPort};
Connection.prototype.onOtherFigureMoved=function(a){a==this.sourcePort?this.setStartPoint(this.sourcePort.getAbsoluteX(),this.sourcePort.getAbsoluteY()):this.setEndPoint(this.targetPort.getAbsoluteX(),this.targetPort.getAbsoluteY())};Connection.prototype.containsPoint=function(a,b){for(var c=0;c<this.lineSegments.getSize();c++){var d=this.lineSegments.get(c);if(Line.hit(d.start.x,d.start.y,d.end.x,d.end.y,a,b))return true}return false};
Connection.prototype.getStartAngle=function(){var a=this.lineSegments.get(0).start,b=this.lineSegments.get(0).end;if(this.router instanceof BezierConnectionRouter)b=this.lineSegments.get(5).end;var c=Math.sqrt((a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y)),c=-(180/Math.PI)*Math.asin((a.y-b.y)/c);c<0?c=b.x<a.x?Math.abs(c)+180:360-Math.abs(c):b.x<a.x&&(c=180-c);return c};
Connection.prototype.getEndAngle=function(){var a=this.lineSegments.get(this.lineSegments.getSize()-1).end,b=this.lineSegments.get(this.lineSegments.getSize()-1).start;if(this.router instanceof BezierConnectionRouter)b=this.lineSegments.get(this.lineSegments.getSize()-5).end;var c=Math.sqrt((a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y)),c=-(180/Math.PI)*Math.asin((a.y-b.y)/c);c<0?c=b.x<a.x?Math.abs(c)+180:360-Math.abs(c):b.x<a.x&&(c=180-c);return c};
Connection.prototype.fireSourcePortRouteEvent=function(){for(var a=this.sourcePort.getConnections(),b=0;b<a.getSize();b++)a.get(b).paint()};Connection.prototype.fireTargetPortRouteEvent=function(){for(var a=this.targetPort.getConnections(),b=0;b<a.getSize();b++)a.get(b).paint()};ConnectionAnchor=function(a){this.owner=a};ConnectionAnchor.prototype.type="ConnectionAnchor";ConnectionAnchor.prototype.getLocation=function(){return this.getReferencePoint()};ConnectionAnchor.prototype.getOwner=function(){return this.owner};
ConnectionAnchor.prototype.setOwner=function(a){this.owner=a};ConnectionAnchor.prototype.getBox=function(){return this.getOwner().getAbsoluteBounds()};ConnectionAnchor.prototype.getReferencePoint=function(){return this.getOwner()==null?null:this.getOwner().getAbsolutePosition()};ChopboxConnectionAnchor=function(a){ConnectionAnchor.call(this,a)};ChopboxConnectionAnchor.prototype=new ConnectionAnchor;ChopboxConnectionAnchor.prototype.type="ChopboxConnectionAnchor";
ChopboxConnectionAnchor.prototype.getLocation=function(a){var b=new Dimension;b.setBounds(this.getBox());b.translate(-1,-1);b.resize(1,1);var c=b.x+b.w/2,d=b.y+b.h/2;if(b.isEmpty()||a.x==c&&a.y==d)return new Point(c,d);var e=a.x-c,a=a.y-d,b=0.5/Math.max(Math.abs(e)/b.w,Math.abs(a)/b.h),d=d+a*b;return new Point(Math.round(c+e*b),Math.round(d))};ChopboxConnectionAnchor.prototype.getBox=function(){return this.getOwner().getParent().getBounds()};ChopboxConnectionAnchor.prototype.getReferencePoint=function(){return this.getBox().getCenter()};
ConnectionDecorator=function(){this.color=new Color(0,0,0);this.backgroundColor=new Color(250,250,250)};ConnectionDecorator.prototype.type="ConnectionDecorator";ConnectionDecorator.prototype.paint=function(){};ConnectionDecorator.prototype.setColor=function(a){this.color=a};ConnectionDecorator.prototype.setBackgroundColor=function(a){this.backgroundColor=a};ArrowConnectionDecorator=function(){};ArrowConnectionDecorator.prototype=new ConnectionDecorator;ArrowConnectionDecorator.prototype.type="ArrowConnectionDecorator";
ArrowConnectionDecorator.prototype.paint=function(a){if(this.backgroundColor!=null){var b=1;if(typeof workflow.zoomfactor!=void 0&&workflow.zoomfactor!="")b=workflow.zoomfactor;a.setColor(this.backgroundColor);a.fillPolygon([1*b,10*b,10*b,1*b],[0,5*b,-5*b,0])}a.setColor(this.color);a.setStroke(1);a.drawPolygon([1*b,10*b,10*b,1*b],[0,5*b,-5*b,0]);a.fillPolygon([1*b,10*b,10*b,1*b],[0,5*b,-5*b,0])};
CompartmentFigure=function(){Node.call(this);this.children=new ArrayList;this.setBorder(new LineBorder(1));this.dropable=new DropTarget(this.html);this.dropable.node=this;this.dropable.addEventListener("figureenter",function(a){a.target.node.onFigureEnter(a.relatedTarget.node)});this.dropable.addEventListener("figureleave",function(a){a.target.node.onFigureLeave(a.relatedTarget.node)});this.dropable.addEventListener("figuredrop",function(a){a.target.node.onFigureDrop(a.relatedTarget.node)})};
CompartmentFigure.prototype=new Node;CompartmentFigure.prototype.type="CompartmentFigure";CompartmentFigure.prototype.onFigureEnter=function(){};CompartmentFigure.prototype.onFigureLeave=function(){};CompartmentFigure.prototype.onFigureDrop=function(){};CompartmentFigure.prototype.getChildren=function(){return this.children};CompartmentFigure.prototype.addChild=function(a){a.setZOrder(this.getZOrder()+1);a.setParent(this);this.children.add(a)};
CompartmentFigure.prototype.removeChild=function(a){a.setParent(null);this.children.remove(a)};CompartmentFigure.prototype.setZOrder=function(a){Node.prototype.setZOrder.call(this,a);for(var b=0;b<this.children.getSize();b++)this.children.get(b).setZOrder(a+1)};
CompartmentFigure.prototype.setPosition=function(a,b){var c=this.getX(),d=this.getY();Node.prototype.setPosition.call(this,a,b);for(var e=0;e<this.children.getSize();e++){var f=this.children.get(e);f.setPosition(f.getX()+this.getX()-c,f.getY()+this.getY()-d)}};CompartmentFigure.prototype.onDrag=function(){var a=this.getX(),b=this.getY();Node.prototype.onDrag.call(this);for(var c=0;c<this.children.getSize();c++){var d=this.children.get(c);d.setPosition(d.getX()+this.getX()-a,d.getY()+this.getY()-b)}};
Document=function(a){this.canvas=a};Document.prototype.getFigures=function(){for(var a=new ArrayList,b=this.canvas.figures,c=this.canvas.dialogs,d=0;d<b.getSize();d++){var e=b.get(d);c.indexOf(e)==-1&&(e.getParent()==null&&!(e instanceof Window))&&a.add(e)}return a};Document.prototype.getFigure=function(a){return this.canvas.getFigure(a)};Document.prototype.getLines=function(){return this.canvas.getLines()};
Annotation=function(a){this.msg=a;this.color=new Color(0,0,0);this.bgColor=new Color(241,241,121);this.fontSize=10;this.textNode=null;Figure.call(this)};Annotation.prototype=new Figure;Annotation.prototype.type="Annotation";
Annotation.prototype.createHTMLElement=function(){var a=Figure.prototype.createHTMLElement.call(this);a.style.color=this.color.getHTMLStyle();a.style.backgroundColor=this.bgColor.getHTMLStyle();a.style.fontSize=this.fontSize+"pt";a.style.width="auto";a.style.height="auto";a.style.margin="0px";a.style.padding="0px";a.onselectstart=function(){return false};a.unselectable="on";a.style.MozUserSelect="none";a.style.cursor="default";this.textNode=document.createTextNode(this.msg);a.appendChild(this.textNode);
this.disableTextSelection(a);return a};Annotation.prototype.onDoubleClick=function(){var a=new AnnotationDialog(this);this.workflow.showDialog(a)};Annotation.prototype.setBackgroundColor=function(a){this.bgColor=a;this.html.style.backgroundColor=this.bgColor!=null?this.bgColor.getHTMLStyle():"transparent"};Annotation.prototype.getBackgroundColor=function(){return this.bgColor};Annotation.prototype.setFontSize=function(a){this.fontSize=a;this.html.style.fontSize=this.fontSize+"pt"};
Annotation.prototype.getText=function(){return this.msg};Annotation.prototype.setText=function(a){this.msg=a;this.html.removeChild(this.textNode);this.textNode=document.createTextNode(this.msg);this.html.appendChild(this.textNode)};Annotation.prototype.setStyledText=function(a){this.msg=a;this.html.removeChild(this.textNode);this.textNode=document.createElement("div");this.textNode.innerHTML=a;this.html.appendChild(this.textNode)};
ResizeHandle=function(a,b){Rectangle.call(this,5,5);this.type=b;var c=this.getWidth(),d=c/2;switch(this.type){case 1:this.setSnapToGridAnchor(new Point(c,c));break;case 2:this.setSnapToGridAnchor(new Point(d,c));break;case 3:this.setSnapToGridAnchor(new Point(0,c));break;case 4:this.setSnapToGridAnchor(new Point(0,d));break;case 5:this.setSnapToGridAnchor(new Point(0,0));break;case 6:this.setSnapToGridAnchor(new Point(d,0));break;case 7:this.setSnapToGridAnchor(new Point(c,0));break;case 8:this.setSnapToGridAnchor(new Point(c,
d))}this.setBackgroundColor(new Color(0,255,0));this.setWorkflow(a);this.setZOrder(1E4)};ResizeHandle.prototype=new Rectangle;ResizeHandle.prototype.type="ResizeHandle";ResizeHandle.prototype.getSnapToDirection=function(){switch(this.type){case 1:return SnapToHelper.NORTH_WEST;case 2:return SnapToHelper.NORTH;case 3:return SnapToHelper.NORTH_EAST;case 4:return SnapToHelper.EAST;case 5:return SnapToHelper.SOUTH_EAST;case 6:return SnapToHelper.SOUTH;case 7:return SnapToHelper.SOUTH_WEST;case 8:return SnapToHelper.WEST}};
ResizeHandle.prototype.onDragend=function(){if(this.commandMove!=null){var a=this.workflow.currentSelection;this.commandMove.setPosition(a.getX(),a.getY());this.commandResize.setDimension(a.getWidth(),a.getHeight());this.workflow.getCommandStack().execute(this.commandResize);this.workflow.getCommandStack().execute(this.commandMove);this.commandResize=this.commandMove=null;this.workflow.hideSnapToHelperLines()}};
ResizeHandle.prototype.setPosition=function(a,b){this.x=a;this.y=b;this.html.style.left=this.x+"px";this.html.style.top=this.y+"px"};ResizeHandle.prototype.onDragstart=function(){if(!this.canDrag)return false;var a=this.workflow.currentSelection;this.commandMove=new CommandMove(a,a.getX(),a.getY());this.commandResize=new CommandResize(a,a.getWidth(),a.getHeight());return true};
ResizeHandle.prototype.onDrag=function(){var a=this.getX(),b=this.getY();Rectangle.prototype.onDrag.call(this);var a=a-this.getX(),b=b-this.getY(),c=this.workflow.currentSelection.getX(),d=this.workflow.currentSelection.getY(),e=this.workflow.currentSelection.getWidth(),f=this.workflow.currentSelection.getHeight();switch(this.type){case 1:this.workflow.currentSelection.setPosition(c-a,d-b);this.workflow.currentSelection.setDimension(e+a,f+b);break;case 2:this.workflow.currentSelection.setPosition(c,
d-b);this.workflow.currentSelection.setDimension(e,f+b);break;case 3:this.workflow.currentSelection.setPosition(c,d-b);this.workflow.currentSelection.setDimension(e-a,f+b);break;case 4:this.workflow.currentSelection.setPosition(c,d);this.workflow.currentSelection.setDimension(e-a,f);break;case 5:this.workflow.currentSelection.setPosition(c,d);this.workflow.currentSelection.setDimension(e-a,f-b);break;case 6:this.workflow.currentSelection.setPosition(c,d);this.workflow.currentSelection.setDimension(e,
f-b);break;case 7:this.workflow.currentSelection.setPosition(c-a,d);this.workflow.currentSelection.setDimension(e+a,f-b);break;case 8:this.workflow.currentSelection.setPosition(c-a,d);this.workflow.currentSelection.setDimension(e+a,f)}this.workflow.moveResizeHandles(this.workflow.getCurrentSelection())};
ResizeHandle.prototype.setCanDrag=function(a){Rectangle.prototype.setCanDrag.call(this,a);if(a)switch(this.type){case 1:this.html.style.cursor="nw-resize";break;case 2:this.html.style.cursor="s-resize";break;case 3:this.html.style.cursor="ne-resize";break;case 4:this.html.style.cursor="w-resize";break;case 5:this.html.style.cursor="se-resize";break;case 6:this.html.style.cursor="n-resize";break;case 7:this.html.style.cursor="sw-resize";break;case 8:this.html.style.cursor="e-resize"}else this.html.style.cursor=
""};ResizeHandle.prototype.onKeyDown=function(a,b){this.workflow.onKeyDown(a,b)};ResizeHandle.prototype.fireMoveEvent=function(){};LineStartResizeHandle=function(a){Rectangle.call(this);this.setDimension(10,10);this.setBackgroundColor(new Color(0,255,0));this.setWorkflow(a);this.setZOrder(1E4)};LineStartResizeHandle.prototype=new Rectangle;LineStartResizeHandle.prototype.type="LineStartResizeHandle";
LineStartResizeHandle.prototype.onDragend=function(){var a=this.workflow.currentSelection;if(a instanceof Connection){var b=a.sourceAnchor.getLocation(a.targetAnchor.getReferencePoint());a.setStartPoint(b.x,b.y);this.getWorkflow().showLineResizeHandles(a);a.setRouter(a.oldRouter)}else if(this.command!=null){var b=a.getStartX(),c=a.getStartY(),d=a.getEndX(),a=a.getEndY();this.command.setEndPoints(b,c,d,a);this.getWorkflow().getCommandStack().execute(this.command);this.command=null}};
LineStartResizeHandle.prototype.onDragstart=function(){if(!this.canDrag)return false;var a=this.workflow.currentSelection;if(a instanceof Connection){this.command=new CommandReconnect(a);a.oldRouter=a.getRouter();a.setRouter(new NullConnectionRouter)}else{var b=a.getStartX(),c=a.getStartY(),d=a.getEndX(),e=a.getEndY();this.command=new CommandMoveLine(a,b,c,d,e)}return true};
LineStartResizeHandle.prototype.onDrag=function(){var a=this.getX(),b=this.getY();Rectangle.prototype.onDrag.call(this);var a=a-this.getX(),b=b-this.getY(),c=this.workflow.currentSelection.getStartPoint(),d=this.workflow.currentSelection;d.setStartPoint(c.x-a,c.y-b);d.isMoving=true};
LineStartResizeHandle.prototype.onDrop=function(a){var b=this.workflow.currentSelection;b.isMoving=false;if(b instanceof Connection){this.command.setNewPorts(a,b.getTarget());this.getWorkflow().getCommandStack().execute(this.command)}this.command=null};LineStartResizeHandle.prototype.onKeyDown=function(a,b){if(this.workflow!=null)this.workflow.onKeyDown(a,b)};LineStartResizeHandle.prototype.fireMoveEvent=function(){};
LineEndResizeHandle=function(a){Rectangle.call(this);this.setDimension(10,10);this.setBackgroundColor(new Color(0,255,0));this.setWorkflow(a);this.setZOrder(1E4)};LineEndResizeHandle.prototype=new Rectangle;LineEndResizeHandle.prototype.type="LineEndResizeHandle";
LineEndResizeHandle.prototype.onDragend=function(){var a=this.workflow.currentSelection;if(a instanceof Connection){var b=a.targetAnchor.getLocation(a.sourceAnchor.getReferencePoint());a.setEndPoint(b.x,b.y);this.getWorkflow().showLineResizeHandles(a);a.setRouter(a.oldRouter)}else if(this.command!=null){var b=a.getStartX(),c=a.getStartY(),d=a.getEndX(),a=a.getEndY();this.command.setEndPoints(b,c,d,a);this.workflow.getCommandStack().execute(this.command);this.command=null}};
LineEndResizeHandle.prototype.onDragstart=function(){if(!this.canDrag)return false;var a=this.workflow.currentSelection;if(a instanceof Connection){this.command=new CommandReconnect(a);a.oldRouter=a.getRouter();a.setRouter(new NullConnectionRouter)}else{var b=a.getStartX(),c=a.getStartY(),d=a.getEndX(),e=a.getEndY();this.command=new CommandMoveLine(a,b,c,d,e)}return true};
LineEndResizeHandle.prototype.onDrag=function(){var a=this.getX(),b=this.getY();Rectangle.prototype.onDrag.call(this);var a=a-this.getX(),b=b-this.getY(),c=this.workflow.currentSelection.getEndPoint(),d=this.workflow.currentSelection;d.setEndPoint(c.x-a,c.y-b);d.isMoving=true};
LineEndResizeHandle.prototype.onDrop=function(a){var b=this.workflow.currentSelection;b.isMoving=false;if(b instanceof Connection){this.command.setNewPorts(b.getSource(),a);this.getWorkflow().getCommandStack().execute(this.command)}this.command=null};LineEndResizeHandle.prototype.onKeyDown=function(a){if(this.workflow!=null)this.workflow.onKeyDown(a)};LineEndResizeHandle.prototype.fireMoveEvent=function(){};
Canvas=function(a){a&&this.construct(a);this.enableSmoothFigureHandling=false;this.canvasLines=new ArrayList};Canvas.prototype.type="Canvas";Canvas.prototype.construct=function(a){this.canvasId=a;this.html=document.getElementById(this.canvasId);this.scrollArea=document.body.parentNode};Canvas.prototype.setViewPort=function(a){this.scrollArea=document.getElementById(a)};
Canvas.prototype.addFigure=function(a,b,c,d){if(this.enableSmoothFigureHandling==true){a.timer<=0&&a.setAlpha(0.001);a.timer>0&&window.clearInterval(a.timer);a.timer=window.setInterval(function(){if(a.alpha<1)a.setAlpha(Math.min(1,a.alpha+0.05));else{window.clearInterval(a.timer);a.timer=-1}},30)}a.setCanvas(this);b&&c&&a.setPosition(b,c);if(a instanceof Line){this.canvasLines.add(a);this.html.appendChild(a.getHTMLElement())}else{b=this.canvasLines.getFirstElement();b==null?this.html.appendChild(a.getHTMLElement()):
this.html.insertBefore(a.getHTMLElement(),b.getHTMLElement())}d||a.paint()};Canvas.prototype.removeFigure=function(a){if(this.enableSmoothFigureHandling==true){var b=this;a.timer>0&&window.clearInterval(a.timer);a.timer=window.setInterval(function(){if(a.alpha>0)a.setAlpha(Math.max(0,a.alpha-0.05));else{window.clearInterval(a.timer);a.timer=-1;b.html.removeChild(a.html);a.setCanvas(null)}},20)}else{this.html.removeChild(a.html);a.setCanvas(null)}a instanceof Line&&this.canvasLines.remove(a)};
Canvas.prototype.getEnableSmoothFigureHandling=function(){return this.enableSmoothFigureHandling};Canvas.prototype.setEnableSmoothFigureHandling=function(a){this.enableSmoothFigureHandling=a};Canvas.prototype.getWidth=function(){return parseInt(this.html.style.width)};Canvas.prototype.getHeight=function(){return parseInt(this.html.style.height)};Canvas.prototype.setBackgroundImage=function(a,b){this.html.style.background=a!=null?b?"transparent url("+a+") ":"transparent url("+a+") no-repeat":"transparent"};
Canvas.prototype.getY=function(){return this.y};Canvas.prototype.getX=function(){return this.x};Canvas.prototype.getAbsoluteY=function(){for(var a=this.html,b=a.offsetTop;(a=a.offsetParent)!=null;)b=b+a.offsetTop;return b};Canvas.prototype.getAbsoluteX=function(){for(var a=this.html,b=a.offsetLeft;(a=a.offsetParent)!=null;)b=b+a.offsetLeft;return b};Canvas.prototype.getScrollLeft=function(){return this.scrollArea.scrollLeft};Canvas.prototype.getScrollTop=function(){return this.scrollArea.scrollTop};
Workflow=function(a){if(a){this.gridWidthY=this.gridWidthX=10;this.horizontalSnapToHelperLine=this.verticalSnapToHelperLine=this.snapToGridHelper=null;this.figures=new ArrayList;this.lines=new ArrayList;this.commonPorts=new ArrayList;this.dropTargets=new ArrayList;this.compartments=new ArrayList;this.selectionListeners=new ArrayList;this.dialogs=new ArrayList;this.toolPalette=null;this.dragging=false;this.draggingLine=this.tooltip=null;this.commandStack=new CommandStack;this.oldScrollPosTop=this.oldScrollPosLeft=
0;this.currentMenu=this.currentSelection=null;this.connectionLine=new Line;this.resizeHandleStart=new LineStartResizeHandle(this);this.resizeHandleEnd=new LineEndResizeHandle(this);this.resizeHandle1=new ResizeHandle(this,1);this.resizeHandle2=new ResizeHandle(this,2);this.resizeHandle3=new ResizeHandle(this,3);this.resizeHandle4=new ResizeHandle(this,4);this.resizeHandle5=new ResizeHandle(this,5);this.resizeHandle6=new ResizeHandle(this,6);this.resizeHandle7=new ResizeHandle(this,7);this.resizeHandle8=
new ResizeHandle(this,8);this.resizeHandleHalfWidth=parseInt(this.resizeHandle2.getWidth()/2);Canvas.call(this,a);this.setPanning(false);if(this.html!=null){this.html.style.backgroundImage="url(grid_10.png)";b=this;this.html.tabIndex="0";a=function(a){var c=a||window.event,a=c.clientX,c=c.clientY,d=b.getScrollLeft(),e=b.getScrollTop(),f=b.getAbsoluteX(),g=b.getAbsoluteY();if(b.getBestFigure(a+d-f,c+e-g)==null){var m=b.getBestLine(a+d-f,c+e-g,null);if(m!=null)m.onContextMenu(a+d-f,c+e-g);else b.onContextMenu(a+
d-f,c+e-g)}};this.html.oncontextmenu=function(){return false};var b=this,c=function(a){b.onKeyDown(a.keyCode,a.ctrlKey)},d=function(a){var c=a||window.event,a=c.clientX,c=c.clientY,d=b.getScrollLeft(),e=b.getScrollTop(),f=b.getAbsoluteX(),g=b.getAbsoluteY();b.onMouseDown(a+d-f,c+e-g)},e=function(a){var c=a||window.event;if(b.currentMenu!=null){b.removeFigure(b.currentMenu);b.currentMenu=null}if(c.button!=2){var a=c.clientX,c=c.clientY,d=b.getScrollLeft(),e=b.getScrollTop(),f=b.getAbsoluteX(),g=b.getAbsoluteY();
b.onMouseUp(a+d-f,c+e-g)}},f=function(a){var c=a||window.event,d=c.clientX,e=c.clientY,f=b.getScrollLeft(),g=b.getScrollTop(),m=b.getAbsoluteX(),o=b.getAbsoluteY();b.currentMouseX=d+f-m;b.currentMouseY=e+g-o;a=b.getBestFigure(b.currentMouseX,b.currentMouseY);if(Drag.currentHover!=null&&a==null){c=new DragDropEvent;c.initDragDropEvent("mouseleave",false,b);Drag.currentHover.dispatchEvent(c)}else{d=c.clientX;e=c.clientY;f=b.getScrollLeft();g=b.getScrollTop();m=b.getAbsoluteX();o=b.getAbsoluteY();b.onMouseMove(d+
f-m,e+g-o)}if(a==null)Drag.currentHover=null;b.tooltip!=null&&(Math.abs(b.currentTooltipX-b.currentMouseX)>10||Math.abs(b.currentTooltipY-b.currentMouseY)>10)&&b.showTooltip(null)},g=function(a){var a=a||window.event,c=a.clientX,a=a.clientY,d=b.getScrollLeft(),e=b.getScrollTop(),f=b.getAbsoluteX(),g=b.getAbsoluteY(),c=b.getBestLine(c+d-f,a+e-g,null);if(c!=null)c.onDoubleClick()};if(this.html.addEventListener){this.html.addEventListener("contextmenu",a,false);this.html.addEventListener("mousemove",
f,false);this.html.addEventListener("mouseup",e,false);this.html.addEventListener("mousedown",d,false);this.html.addEventListener("keydown",c,false);this.html.addEventListener("dblclick",g,false)}else if(this.html.attachEvent){this.html.attachEvent("oncontextmenu",a);this.html.attachEvent("onmousemove",f);this.html.attachEvent("onmousedown",d);this.html.attachEvent("onmouseup",e);this.html.attachEvent("onkeydown",c);this.html.attachEvent("ondblclick",g)}else throw Error("Open-jACOB Draw2D not supported in this browser.");
}}};Workflow.prototype=new Canvas;Workflow.prototype.type="Workflow";Workflow.COLOR_GREEN=new Color(0,255,0);Workflow.prototype.onScroll=function(){for(var a=this.getScrollLeft(),b=this.getScrollTop(),c=a-this.oldScrollPosLeft,d=b-this.oldScrollPosTop,e=0;e<this.figures.getSize();e++){var f=this.figures.get(e);f.hasFixedPosition&&f.hasFixedPosition()==true&&f.setPosition(f.getX()+c,f.getY()+d)}this.oldScrollPosLeft=a;this.oldScrollPosTop=b};
Workflow.prototype.setPanning=function(a){this.panning=a;this.html.style.cursor=a?"move":"default"};Workflow.prototype.scrollTo=function(a,b,c){if(c){this.scrollArea.scrollLeft=a;this.scrollArea.scrollTop=b}else for(var a=(a-this.getScrollLeft())/40,b=(b-this.getScrollTop())/40,c=this.getScrollLeft(),d=this.getScrollTop(),e=0;e<40;e++){this.scrollArea.scrollLeft=c+a*e;this.scrollArea.scrollTop=d+b*e}};
Workflow.prototype.showTooltip=function(a,b){if(this.tooltip!=null){this.removeFigure(this.tooltip);this.tooltip=null;if(this.tooltipTimer>=0){window.clearTimeout(this.tooltipTimer);this.tooltipTimer=-1}}this.tooltip=a;if(this.tooltip!=null){this.currentTooltipX=this.currentMouseX;this.currentTooltipY=this.currentMouseY;this.addFigure(this.tooltip,this.currentTooltipX+10,this.currentTooltipY+10);var c=this;if(b==true)this.tooltipTimer=window.setTimeout(function(){c.tooltipTimer=-1;c.showTooltip(null)},
5E3)}};Workflow.prototype.showDialog=function(a,b,c){b?this.addFigure(a,b,c):this.addFigure(a,200,100);this.dialogs.add(a)};Workflow.prototype.showMenu=function(a,b,c){if(this.menu!=null){this.html.removeChild(this.menu.getHTMLElement());this.menu.setWorkflow()}this.menu=a;if(this.menu!=null){this.menu.setWorkflow(this);this.menu.setPosition(b,c);this.html.appendChild(this.menu.getHTMLElement());this.menu.paint()}};
Workflow.prototype.onContextMenu=function(a,b){var c=this.getContextMenu();c!=null&&this.showMenu(c,a,b)};Workflow.prototype.getContextMenu=function(){return null};Workflow.prototype.setToolWindow=function(a,b,c){this.toolPalette=a;c?this.addFigure(a,b,c):this.addFigure(a,20,20);this.dialogs.add(a)};Workflow.prototype.setSnapToGrid=function(a){this.snapToGridHelper=a?new SnapToGrid(this):null};Workflow.prototype.setSnapToGeometry=function(a){this.snapToGeometryHelper=a?new SnapToGeometry(this):null};
Workflow.prototype.setGridWidth=function(a,b){this.gridWidthX=a;this.gridWidthY=b};
Workflow.prototype.addFigure=function(a,b,c){Canvas.prototype.addFigure.call(this,a,b,c,true);a.setWorkflow(this);var d=this;a instanceof CompartmentFigure&&this.compartments.add(a);if(a instanceof Line)this.lines.add(a);else{this.figures.add(a);a.draggable.addEventListener("dragend",function(){});a.draggable.addEventListener("dragstart",function(a){a=d.getFigure(a.target.element.id);if(a!=null&&a.isSelectable()!=false){d.showResizeHandles(a);d.setCurrentSelection(a)}});a.draggable.addEventListener("drag",
function(a){a=d.getFigure(a.target.element.id);a!=null&&a.isSelectable()!=false&&d.moveResizeHandles(a)})}a.paint();this.setDocumentDirty()};Workflow.prototype.removeFigure=function(a){Canvas.prototype.removeFigure.call(this,a);this.figures.remove(a);this.lines.remove(a);this.dialogs.remove(a);a.setWorkflow(null);a instanceof CompartmentFigure&&this.compartments.remove(a);a instanceof Connection&&a.disconnect();this.currentSelection==a&&this.setCurrentSelection(null);this.setDocumentDirty()};
Workflow.prototype.moveFront=function(a){this.html.removeChild(a.getHTMLElement());this.html.appendChild(a.getHTMLElement())};Workflow.prototype.moveBack=function(a){this.html.removeChild(a.getHTMLElement());this.html.insertBefore(a.getHTMLElement(),this.html.firstChild)};
Workflow.prototype.getBestCompartmentFigure=function(a,b,c){for(var d=null,e=0;e<this.figures.getSize();e++){var f=this.figures.get(e);f instanceof CompartmentFigure&&(f.isOver(a,b)==true&&f!=c)&&(d==null?d=f:d.getZOrder()<f.getZOrder()&&(d=f))}return d};Workflow.prototype.getBestFigure=function(a,b,c){for(var d=null,e=0;e<this.figures.getSize();e++){var f=this.figures.get(e);f.isOver(a,b)==true&&f!=c&&(d==null?d=f:d.getZOrder()<f.getZOrder()&&(d=f))}return d};
Workflow.prototype.getBestLine=function(a,b,c){for(var d=null,e=0;e<this.lines.getSize();e++){var f=this.lines.get(e);f.containsPoint(a,b)==true&&f!=c&&(d==null?d=f:d.getZOrder()<f.getZOrder()&&(d=f))}return d};Workflow.prototype.getFigure=function(a){for(var b=0;b<this.figures.getSize();b++){var c=this.figures.get(b);if(c.id==a)return c}return null};Workflow.prototype.getFigures=function(){return this.figures};Workflow.prototype.getDocument=function(){return new Document(this)};
Workflow.prototype.addSelectionListener=function(a){this.selectionListeners.add(a)};Workflow.prototype.removeSelectionListener=function(a){this.selectionListeners.remove(a)};Workflow.prototype.setCurrentSelection=function(a){if(a==null){this.hideResizeHandles();this.hideLineResizeHandles()}this.currentSelection=a;for(a=0;a<this.selectionListeners.getSize();a++){var b=this.selectionListeners.get(a);if(b!=null&&b.onSelectionChanged)b.onSelectionChanged(this.currentSelection)}};
Workflow.prototype.getCurrentSelection=function(){return this.currentSelection};Workflow.prototype.getLines=function(){return this.lines};Workflow.prototype.registerPort=function(a){a.draggable.targets=this.dropTargets;this.commonPorts.add(a);this.dropTargets.add(a.dropable)};Workflow.prototype.unregisterPort=function(a){a.draggable.targets=null;this.commonPorts.remove(a);this.dropTargets.remove(a.dropable)};Workflow.prototype.getCommandStack=function(){return this.commandStack};
Workflow.prototype.showConnectionLine=function(a,b,c,d){this.connectionLine.setStartPoint(a,b);this.connectionLine.setEndPoint(c,d);this.connectionLine.canvas==null&&Canvas.prototype.addFigure.call(this,this.connectionLine)};Workflow.prototype.hideConnectionLine=function(){this.connectionLine.canvas!=null&&Canvas.prototype.removeFigure.call(this,this.connectionLine)};
Workflow.prototype.showLineResizeHandles=function(a){var b=this.resizeHandleStart.getWidth()/2;this.resizeHandleStart.getHeight();var c=a.getStartPoint(),d=a.getEndPoint();Canvas.prototype.addFigure.call(this,this.resizeHandleStart,c.x-b,c.y-b);Canvas.prototype.addFigure.call(this,this.resizeHandleEnd,d.x-b,d.y-b);this.resizeHandleStart.setCanDrag(a.isResizeable());this.resizeHandleEnd.setCanDrag(a.isResizeable());if(a.isResizeable()){this.resizeHandleStart.setBackgroundColor(Workflow.COLOR_GREEN);
this.resizeHandleEnd.setBackgroundColor(Workflow.COLOR_GREEN);this.resizeHandleStart.draggable.targets=this.dropTargets;this.resizeHandleEnd.draggable.targets=this.dropTargets}else{this.resizeHandleStart.setBackgroundColor(null);this.resizeHandleEnd.setBackgroundColor(null)}};
Workflow.prototype.hideLineResizeHandles=function(){this.resizeHandleStart.canvas!=null&&Canvas.prototype.removeFigure.call(this,this.resizeHandleStart);this.resizeHandleEnd.canvas!=null&&Canvas.prototype.removeFigure.call(this,this.resizeHandleEnd)};
Workflow.prototype.showResizeHandles=function(a){this.hideLineResizeHandles();this.hideResizeHandles();if(this.getEnableSmoothFigureHandling()==true&&this.getCurrentSelection()!=a){this.resizeHandle1.setAlpha(0.01);this.resizeHandle2.setAlpha(0.01);this.resizeHandle3.setAlpha(0.01);this.resizeHandle4.setAlpha(0.01);this.resizeHandle5.setAlpha(0.01);this.resizeHandle6.setAlpha(0.01);this.resizeHandle7.setAlpha(0.01);this.resizeHandle8.setAlpha(0.01)}var b=this.resizeHandle1.getWidth(),c=this.resizeHandle1.getHeight(),
d=a.getHeight(),e=a.getWidth(),f=a.getX(),g=a.getY();Canvas.prototype.addFigure.call(this,this.resizeHandle1,f-b,g-c);Canvas.prototype.addFigure.call(this,this.resizeHandle3,f+e,g-c);Canvas.prototype.addFigure.call(this,this.resizeHandle5,f+e,g+d);Canvas.prototype.addFigure.call(this,this.resizeHandle7,f-b,g+d);this.moveFront(this.resizeHandle1);this.moveFront(this.resizeHandle3);this.moveFront(this.resizeHandle5);this.moveFront(this.resizeHandle7);this.resizeHandle1.setCanDrag(a.isResizeable());
this.resizeHandle3.setCanDrag(a.isResizeable());this.resizeHandle5.setCanDrag(a.isResizeable());this.resizeHandle7.setCanDrag(a.isResizeable());if(a.isResizeable()){var h=new Color(0,255,0);this.resizeHandle1.setBackgroundColor(h);this.resizeHandle3.setBackgroundColor(h);this.resizeHandle5.setBackgroundColor(h);this.resizeHandle7.setBackgroundColor(h)}else{this.resizeHandle1.setBackgroundColor(null);this.resizeHandle3.setBackgroundColor(null);this.resizeHandle5.setBackgroundColor(null);this.resizeHandle7.setBackgroundColor(null)}if(a.isStrechable()&&
a.isResizeable()){this.resizeHandle2.setCanDrag(a.isResizeable());this.resizeHandle4.setCanDrag(a.isResizeable());this.resizeHandle6.setCanDrag(a.isResizeable());this.resizeHandle8.setCanDrag(a.isResizeable());Canvas.prototype.addFigure.call(this,this.resizeHandle2,f+e/2-this.resizeHandleHalfWidth+1,g-c-6);Canvas.prototype.addFigure.call(this,this.resizeHandle4,f+e+6,g+d/2-c/2);Canvas.prototype.addFigure.call(this,this.resizeHandle6,f+e/2-this.resizeHandleHalfWidth+1,g+d+6);Canvas.prototype.addFigure.call(this,
this.resizeHandle8,f-b-5,g+d/2-c/2);this.moveFront(this.resizeHandle2);this.moveFront(this.resizeHandle4);this.moveFront(this.resizeHandle6);this.moveFront(this.resizeHandle8)}};
Workflow.prototype.hideResizeHandles=function(){this.resizeHandle1.canvas!=null&&Canvas.prototype.removeFigure.call(this,this.resizeHandle1);this.resizeHandle2.canvas!=null&&Canvas.prototype.removeFigure.call(this,this.resizeHandle2);this.resizeHandle3.canvas!=null&&Canvas.prototype.removeFigure.call(this,this.resizeHandle3);this.resizeHandle4.canvas!=null&&Canvas.prototype.removeFigure.call(this,this.resizeHandle4);this.resizeHandle5.canvas!=null&&Canvas.prototype.removeFigure.call(this,this.resizeHandle5);
this.resizeHandle6.canvas!=null&&Canvas.prototype.removeFigure.call(this,this.resizeHandle6);this.resizeHandle7.canvas!=null&&Canvas.prototype.removeFigure.call(this,this.resizeHandle7);this.resizeHandle8.canvas!=null&&Canvas.prototype.removeFigure.call(this,this.resizeHandle8)};
Workflow.prototype.moveResizeHandles=function(a){var b=this.resizeHandle1.getWidth(),c=this.resizeHandle1.getHeight(),d=a.getHeight(),e=a.getWidth(),f=a.getX(),g=a.getY();this.resizeHandle1.setPosition(f-b,g-c);this.resizeHandle3.setPosition(f+e,g-c);this.resizeHandle5.setPosition(f+e,g+d);this.resizeHandle7.setPosition(f-b,g+d);if(a.isStrechable()){this.resizeHandle2.setPosition(f+e/2-this.resizeHandleHalfWidth,g-c);this.resizeHandle4.setPosition(f+e,g+d/2-c/2);this.resizeHandle6.setPosition(f+e/
2-this.resizeHandleHalfWidth,g+d);this.resizeHandle8.setPosition(f-b,g+d/2-c/2)}};
Workflow.prototype.onMouseDown=function(a,b){this.dragging=true;this.mouseDownPosX=a;this.mouseDownPosY=b;this.toolPalette!=null&&this.toolPalette.getActiveTool()!=null&&this.toolPalette.getActiveTool().execute(a,b);this.setCurrentSelection(null);this.showMenu(null);for(var c=this.getLines().getSize(),d=0;d<c;d++){var e=this.lines.get(d);if(e.containsPoint(a,b)&&e.isSelectable()){this.hideResizeHandles();this.setCurrentSelection(e);this.showLineResizeHandles(this.currentSelection);if(e instanceof
Line&&!(e instanceof Connection))this.draggingLine=e;break}}};Workflow.prototype.onMouseUp=function(){this.dragging=false;this.draggingLine=null};
Workflow.prototype.onMouseMove=function(a,b){if(this.dragging==true&&this.draggingLine!=null){var c=a-this.mouseDownPosX,d=b-this.mouseDownPosY;this.draggingLine.startX=this.draggingLine.getStartX()+c;this.draggingLine.startY=this.draggingLine.getStartY()+d;this.draggingLine.setEndPoint(this.draggingLine.getEndX()+c,this.draggingLine.getEndY()+d);this.mouseDownPosX=a;this.mouseDownPosY=b;this.showLineResizeHandles(this.currentSelection)}else if(this.dragging==true&&this.panning==true){c=a-this.mouseDownPosX;
d=b-this.mouseDownPosY;this.scrollTo(this.getScrollLeft()-c,this.getScrollTop()-d,true);this.onScroll()}};Workflow.prototype.onKeyDown=function(a,b){a==46&&this.currentSelection!=null&&this.currentSelection.isDeleteable()?this.commandStack.execute(new CommandDelete(this.currentSelection)):a==90&&b?this.commandStack.undo():a==89&&b&&this.commandStack.redo()};
Workflow.prototype.setDocumentDirty=function(){for(var a=0;a<this.dialogs.getSize();a++){var b=this.dialogs.get(a);if(b!=null&&b.onSetDocumentDirty)b.onSetDocumentDirty()}if(this.snapToGeometryHelper!=null)this.snapToGeometryHelper.onSetDocumentDirty();if(this.snapToGridHelper!=null)this.snapToGridHelper.onSetDocumentDirty()};
Workflow.prototype.snapToHelper=function(a,b){if(this.snapToGeometryHelper!=null){if(a instanceof ResizeHandle){var c=a.getSnapToGridAnchor();b.x=b.x+c.x;b.y=b.y+c.y;var d=new Point(b.x,b.y),e=a.getSnapToDirection(),f=this.snapToGeometryHelper.snapPoint(e,b,d);e&SnapToHelper.EAST_WEST&&!(f&SnapToHelper.EAST_WEST)?this.showSnapToHelperLineVertical(d.x):this.hideSnapToHelperLineVertical();e&SnapToHelper.NORTH_SOUTH&&!(f&SnapToHelper.NORTH_SOUTH)?this.showSnapToHelperLineHorizontal(d.y):this.hideSnapToHelperLineHorizontal();
d.x=d.x-c.x;d.y=d.y-c.y;return d}c=new Dimension(b.x,b.y,a.getWidth(),a.getHeight());d=new Dimension(b.x,b.y,a.getWidth(),a.getHeight());e=SnapToHelper.NSEW;f=this.snapToGeometryHelper.snapRectangle(c,d);e&SnapToHelper.WEST&&!(f&SnapToHelper.WEST)?this.showSnapToHelperLineVertical(d.x):e&SnapToHelper.EAST&&!(f&SnapToHelper.EAST)?this.showSnapToHelperLineVertical(d.getX()+d.getWidth()):this.hideSnapToHelperLineVertical();e&SnapToHelper.NORTH&&!(f&SnapToHelper.NORTH)?this.showSnapToHelperLineHorizontal(d.y):
e&SnapToHelper.SOUTH&&!(f&SnapToHelper.SOUTH)?this.showSnapToHelperLineHorizontal(d.getY()+d.getHeight()):this.hideSnapToHelperLineHorizontal();return d.getTopLeft()}if(this.snapToGridHelper!=null){c=a.getSnapToGridAnchor();b.x=b.x+c.x;b.y=b.y+c.y;d=new Point(b.x,b.y);this.snapToGridHelper.snapPoint(0,b,d);d.x=d.x-c.x;d.y=d.y-c.y;return d}return b};
Workflow.prototype.showSnapToHelperLineHorizontal=function(a){if(this.horizontalSnapToHelperLine==null){this.horizontalSnapToHelperLine=new Line;this.horizontalSnapToHelperLine.setColor(new Color(175,175,255));this.addFigure(this.horizontalSnapToHelperLine)}this.horizontalSnapToHelperLine.setStartPoint(0,a);this.horizontalSnapToHelperLine.setEndPoint(this.getWidth(),a)};
Workflow.prototype.showSnapToHelperLineVertical=function(a){if(this.verticalSnapToHelperLine==null){this.verticalSnapToHelperLine=new Line;this.verticalSnapToHelperLine.setColor(new Color(175,175,255));this.addFigure(this.verticalSnapToHelperLine)}this.verticalSnapToHelperLine.setStartPoint(a,0);this.verticalSnapToHelperLine.setEndPoint(a,this.getHeight())};Workflow.prototype.hideSnapToHelperLines=function(){this.hideSnapToHelperLineHorizontal();this.hideSnapToHelperLineVertical()};
Workflow.prototype.hideSnapToHelperLineHorizontal=function(){if(this.horizontalSnapToHelperLine!=null){this.removeFigure(this.horizontalSnapToHelperLine);this.horizontalSnapToHelperLine=null}};Workflow.prototype.hideSnapToHelperLineVertical=function(){if(this.verticalSnapToHelperLine!=null){this.removeFigure(this.verticalSnapToHelperLine);this.verticalSnapToHelperLine=null}};
Window=function(a){this.title=a;this.titlebar=null;Figure.call(this);this.setDeleteable(false);this.setCanSnapToHelper(false);this.setZOrder(Window.ZOrderIndex)};Window.prototype=new Figure;Window.prototype.type="Window";Window.ZOrderIndex=5E4;Window.setZOrderBaseIndex=function(a){Window.ZOrderBaseIndex=a};Window.prototype.hasFixedPosition=function(){return true};Window.prototype.hasTitleBar=function(){return true};
Window.prototype.createHTMLElement=function(){var a=Figure.prototype.createHTMLElement.call(this);a.style.margin="0px";a.style.padding="0px";a.style.border="1px solid black";a.style.backgroundImage="url(/skins/ext/images/gray/shapes/window_bg.png)";a.style.cursor=null;if(this.hasTitleBar()){this.titlebar=document.createElement("div");this.titlebar.style.position="absolute";this.titlebar.style.left="0px";this.titlebar.style.top="0px";this.titlebar.style.width=this.getWidth()+"px";this.titlebar.style.height=
"15px";this.titlebar.style.margin="0px";this.titlebar.style.padding="0px";this.titlebar.style.font="normal 10px verdana";this.titlebar.style.backgroundColor="blue";this.titlebar.style.borderBottom="2px solid gray";this.titlebar.style.whiteSpace="nowrap";this.titlebar.style.textAlign="center";this.titlebar.style.backgroundImage="url(/skins/ext/images/gray/shapes/window_toolbar.png)";this.textNode=document.createTextNode(this.title);this.titlebar.appendChild(this.textNode);a.appendChild(this.titlebar)}return a};
Window.prototype.setDocumentDirty=function(){};Window.prototype.onDragend=function(){};Window.prototype.onDragstart=function(a,b){return this.titlebar==null?false:this.canDrag==true&&a<parseInt(this.titlebar.style.width)&&b<parseInt(this.titlebar.style.height)?true:false};Window.prototype.isSelectable=function(){return false};Window.prototype.setCanDrag=function(a){Figure.prototype.setCanDrag.call(this,a);this.html.style.cursor="";if(this.titlebar!=null)this.titlebar.style.cursor=a?"move":""};
Window.prototype.setWorkflow=function(a){var b=this.workflow;Figure.prototype.setWorkflow.call(this,a);b!=null&&b.removeSelectionListener(this);this.workflow!=null&&this.workflow.addSelectionListener(this)};Window.prototype.setDimension=function(a,b){Figure.prototype.setDimension.call(this,a,b);if(this.titlebar!=null)this.titlebar.style.width=this.getWidth()+"px"};Window.prototype.setTitle=function(a){this.title=a};Window.prototype.getMinWidth=function(){return 50};Window.prototype.getMinHeight=function(){return 50};
Window.prototype.isResizeable=function(){return false};Window.prototype.setAlpha=function(){};Window.prototype.setBackgroundColor=function(a){this.bgColor=a;if(this.bgColor!=null)this.html.style.backgroundColor=this.bgColor.getHTMLStyle();else{this.html.style.backgroundColor="transparent";this.html.style.backgroundImage=""}};Window.prototype.setColor=function(a){this.lineColor=a;this.html.style.border=this.lineColor!=null?this.lineStroke+"px solid "+this.lineColor.getHTMLStyle():"0px"};
Window.prototype.setLineWidth=function(a){this.lineStroke=a;this.html.style.border=this.lineStroke+"px solid black"};Window.prototype.onSelectionChanged=function(){};Button=function(a,b,c){this.y=this.x=0;this.id=this.generateUId();this.enabled=true;this.active=false;this.palette=a;b&&c?this.setDimension(b,c):this.setDimension(24,24);this.html=this.createHTMLElement()};Button.prototype.type="Button";Button.prototype.dispose=function(){};
Button.prototype.getImageUrl=function(){return this.enabled?this.type+".png":this.type+"_disabled.png"};
Button.prototype.createHTMLElement=function(){var a=document.createElement("div");a.id=this.id;a.style.position="absolute";a.style.left=this.x+"px";a.style.top=this.y+"px";a.style.height=this.width+"px";a.style.width=this.height+"px";a.style.margin="0px";a.style.padding="0px";a.style.outline="none";a.style.backgroundImage=this.getImageUrl()!=null?"url("+this.getImageUrl()+")":"";var b=this;this.omousedown=function(a){b.enabled&&b.setActive(true);a.cancelBubble=true;a.returnValue=false};this.omouseup=
function(a){if(b.enabled){b.setActive(false);b.execute()}a.cancelBubble=true;a.returnValue=false};if(a.addEventListener){a.addEventListener("mousedown",this.omousedown,false);a.addEventListener("mouseup",this.omouseup,false)}else if(a.attachEvent){a.attachEvent("onmousedown",this.omousedown);a.attachEvent("onmouseup",this.omouseup)}return a};Button.prototype.getHTMLElement=function(){if(this.html==null)this.html=this.createHTMLElement();return this.html};Button.prototype.execute=function(){};
Button.prototype.setTooltip=function(a){this.tooltip=a;this.html.title=this.tooltip!=null?this.tooltip:""};Button.prototype.setActive=function(a){if(this.enabled){this.active=a;this.html.style.border=a==true?"2px inset":"0px"}};Button.prototype.isActive=function(){return this.active};Button.prototype.setEnabled=function(a){this.enabled=a;this.html.style.backgroundImage=this.getImageUrl()!=null?"url("+this.getImageUrl()+")":""};
Button.prototype.setDimension=function(a,b){this.width=a;this.height=b;if(this.html!=null){this.html.style.width=this.width+"px";this.html.style.height=this.height+"px"}};Button.prototype.setPosition=function(a,b){this.x=Math.max(0,a);this.y=Math.max(0,b);if(this.html!=null){this.html.style.left=this.x+"px";this.html.style.top=this.y+"px"}};Button.prototype.getWidth=function(){return this.width};Button.prototype.getHeight=function(){return this.height};Button.prototype.getY=function(){return this.y};
Button.prototype.getX=function(){return this.x};Button.prototype.getPosition=function(){return new Point(this.x,this.y)};Button.prototype.getToolPalette=function(){return this.palette};Button.prototype.generateUId=function(){for(nbTry=0;nbTry<1E3;){for(var a="",b=0;b<10;b++)var c=Math.floor(Math.random()*61),a=a+"0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".substring(c,c+1);elem=document.getElementById(a);if(!elem)return a;nbTry=nbTry+1}return null};
ToggleButton=function(a){Button.call(this,a);this.isDownFlag=false};ToggleButton.prototype=new Button;ToggleButton.prototype.type="ToggleButton";
ToggleButton.prototype.createHTMLElement=function(){var a=document.createElement("div");a.id=this.id;a.style.position="absolute";a.style.left=this.x+"px";a.style.top=this.y+"px";a.style.height="24px";a.style.width="24px";a.style.margin="0px";a.style.padding="0px";a.style.backgroundImage=this.getImageUrl()!=null?"url("+this.getImageUrl()+")":"";var b=this;this.omousedown=function(a){b.enabled&&(b.isDown()||Button.prototype.setActive.call(b,true));a.cancelBubble=true;a.returnValue=false};this.omouseup=
function(a){if(b.enabled){b.isDown()&&Button.prototype.setActive.call(b,false);b.isDownFlag=!b.isDownFlag;b.execute()}a.cancelBubble=true;a.returnValue=false};if(a.addEventListener){a.addEventListener("mousedown",this.omousedown,false);a.addEventListener("mouseup",this.omouseup,false)}else if(a.attachEvent){a.attachEvent("onmousedown",this.omousedown);a.attachEvent("onmouseup",this.omouseup)}return a};ToggleButton.prototype.isDown=function(){return this.isDownFlag};
ToggleButton.prototype.setActive=function(a){Button.prototype.setActive.call(this,a);this.isDownFlag=a};ToggleButton.prototype.execute=function(){};ToolGeneric=function(a){this.y=this.x=0;this.enabled=true;this.tooltip=null;this.palette=a;this.setDimension(10,10);this.html=this.createHTMLElement()};ToolGeneric.prototype.type="ToolGeneric";ToolGeneric.prototype.dispose=function(){};ToolGeneric.prototype.getImageUrl=function(){return this.enabled?this.type+".png":this.type+"_disabled.png"};
ToolGeneric.prototype.createHTMLElement=function(){var a=document.createElement("div");a.id=this.id;a.style.position="absolute";a.style.left=this.x+"px";a.style.top=this.y+"px";a.style.height="24px";a.style.width="24px";a.style.margin="0px";a.style.padding="0px";a.style.backgroundImage=this.getImageUrl()!=null?"url("+this.getImageUrl()+")":"";var b=this;this.click=function(a){b.enabled&&b.palette.setActiveTool(b);a.cancelBubble=true;a.returnValue=false};a.addEventListener?a.addEventListener("click",
this.click,false):a.attachEvent&&a.attachEvent("onclick",this.click);return a};ToolGeneric.prototype.getHTMLElement=function(){if(this.html==null)this.html=this.createHTMLElement();return this.html};ToolGeneric.prototype.execute=function(){this.enabled&&this.palette.setActiveTool(null)};ToolGeneric.prototype.setTooltip=function(a){this.tooltip=a;this.html.title=this.tooltip!=null?this.tooltip:""};
ToolGeneric.prototype.setActive=function(a){if(this.enabled)this.html.style.border=a==true?"2px inset":"0px"};ToolGeneric.prototype.setEnabled=function(a){this.enabled=a;this.html.style.backgroundImage=this.getImageUrl()!=null?"url("+this.getImageUrl()+")":""};ToolGeneric.prototype.setDimension=function(a,b){this.width=a;this.height=b;if(this.html!=null){this.html.style.width=this.width+"px";this.html.style.height=this.height+"px"}};
ToolGeneric.prototype.setPosition=function(a,b){this.x=Math.max(0,a);this.y=Math.max(0,b);if(this.html!=null){this.html.style.left=this.x+"px";this.html.style.top=this.y+"px"}};ToolGeneric.prototype.getWidth=function(){return this.width};ToolGeneric.prototype.getHeight=function(){return this.height};ToolGeneric.prototype.getY=function(){return this.y};ToolGeneric.prototype.getX=function(){return this.x};ToolGeneric.prototype.getPosition=function(){return new Point(this.x,this.y)};
ToolPalette=function(a){Window.call(this,a);this.setDimension(75,400);this.activeTool=null;this.children={}};ToolPalette.prototype=new Window;ToolPalette.prototype.type="ToolPalette";ToolPalette.prototype.dispose=function(){Window.prototype.dispose.call(this)};
ToolPalette.prototype.createHTMLElement=function(){var a=Window.prototype.createHTMLElement.call(this);this.scrollarea=document.createElement("div");this.scrollarea.style.position="absolute";this.scrollarea.style.left="0px";this.scrollarea.style.top=this.hasTitleBar()?"15px":"0px";this.scrollarea.style.width=this.getWidth()+"px";this.scrollarea.style.height="15px";this.scrollarea.style.margin="0px";this.scrollarea.style.padding="0px";this.scrollarea.style.font="normal 10px verdana";this.scrollarea.style.borderBottom=
"2px solid gray";this.scrollarea.style.whiteSpace="nowrap";this.scrollarea.style.textAlign="center";this.scrollarea.style.overflowX="auto";this.scrollarea.style.overflowY="auto";this.scrollarea.style.overflow="auto";a.appendChild(this.scrollarea);return a};
ToolPalette.prototype.setDimension=function(a,b){Window.prototype.setDimension.call(this,a,b);if(this.scrollarea!=null){this.scrollarea.style.width=this.getWidth()+"px";this.scrollarea.style.height=this.hasTitleBar()?this.getHeight()-15+"px":this.getHeight()+"px"}};ToolPalette.prototype.addChild=function(a){this.children[a.id]=a;this.scrollarea.appendChild(a.getHTMLElement())};ToolPalette.prototype.getChild=function(a){return this.children[a]};ToolPalette.prototype.getActiveTool=function(){return this.activeTool};
ToolPalette.prototype.setActiveTool=function(a){this.activeTool!=a&&this.activeTool!=null&&this.activeTool.setActive(false);a!=null&&a.setActive(true);this.activeTool=a};Dialog=function(a){this.buttonbar=null;a?Window.call(this,a):Window.call(this,"Dialog");this.setDimension(400,300)};Dialog.prototype=new Window;Dialog.prototype.type="Dialog";
Dialog.prototype.createHTMLElement=function(){var a=Window.prototype.createHTMLElement.call(this),b=this;this.buttonbar=document.createElement("div");this.buttonbar.style.position="absolute";this.buttonbar.style.left="0px";this.buttonbar.style.bottom="0px";this.buttonbar.style.width=this.getWidth()+"px";this.buttonbar.style.height="30px";this.buttonbar.style.margin="0px";this.buttonbar.style.padding="0px";this.buttonbar.style.font="normal 10px verdana";this.buttonbar.style.backgroundColor="#C0C0C0";
this.buttonbar.style.borderBottom="2px solid gray";this.buttonbar.style.whiteSpace="nowrap";this.buttonbar.style.textAlign="center";this.okbutton=document.createElement("button");this.okbutton.style.border="1px solid gray";this.okbutton.style.font="normal 10px verdana";this.okbutton.style.width="80px";this.okbutton.style.margin="5px";this.okbutton.innerHTML="Ok";this.okbutton.onclick=function(){b.onOk()};this.buttonbar.appendChild(this.okbutton);this.cancelbutton=document.createElement("button");
this.cancelbutton.innerHTML="Cancel";this.cancelbutton.style.font="normal 10px verdana";this.cancelbutton.style.border="1px solid gray";this.cancelbutton.style.width="80px";this.cancelbutton.style.margin="5px";this.cancelbutton.onclick=function(){b.onCancel()};this.buttonbar.appendChild(this.cancelbutton);a.appendChild(this.buttonbar);return a};Dialog.prototype.onOk=function(){this.workflow.removeFigure(this)};Dialog.prototype.onCancel=function(){this.workflow.removeFigure(this)};
Dialog.prototype.setDimension=function(a,b){Window.prototype.setDimension.call(this,a,b);if(this.buttonbar!=null)this.buttonbar.style.width=this.getWidth()+"px"};Dialog.prototype.setWorkflow=function(a){Window.prototype.setWorkflow.call(this,a);this.setFocus()};Dialog.prototype.setFocus=function(){};Dialog.prototype.onSetDocumentDirty=function(){};InputDialog=function(){Dialog.call(this);this.setDimension(400,100)};InputDialog.prototype=new Dialog;InputDialog.prototype.type="InputDialog";
InputDialog.prototype.createHTMLElement=function(){return Dialog.prototype.createHTMLElement.call(this)};InputDialog.prototype.onOk=function(){this.workflow.removeFigure(this)};InputDialog.prototype.onCancel=function(){this.workflow.removeFigure(this)};PropertyDialog=function(a,b,c){this.figure=a;this.propertyName=b;this.label=c;Dialog.call(this);this.setDimension(400,120)};PropertyDialog.prototype=new Dialog;PropertyDialog.prototype.type="PropertyDialog";
PropertyDialog.prototype.createHTMLElement=function(){var a=Dialog.prototype.createHTMLElement.call(this),b=document.createElement("form");b.style.position="absolute";b.style.left="10px";b.style.top="30px";b.style.width="375px";b.style.font="normal 10px verdana";a.appendChild(b);this.labelDiv=document.createElement("div");this.labelDiv.innerHTML=this.label;this.disableTextSelection(this.labelDiv);b.appendChild(this.labelDiv);this.input=document.createElement("input");this.input.style.border="1px solid gray";
this.input.style.font="normal 10px verdana";this.input.type="text";var c=this.figure.getProperty(this.propertyName);this.input.value=c?c:"";this.input.style.width="100%";b.appendChild(this.input);this.input.focus();return a};PropertyDialog.prototype.onOk=function(){Dialog.prototype.onOk.call(this);this.figure.setProperty(this.propertyName,this.input.value)};AnnotationDialog=function(a){this.figure=a;Dialog.call(this);this.setDimension(400,100)};AnnotationDialog.prototype=new Dialog;
AnnotationDialog.prototype.type="AnnotationDialog";
AnnotationDialog.prototype.createHTMLElement=function(){var a=Dialog.prototype.createHTMLElement.call(this),b=document.createElement("form");b.style.position="absolute";b.style.left="10px";b.style.top="30px";b.style.width="375px";b.style.font="normal 10px verdana";a.appendChild(b);this.label=document.createTextNode("Text");b.appendChild(this.label);this.input=document.createElement("input");this.input.style.border="1px solid gray";this.input.style.font="normal 10px verdana";this.input.type="text";
var c=this.figure.getText();this.input.value=c?c:"";this.input.style.width="100%";b.appendChild(this.input);this.input.focus();return a};AnnotationDialog.prototype.onOk=function(){this.workflow.getCommandStack().execute(new CommandSetText(this.figure,this.input.value));this.workflow.removeFigure(this)};PropertyWindow=function(){this.currentSelection=null;Window.call(this,"Property Window");this.setDimension(200,100)};PropertyWindow.prototype=new Window;PropertyWindow.prototype.type="PropertyWindow";
PropertyWindow.prototype.dispose=function(){Window.prototype.dispose.call(this)};
PropertyWindow.prototype.createHTMLElement=function(){var a=Window.prototype.createHTMLElement.call(this);a.appendChild(this.createLabel("Type:",15,25));a.appendChild(this.createLabel("X :",15,50));a.appendChild(this.createLabel("Y :",15,70));a.appendChild(this.createLabel("Width :",85,50));a.appendChild(this.createLabel("Height :",85,70));this.labelType=this.createLabel("",50,25);this.labelX=this.createLabel("",40,50);this.labelY=this.createLabel("",40,70);this.labelWidth=this.createLabel("",135,
50);this.labelHeight=this.createLabel("",135,70);this.labelType.style.fontWeight="normal";this.labelX.style.fontWeight="normal";this.labelY.style.fontWeight="normal";this.labelWidth.style.fontWeight="normal";this.labelHeight.style.fontWeight="normal";a.appendChild(this.labelType);a.appendChild(this.labelX);a.appendChild(this.labelY);a.appendChild(this.labelWidth);a.appendChild(this.labelHeight);return a};
PropertyWindow.prototype.onSelectionChanged=function(a){Window.prototype.onSelectionChanged.call(this,a);this.currentSelection!=null&&this.currentSelection.detachMoveListener(this);this.currentSelection=a;if(a!=null&&a!=this){this.labelType.innerHTML=a.type;if(a.getX){this.labelX.innerHTML=a.getX();this.labelY.innerHTML=a.getY();this.labelWidth.innerHTML=a.getWidth();this.labelHeight.innerHTML=a.getHeight();this.currentSelection=a;this.currentSelection.attachMoveListener(this)}else{this.labelX.innerHTML=
"";this.labelY.innerHTML="";this.labelWidth.innerHTML="";this.labelHeight.innerHTML=""}}else{this.labelType.innerHTML="&lt;none&gt;";this.labelX.innerHTML="";this.labelY.innerHTML="";this.labelWidth.innerHTML="";this.labelHeight.innerHTML=""}};PropertyWindow.prototype.getCurrentSelection=function(){return this.currentSelection};PropertyWindow.prototype.onOtherFigureMoved=function(a){if(a==this.currentSelection)this.onSelectionChanged(a)};
PropertyWindow.prototype.createLabel=function(a,b,c){var d=document.createElement("div");d.style.position="absolute";d.style.left=b+"px";d.style.top=c+"px";d.style.font="normal 10px verdana";d.style.whiteSpace="nowrap";d.style.fontWeight="bold";d.innerHTML=a;return d};
ColorDialog=function(){this.maxValue={h:"359",s:"100",v:"100"};this.HSV={"0":359,1:100,2:100};this.slideHSV={"0":359,1:100,2:100};this.SVHeight=165;this.wH=this.wSV=162;Dialog.call(this,"Color Chooser");this.loadSV();this.setColor(new Color(255,0,0));this.setDimension(219,244)};ColorDialog.prototype=new Dialog;ColorDialog.prototype.type="ColorDialog";
ColorDialog.prototype.createHTMLElement=function(){var a=this,b=Dialog.prototype.createHTMLElement.call(this);this.outerDiv=document.createElement("div");this.outerDiv.id="plugin";this.outerDiv.style.top="15px";this.outerDiv.style.left="0px";this.outerDiv.style.width="201px";this.outerDiv.style.position="absolute";this.outerDiv.style.padding="9px";this.outerDiv.display="block";this.outerDiv.style.background="#0d0d0d";this.plugHEX=document.createElement("div");this.plugHEX.id="plugHEX";this.plugHEX.innerHTML=
"F1FFCC";this.plugHEX.style.color="white";this.plugHEX.style.font="normal 10px verdana";this.outerDiv.appendChild(this.plugHEX);this.SV=document.createElement("div");this.SV.onmousedown=function(b){a.mouseDownSV(a.SVslide,b)};this.SV.id="SV";this.SV.style.cursor="crosshair";this.SV.style.background="#FF0000 url(SatVal.png)";this.SV.style.position="absolute";this.SV.style.height="166px";this.SV.style.width="167px";this.SV.style.marginRight="10px";this.SV.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='SatVal.png', sizingMethod='scale')";
this.SV.style["float"]="left";this.outerDiv.appendChild(this.SV);this.SVslide=document.createElement("div");this.SVslide.onmousedown=function(b){a.mouseDownSV(b)};this.SVslide.style.top="40px";this.SVslide.style.left="40px";this.SVslide.style.position="absolute";this.SVslide.style.cursor="crosshair";this.SVslide.style.background="url(slide.gif)";this.SVslide.style.height="9px";this.SVslide.style.width="9px";this.SVslide.style.lineHeight="1px";this.outerDiv.appendChild(this.SVslide);this.H=document.createElement("form");
this.H.id="H";this.H.onmousedown=function(b){a.mouseDownH(b)};this.H.style.border="1px solid #000000";this.H.style.cursor="crosshair";this.H.style.position="absolute";this.H.style.width="19px";this.H.style.top="28px";this.H.style.left="191px";this.outerDiv.appendChild(this.H);this.Hslide=document.createElement("div");this.Hslide.style.top="-7px";this.Hslide.style.left="-8px";this.Hslide.style.background="url(slideHue.gif)";this.Hslide.style.height="5px";this.Hslide.style.width="33px";this.Hslide.style.position=
"absolute";this.Hslide.style.lineHeight="1px";this.H.appendChild(this.Hslide);this.Hmodel=document.createElement("div");this.Hmodel.style.height="1px";this.Hmodel.style.width="19px";this.Hmodel.style.lineHeight="1px";this.Hmodel.style.margin="0px";this.Hmodel.style.padding="0px";this.Hmodel.style.fontSize="1px";this.H.appendChild(this.Hmodel);b.appendChild(this.outerDiv);return b};ColorDialog.prototype.onOk=function(){Dialog.prototype.onOk.call(this)};
browser=function(a){return Math.max(navigator.userAgent.toLowerCase().indexOf(a),0)};ColorDialog.prototype.showColor=function(a){this.plugHEX.style.background="#"+a;this.plugHEX.innerHTML=a};ColorDialog.prototype.getSelectedColor=function(){var a=this.hex2rgb(this.plugHEX.innerHTML);return new Color(a[0],a[1],a[2])};ColorDialog.prototype.setColor=function(a){a==null&&(a=new Color(100,100,100));a=this.rgb2hex([a.getRed(),a.getGreen(),a.getBlue()]);this.updateH(a)};
ColorDialog.prototype.XY=function(a,b){return(browser("msie")?[event.clientX+document.body.scrollLeft,event.clientY+document.body.scrollTop]:[a.pageX,a.pageY])[b]};ColorDialog.prototype.mkHSV=function(a,b,c){return Math.min(a,Math.max(0,Math.ceil(parseInt(c)/b*a)))};ColorDialog.prototype.ckHSV=function(a,b){if(a>=0&&a<=b)return a;if(a>b)return b;if(a<0)return"-"+oo};
ColorDialog.prototype.mouseDownH=function(a){this.slideHSV[0]=this.HSV[0];var b=this;this.H.onmousemove=function(a){b.dragH(a)};this.H.onmouseup=function(){b.H.onmousemove="";b.H.onmouseup=""};this.dragH(a)};
ColorDialog.prototype.dragH=function(a){a=this.XY(a,1)-this.getY()-40;this.Hslide.style.top=this.ckHSV(a,this.wH)-5+"px";this.slideHSV[0]=this.mkHSV(359,this.wH,this.Hslide.style.top);this.updateSV();this.showColor(this.commit());this.SV.style.backgroundColor="#"+this.hsv2hex([this.HSV[0],100,100])};
ColorDialog.prototype.mouseDownSV=function(a,b){function c(){d.SV.onmousemove="";d.SV.onmouseup="";d.SVslide.onmousemove="";d.SVslide.onmouseup=""}this.slideHSV[0]=this.HSV[0];var d=this;this.SV.onmousemove=function(a){d.dragSV(a)};this.SV.onmouseup=c;this.SVslide.onmousemove=function(a){d.dragSV(a)};this.SVslide.onmouseup=c;this.dragSV(b)};
ColorDialog.prototype.dragSV=function(a){var b=this.XY(a,0)-this.getX()-1,a=this.XY(a,1)-this.getY()-20;this.SVslide.style.left=this.ckHSV(b,this.wSV)+"px";this.SVslide.style.top=this.ckHSV(a,this.wSV)+"px";this.slideHSV[1]=this.mkHSV(100,this.wSV,this.SVslide.style.left);this.slideHSV[2]=100-this.mkHSV(100,this.wSV,this.SVslide.style.top);this.updateSV()};
ColorDialog.prototype.commit=function(){for(var a={},b="",c=0;c<=2;c++){b="hsv".substr(c,1);a[c]=b=="h"?this.maxValue[b]-this.mkHSV(this.maxValue[b],this.wH,this.Hslide.style.top):this.HSV[c]}return this.updateSV(this.hsv2hex(a))};ColorDialog.prototype.updateSV=function(a){this.HSV=a?this.hex2hsv(a):[this.slideHSV[0],this.slideHSV[1],this.slideHSV[2]];a||(a=this.hsv2hex([this.slideHSV[0],this.slideHSV[1],this.slideHSV[2]]));this.showColor(a);return a};
ColorDialog.prototype.loadSV=function(){for(var a="",b=this.SVHeight;b>=0;b--)a=a+('<div style="background:#'+this.hsv2hex([Math.round(359/this.SVHeight*b),100,100])+';"><br/></div>');this.Hmodel.innerHTML=a};
ColorDialog.prototype.updateH=function(a){this.plugHEX.innerHTML=a;this.HSV=this.hex2hsv(a);this.SV.style.backgroundColor="#"+this.hsv2hex([this.HSV[0],100,100]);this.SVslide.style.top=parseInt(this.wSV-this.wSV*(this.HSV[1]/100))+20+"px";this.SVslide.style.left=parseInt(this.wSV*(this.HSV[1]/100))+5+"px";this.Hslide.style.top=parseInt(this.wH*((this.maxValue.h-this.HSV[0])/this.maxValue.h))-7+"px"};
ColorDialog.prototype.toHex=function(a){a=Math.round(Math.min(Math.max(0,a),255));return"0123456789ABCDEF".charAt((a-a%16)/16)+"0123456789ABCDEF".charAt(a%16)};ColorDialog.prototype.hex2rgb=function(a){return{"0":parseInt(a.substr(0,2),16),1:parseInt(a.substr(2,2),16),2:parseInt(a.substr(4,2),16)}};ColorDialog.prototype.rgb2hex=function(a){return this.toHex(a[0])+this.toHex(a[1])+this.toHex(a[2])};ColorDialog.prototype.hsv2hex=function(a){return this.rgb2hex(this.hsv2rgb(a))};
ColorDialog.prototype.hex2hsv=function(a){return this.rgb2hsv(this.hex2rgb(a))};ColorDialog.prototype.rgb2hsv=function(a){var b=Math.max(a[0],a[1],a[2]),c=b-Math.min(a[0],a[1],a[2]),d,e;if(b!=0){e=Math.round(c/b*100);a[0]==b?d=(a[1]-a[2])/c:a[1]==b?d=2+(a[2]-a[0])/c:a[2]==b&&(d=4+(a[0]-a[1])/c);d=Math.min(Math.round(d*60),360);d<0&&(d=d+360)}return{"0":d?d:0,1:e?e:0,2:Math.round(b/255*100)}};
ColorDialog.prototype.hsv2rgb=function(a){var b,c,d=a[1]/100,e=a[2]/100,f=a[0]/360;if(d>0){f>=1&&(f=0);f=6*f;F=f-Math.floor(f);A=Math.round(255*e*(1-d));a=Math.round(255*e*(1-d*F));C=Math.round(255*e*(1-d*(1-F)));e=Math.round(255*e);switch(Math.floor(f)){case 0:b=e;c=C;a=A;break;case 1:b=a;c=e;a=A;break;case 2:b=A;c=e;a=C;break;case 3:b=A;c=a;a=e;break;case 4:b=C;c=A;a=e;break;case 5:b=e;c=A}return{"0":b?b:0,1:c?c:0,2:a?a:0}}return{"0":e=Math.round(e*255),1:e,2:e}};
LineColorDialog=function(a){ColorDialog.call(this);this.figure=a;a=a.getColor();this.updateH(this.rgb2hex(a.getRed(),a.getGreen(),a.getBlue()))};LineColorDialog.prototype=new ColorDialog;LineColorDialog.prototype.type="LineColorDialog";
LineColorDialog.prototype.onOk=function(){var a=this.workflow;ColorDialog.prototype.onOk.call(this);if(typeof this.figure.setColor=="function"){a.getCommandStack().execute(new CommandSetColor(this.figure,this.getSelectedColor()));a.getCurrentSelection()==this.figure&&a.setCurrentSelection(this.figure)}};BackgroundColorDialog=function(a){ColorDialog.call(this);this.figure=a;a=a.getBackgroundColor();a!=null&&this.updateH(this.rgb2hex(a.getRed(),a.getGreen(),a.getBlue()))};
BackgroundColorDialog.prototype=new ColorDialog;BackgroundColorDialog.prototype.type="BackgroundColorDialog";BackgroundColorDialog.prototype.onOk=function(){var a=this.workflow;ColorDialog.prototype.onOk.call(this);if(typeof this.figure.setBackgroundColor=="function"){a.getCommandStack().execute(new CommandSetBackgroundColor(this.figure,this.getSelectedColor()));a.getCurrentSelection()==this.figure&&a.setCurrentSelection(this.figure)}};
AnnotationDialog=function(a){this.figure=a;Dialog.call(this);this.setDimension(400,100)};AnnotationDialog.prototype=new Dialog;AnnotationDialog.prototype.type="AnnotationDialog";
AnnotationDialog.prototype.createHTMLElement=function(){var a=Dialog.prototype.createHTMLElement.call(this),b=document.createElement("form");b.style.position="absolute";b.style.left="10px";b.style.top="30px";b.style.width="375px";b.style.font="normal 10px verdana";a.appendChild(b);this.label=document.createTextNode("Text");b.appendChild(this.label);this.input=document.createElement("input");this.input.style.border="1px solid gray";this.input.style.font="normal 10px verdana";this.input.type="text";
var c=this.figure.getText();this.input.value=c?c:"";this.input.style.width="100%";b.appendChild(this.input);this.input.focus();return a};AnnotationDialog.prototype.onOk=function(){this.workflow.getCommandStack().execute(new CommandSetText(this.figure,this.input.value));this.workflow.removeFigure(this)};Command=function(a){this.label=a};Command.prototype.type="Command";Command.prototype.getLabel=function(){};Command.prototype.canExecute=function(){return true};Command.prototype.execute=function(){};
Command.prototype.undo=function(){};Command.prototype.redo=function(){};CommandStack=function(){this.undostack=[];this.redostack=[];this.maxundo=50;this.eventListeners=new ArrayList};CommandStack.PRE_EXECUTE=1;CommandStack.PRE_REDO=2;CommandStack.PRE_UNDO=4;CommandStack.POST_EXECUTE=8;CommandStack.POST_REDO=16;CommandStack.POST_UNDO=32;CommandStack.POST_MASK=CommandStack.POST_EXECUTE|CommandStack.POST_UNDO|CommandStack.POST_REDO;
CommandStack.PRE_MASK=CommandStack.PRE_EXECUTE|CommandStack.PRE_UNDO|CommandStack.PRE_REDO;CommandStack.prototype.type="CommandStack";CommandStack.prototype.setUndoLimit=function(a){this.maxundo=a};CommandStack.prototype.markSaveLocation=function(){this.undostack=[];this.redostack=[]};
CommandStack.prototype.execute=function(a){if(a.canExecute()!=false){this.notifyListeners(a,CommandStack.PRE_EXECUTE);this.undostack.push(a);a.execute();this.redostack=[];if(this.undostack.length>this.maxundo)this.undostack=this.undostack.slice(this.undostack.length-this.maxundo);this.notifyListeners(a,CommandStack.POST_EXECUTE)}};
CommandStack.prototype.undo=function(){var a=this.undostack.pop();if(a){this.notifyListeners(a,CommandStack.PRE_UNDO);this.redostack.push(a);a.undo();this.notifyListeners(a,CommandStack.POST_UNDO)}};CommandStack.prototype.redo=function(){var a=this.redostack.pop();if(a){this.notifyListeners(a,CommandStack.PRE_REDO);this.undostack.push(a);a.redo();this.notifyListeners(a,CommandStack.POST_REDO)}};CommandStack.prototype.canRedo=function(){return this.redostack.length>0};
CommandStack.prototype.canUndo=function(){return this.undostack.length>0};CommandStack.prototype.addCommandStackEventListener=function(a){this.eventListeners.add(a)};CommandStack.prototype.removeCommandStackEventListener=function(a){this.eventListeners.remove(a)};CommandStack.prototype.notifyListeners=function(a,b){for(var c=new CommandStackEvent(a,b),d=this.eventListeners.getSize(),e=0;e<d;e++)this.eventListeners.get(e).stackChanged(c)};
CommandStackEvent=function(a,b){this.command=a;this.details=b};CommandStackEvent.prototype.type="CommandStackEvent";CommandStackEvent.prototype.getCommand=function(){return this.command};CommandStackEvent.prototype.getDetails=function(){return this.details};CommandStackEvent.prototype.isPostChangeEvent=function(){return 0!=(this.getDetails()&CommandStack.POST_MASK)};CommandStackEvent.prototype.isPreChangeEvent=function(){return 0!=(this.getDetails()&CommandStack.PRE_MASK)};
CommandStackEventListener=function(){};CommandStackEventListener.prototype.type="CommandStackEventListener";CommandStackEventListener.prototype.stackChanged=function(){};CommandAdd=function(a,b,c,d,e){Command.call(this,"add figure");this.parent=e;this.figure=b;this.x=c;this.y=d;this.workflow=a};CommandAdd.prototype=new Command;CommandAdd.prototype.type="CommandAdd";CommandAdd.prototype.execute=function(){this.redo()};
CommandAdd.prototype.redo=function(){this.x&&this.y?this.workflow.addFigure(this.figure,this.x,this.y):this.workflow.addFigure(this.figure);this.workflow.setCurrentSelection(this.figure);this.parent!=null&&this.parent.addChild(this.figure)};CommandAdd.prototype.undo=function(){this.workflow.removeFigure(this.figure);this.workflow.setCurrentSelection(null);this.parent!=null&&this.parent.removeChild(this.figure)};
CommandDelete=function(a){Command.call(this,"delete figure");this.parent=a.parent;this.figure=a;this.workflow=a.workflow;this.connections=null};CommandDelete.prototype=new Command;CommandDelete.prototype.type="CommandDelete";CommandDelete.prototype.execute=function(){this.redo()};
CommandDelete.prototype.undo=function(){this.workflow.addFigure(this.figure);this.figure instanceof Connection&&this.figure.reconnect();this.workflow.setCurrentSelection(this.figure);this.parent!=null&&this.parent.addChild(this.figure);for(var a=0;a<this.connections.getSize();++a){this.workflow.addFigure(this.connections.get(a));this.connections.get(a).reconnect()}};
CommandDelete.prototype.redo=function(){this.workflow.removeFigure(this.figure);this.workflow.setCurrentSelection(null);if(this.figure.getPorts&&this.connections==null){this.connections=new ArrayList;for(var a=this.figure.getPorts(),b=0;b<a.getSize();b++)a.get(b).getConnections&&this.connections.addAll(a.get(b).getConnections())}if(this.connections==null)this.connections=new ArrayList;this.parent!=null&&this.parent.removeChild(this.figure);for(b=0;b<this.connections.getSize();++b)this.workflow.removeFigure(this.connections.get(b))};
CommandMove=function(a,b,c){Command.call(this,"move figure");this.figure=a;this.oldX=b;this.oldY=c;this.oldCompartment=a.getParent()};CommandMove.prototype=new Command;CommandMove.prototype.type="CommandMove";CommandMove.prototype.setPosition=function(a,b){this.newX=a;this.newY=b;this.newCompartment=this.figure.workflow.getBestCompartmentFigure(a,b,this.figure)};CommandMove.prototype.canExecute=function(){return this.newX!=this.oldX||this.newY!=this.oldY};CommandMove.prototype.execute=function(){this.redo()};
CommandMove.prototype.undo=function(){this.figure.setPosition(this.oldX,this.oldY);this.newCompartment!=null&&this.newCompartment.removeChild(this.figure);this.oldCompartment!=null&&this.oldCompartment.addChild(this.figure);this.figure.workflow.moveResizeHandles(this.figure)};
CommandMove.prototype.redo=function(){this.figure.setPosition(this.newX,this.newY);this.oldCompartment!=null&&this.oldCompartment.removeChild(this.figure);this.newCompartment!=null&&this.newCompartment.addChild(this.figure);this.figure.workflow.moveResizeHandles(this.figure)};CommandResize=function(a,b,c){Command.call(this,"resize figure");this.figure=a;this.oldWidth=b;this.oldHeight=c};CommandResize.prototype=new Command;CommandResize.prototype.type="CommandResize";
CommandResize.prototype.setDimension=function(a,b){this.newWidth=a;this.newHeight=b};CommandResize.prototype.canExecute=function(){return this.newWidth!=this.oldWidth||this.newHeight!=this.oldHeight};CommandResize.prototype.execute=function(){this.redo()};CommandResize.prototype.undo=function(){this.figure.setDimension(this.oldWidth,this.oldHeight);this.figure.workflow.moveResizeHandles(this.figure)};CommandResize.prototype.redo=function(){this.figure.setDimension(this.newWidth,this.newHeight);this.figure.workflow.moveResizeHandles(this.figure)};
CommandSetText=function(a,b){Command.call(this,"set text");this.figure=a;this.newText=b;this.oldText=a.getText()};CommandSetText.prototype=new Command;CommandSetText.prototype.type="CommandSetText";CommandSetText.prototype.execute=function(){this.redo()};CommandSetText.prototype.redo=function(){this.figure.setText(this.newText)};CommandSetText.prototype.undo=function(){this.figure.setText(this.oldText)};
CommandSetColor=function(a,b){Command.call(this,"set color");this.figure=a;this.newColor=b;this.oldColor=a.getColor()};CommandSetColor.prototype=new Command;CommandSetColor.prototype.type="CommandSetColor";CommandSetColor.prototype.execute=function(){this.redo()};CommandSetColor.prototype.undo=function(){this.figure.setColor(this.oldColor)};CommandSetColor.prototype.redo=function(){this.figure.setColor(this.newColor)};
CommandSetBackgroundColor=function(a,b){Command.call(this,"set background color");this.figure=a;this.newColor=b;this.oldColor=a.getBackgroundColor()};CommandSetBackgroundColor.prototype=new Command;CommandSetBackgroundColor.prototype.type="CommandSetBackgroundColor";CommandSetBackgroundColor.prototype.execute=function(){this.redo()};CommandSetBackgroundColor.prototype.undo=function(){this.figure.setBackgroundColor(this.oldColor)};CommandSetBackgroundColor.prototype.redo=function(){this.figure.setBackgroundColor(this.newColor)};
CommandConnect=function(a,b,c){Command.call(this,"create connection");this.workflow=a;this.source=b;this.target=c;this.connection=null};CommandConnect.prototype=new Command;CommandConnect.prototype.type="CommandConnect";CommandConnect.prototype.setConnection=function(a){this.connection=a};CommandConnect.prototype.execute=function(){if(this.connection==null)this.connection=new Connection;this.connection.setSource(this.source);this.connection.setTarget(this.target);this.workflow.addFigure(this.connection)};
CommandConnect.prototype.redo=function(){this.workflow.addFigure(this.connection);this.connection.reconnect()};CommandConnect.prototype.undo=function(){this.workflow.removeFigure(this.connection)};CommandReconnect=function(a){Command.call(this,"reconnect connection");this.con=a;this.oldSourcePort=a.getSource();this.oldTargetPort=a.getTarget();this.oldRouter=a.getRouter()};CommandReconnect.prototype=new Command;CommandReconnect.prototype.type="CommandReconnect";
CommandReconnect.prototype.canExecute=function(){return true};CommandReconnect.prototype.setNewPorts=function(a,b){this.newSourcePort=a;this.newTargetPort=b};CommandReconnect.prototype.execute=function(){this.redo()};CommandReconnect.prototype.undo=function(){this.con.setSource(this.oldSourcePort);this.con.setTarget(this.oldTargetPort);this.con.setRouter(this.oldRouter);this.con.getWorkflow().getCurrentSelection()==this.con&&this.con.getWorkflow().showLineResizeHandles(this.con)};
CommandReconnect.prototype.redo=function(){this.con.setSource(this.newSourcePort);this.con.setTarget(this.newTargetPort);this.con.setRouter(this.oldRouter);this.con.getWorkflow().getCurrentSelection()==this.con&&this.con.getWorkflow().showLineResizeHandles(this.con)};CommandMoveLine=function(a,b,c,d,e){Command.call(this,"move line");this.line=a;this.startX1=b;this.startY1=c;this.endX1=d;this.endY1=e};CommandMoveLine.prototype=new Command;CommandMoveLine.prototype.type="CommandMoveLine";
CommandMoveLine.prototype.canExecute=function(){return this.startX1!=this.startX2||this.startY1!=this.startY2||this.endX1!=this.endX2||this.endY1!=this.endY2};CommandMoveLine.prototype.setEndPoints=function(a,b,c,d){this.startX2=a;this.startY2=b;this.endX2=c;this.endY2=d};CommandMoveLine.prototype.execute=function(){this.redo()};
CommandMoveLine.prototype.undo=function(){this.line.setStartPoint(this.startX1,this.startY1);this.line.setEndPoint(this.endX1,this.endY1);this.line.workflow.getCurrentSelection()==this.line&&this.line.workflow.showLineResizeHandles(this.line)};CommandMoveLine.prototype.redo=function(){this.line.setStartPoint(this.startX2,this.startY2);this.line.setEndPoint(this.endX2,this.endY2);this.line.workflow.getCurrentSelection()==this.line&&this.line.workflow.showLineResizeHandles(this.line)};
Menu=function(){this.menuItems=new ArrayList;Figure.call(this);this.setSelectable(false);this.setDeleteable(false);this.setCanDrag(false);this.setResizeable(false);this.setSelectable(false);this.setZOrder(1E4);this.dirty=false};Menu.prototype=new Figure;Menu.prototype.type="Menu";
Menu.prototype.createHTMLElement=function(){var a=document.createElement("div");a.style.position="absolute";a.style.left=this.x+"px";a.style.top=this.y+"px";a.style.margin="0px";a.style.padding="0px";a.style.zIndex=""+Figure.ZOrderBaseIndex;a.style.border="1px solid gray";a.style.background="lavender";a.style.cursor="pointer";return a};Menu.prototype.setWorkflow=function(a){this.workflow=a};Menu.prototype.appendMenuItem=function(a){this.menuItems.add(a);a.parentMenu=this;this.dirty=true};
Menu.prototype.getHTMLElement=function(){var a=Figure.prototype.getHTMLElement.call(this);this.dirty&&this.createList();return a};
Menu.prototype.createList=function(){this.dirty=false;this.html.innerHTML="";for(var a=0;a<this.menuItems.getSize();a++){var b=this.menuItems.get(a),c=document.createElement("a");c.innerHTML=b.getLabel();c.style.display="block";c.style.fontFamily="Verdana, Arial, Helvetica, sans-serif";c.style.fontSize="9pt";c.style.color="dimgray";c.style.borderBottom="1px solid silver";c.style.paddingLeft="5px";c.style.paddingRight="5px";c.style.cursor="pointer";this.html.appendChild(c);c.menuItem=b;if(c.addEventListener){c.addEventListener("click",
function(a){a=a||window.event;a.cancelBubble=true;a.returnValue=false;this.menuItem.execute(a.clientX+document.body.parentNode.scrollLeft,a.clientY+document.body.parentNode.scrollTop)},false);c.addEventListener("mouseup",function(a){a.cancelBubble=true;a.returnValue=false},false);c.addEventListener("mousedown",function(a){a.cancelBubble=true;a.returnValue=false},false);c.addEventListener("mouseover",function(){this.style.backgroundColor="silver"},false);c.addEventListener("mouseout",function(){this.style.backgroundColor=
"transparent"},false)}else if(c.attachEvent){c.attachEvent("onclick",function(a){var b=a||window.event;b.cancelBubble=true;b.returnValue=false;a.srcElement.menuItem.execute(b.clientX+document.body.parentNode.scrollLeft,b.clientY+document.body.parentNode.scrollTop)});c.attachEvent("onmousedown",function(a){a.cancelBubble=true;a.returnValue=false});c.attachEvent("onmouseup",function(a){a.cancelBubble=true;a.returnValue=false});c.attachEvent("onmouseover",function(a){a.srcElement.style.backgroundColor=
"silver"});c.attachEvent("onmouseout",function(a){a.srcElement.style.backgroundColor="transparent"})}}};MenuItem=function(a,b,c){this.label=a;this.iconUrl=b;this.parentMenu=null;this.action=c};MenuItem.prototype.type="MenuItem";MenuItem.prototype.isEnabled=function(){return true};MenuItem.prototype.getLabel=function(){return this.label};MenuItem.prototype.execute=function(a,b){this.parentMenu.workflow.showMenu(null);this.action(a,b)};Locator=function(){};Locator.prototype.type="Locator";
Locator.prototype.relocate=function(){};ConnectionLocator=function(a){Locator.call(this);this.connection=a};ConnectionLocator.prototype=new Locator;ConnectionLocator.prototype.type="ConnectionLocator";ConnectionLocator.prototype.getConnection=function(){return this.connection};ManhattenMidpointLocator=function(a){ConnectionLocator.call(this,a)};ManhattenMidpointLocator.prototype=new ConnectionLocator;ManhattenMidpointLocator.prototype.type="ManhattenMidpointLocator";
ManhattenMidpointLocator.prototype.relocate=function(a){var b=this.getConnection(),c=new Point,d=b.getPoints(),e=Math.floor((d.getSize()-2)/2),b=d.get(e),d=d.get(e+1);c.x=(d.x-b.x)/2+b.x+5;c.y=(d.y-b.y)/2+b.y+5;a.setPosition(c.x,c.y)};
