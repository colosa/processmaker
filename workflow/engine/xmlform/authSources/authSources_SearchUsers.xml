<?xml version="1.0" encoding="UTF-8"?>
<dynaForm name="authSources/authSources_SearchUsers" type="xmlform" enableTemplate="1" width="95%">

<TITLE type="title">
  <en>Search for user</en>
</TITLE>

<AUTH_SOURCE_UID type="hidden"/>

<KEYWORD type="text" size="50" maxlength="50" required="0">
  <en>Keyword</en>
</KEYWORD>

<btnSearch type="button" onclick="searchUsers();">
  <en>Search</en>
</btnSearch>

<btnImport type="button" onclick="importUsers(this.form);">
  <en>Import</en>
</btnImport>

<BTN_CANCEL type="button" onclick="cancel();">
  <en>Cancel</en>
</BTN_CANCEL>

<JS type="javascript"><![CDATA[

getField('btnImport').style.visibility = 'hidden';

function disableEnterKey(e)
{
  var key;
  if(window.event)
    key = window.event.keyCode;     //IE
  else
    key = e.which;     //firefox

  if(key == 13) {
    searchUsers();
    e.cancelBubble = true;
    e.returnValue = false;
    if (e.stopPropagation) {
      e.stopPropagation();
      e.preventDefault();
    }
    return false;
  } else {
    return true;
  }
}

var searchUsers = function() {
  var oRPC = new leimnud.module.rpc.xmlhttp({
    url     : 'authSources_Ajax',
    args    : 'action=searchUsers&sUID=' + getField('AUTH_SOURCE_UID').value + "&sKeyword=" + getField('KEYWORD').value
  });
  oRPC.callback = function(rpc){
    document.getElementById('spanUsers').innerHTML = rpc.xmlhttp.responseText;
    if (document.getElementById('aUsers[0]')) {
      getField('btnImport').style.visibility = 'visible';
    }
    else {
      getField('btnImport').style.visibility = 'hidden';
    }
    var scs = rpc.xmlhttp.responseText.extractScript();
    scs.evalScript();

  }.extend(this);
  oRPC.make();

};

var importUsers = function(oForm) {
  var bContinue = false;
  var i = 0;
  var oAux;
  while (oAux = document.getElementById('aUsers[' + i + ']')) {
    if (oAux.checked) {
      bContinue = true;
    }
    i++;
  }
  if (bContinue) {
    oForm.submit();
  }
  else {
    //alert(666);
  }
};

function cancel(){
  window.location = 'authSources_List';
}

leimnud.event.add(getField('KEYWORD'), 'keypress', function(event) {
  return disableEnterKey(event);
});

]]></JS>

</dynaForm>